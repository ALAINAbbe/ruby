<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Pubnub-orig</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.8.0/application.js' type='text/javascript'></script>    
    <link href='./assets/0.8.0/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.8.0/favicon_green.png" />
    <link rel="icon" type="image/png" href="./assets/0.8.0/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.8.0/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2014-09-22T21:01:07+02:00">2014-09-22T21:01:07+02:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="green">98.87%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         37.0
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>58</b> files in total.
    <b>11448</b> relevant lines. 
    <span class="green"><b>11319</b> lines covered</span> and
    <span class="red"><b>129</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#392ca6758e7228e2adcf4c15d0c20d83ce447438" class="src_link" title="lib/pubnub.rb">lib/pubnub.rb</a></td>
        <td class="yellow strong">86.96 %</td>
        <td>51</td>
        <td>23</td>
        <td>20</td>
        <td>3</td>
        <td>1350.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#19b94f2f4eadef40df6a676f7d8502995a0dbcbd" class="src_link" title="lib/pubnub/client.rb">lib/pubnub/client.rb</a></td>
        <td class="red strong">68.18 %</td>
        <td>376</td>
        <td>220</td>
        <td>150</td>
        <td>70</td>
        <td>498.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4072703bac52be1810da25906abee4c805c961b1" class="src_link" title="lib/pubnub/configuration.rb">lib/pubnub/configuration.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>32</td>
        <td>29</td>
        <td>29</td>
        <td>0</td>
        <td>17.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#edd18fe047bb4c555be3d79e75a773953da761c9" class="src_link" title="lib/pubnub/crypto.rb">lib/pubnub/crypto.rb</a></td>
        <td class="green strong">91.67 %</td>
        <td>60</td>
        <td>36</td>
        <td>33</td>
        <td>3</td>
        <td>72.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fa35aa90972b3af15bdc905874d390b57459bb6f" class="src_link" title="lib/pubnub/envelope.rb">lib/pubnub/envelope.rb</a></td>
        <td class="yellow strong">85.71 %</td>
        <td>45</td>
        <td>14</td>
        <td>12</td>
        <td>2</td>
        <td>1609.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3f25c00544b6a5ac0cc10955314fc915697314c7" class="src_link" title="lib/pubnub/event.rb">lib/pubnub/event.rb</a></td>
        <td class="green strong">95.14 %</td>
        <td>531</td>
        <td>288</td>
        <td>274</td>
        <td>14</td>
        <td>502.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b6a29fd7b2f3385a44ec0451125fefa368b53752" class="src_link" title="lib/pubnub/events/audit.rb">lib/pubnub/events/audit.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>38</td>
        <td>20</td>
        <td>20</td>
        <td>0</td>
        <td>34.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#394a57470d2e428906fc141a7bb7259e4cb2c431" class="src_link" title="lib/pubnub/events/grant.rb">lib/pubnub/events/grant.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>59</td>
        <td>30</td>
        <td>30</td>
        <td>0</td>
        <td>48.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9e4ee83ac81a9069d89486f89f9ed6dfa020113c" class="src_link" title="lib/pubnub/events/heartbeat.rb">lib/pubnub/events/heartbeat.rb</a></td>
        <td class="green strong">96.43 %</td>
        <td>63</td>
        <td>28</td>
        <td>27</td>
        <td>1</td>
        <td>1.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#22da7f3439c34256d94a62e395cb427c4e802f58" class="src_link" title="lib/pubnub/events/here_now.rb">lib/pubnub/events/here_now.rb</a></td>
        <td class="green strong">92.31 %</td>
        <td>64</td>
        <td>26</td>
        <td>24</td>
        <td>2</td>
        <td>74.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bb51312c3d9b70dc9d583499138643b4e0527aed" class="src_link" title="lib/pubnub/events/history.rb">lib/pubnub/events/history.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>110</td>
        <td>48</td>
        <td>48</td>
        <td>0</td>
        <td>53.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2a8b923d8ca6efa7f29970ca669786df0255b4de" class="src_link" title="lib/pubnub/events/leave.rb">lib/pubnub/events/leave.rb</a></td>
        <td class="green strong">95.12 %</td>
        <td>82</td>
        <td>41</td>
        <td>39</td>
        <td>2</td>
        <td>46.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a89a5563de3ee5ff8017dbf825e6d0b1689aada5" class="src_link" title="lib/pubnub/events/presence.rb">lib/pubnub/events/presence.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>35</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>101.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2ed89d156002d4df47b5b8eba8a0f61805033237" class="src_link" title="lib/pubnub/events/publish.rb">lib/pubnub/events/publish.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>71</td>
        <td>30</td>
        <td>30</td>
        <td>0</td>
        <td>82.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#419b9acf0e41ff3db2ed4ce3c846fac7b81af4f4" class="src_link" title="lib/pubnub/events/revoke.rb">lib/pubnub/events/revoke.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>56</td>
        <td>28</td>
        <td>28</td>
        <td>0</td>
        <td>47.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#73251ef4843e500b2ccb9096fea17113b33e9a6c" class="src_link" title="lib/pubnub/events/state.rb">lib/pubnub/events/state.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>57</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>3.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4f3bf9e46c1a156a6a6f300930e392a5e865b797" class="src_link" title="lib/pubnub/events/subscribe.rb">lib/pubnub/events/subscribe.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>41</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>67.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d4d6b4af76920a5d9220c9c8bac88bf9e21292e6" class="src_link" title="lib/pubnub/events/time.rb">lib/pubnub/events/time.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>52</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>41.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#881e5ae2fb41ed270efa20ef9297471899430596" class="src_link" title="lib/pubnub/events/where_now.rb">lib/pubnub/events/where_now.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>52</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>9.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#aaa910c8848b2ee3aff95cea6d3c0ea6fd2c81af" class="src_link" title="lib/pubnub/exceptions.rb">lib/pubnub/exceptions.rb</a></td>
        <td class="green strong">97.06 %</td>
        <td>50</td>
        <td>34</td>
        <td>33</td>
        <td>1</td>
        <td>453.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4ad20257a561092f5e94677e4e5e6d93ed124326" class="src_link" title="lib/pubnub/formatter.rb">lib/pubnub/formatter.rb</a></td>
        <td class="green strong">92.31 %</td>
        <td>46</td>
        <td>26</td>
        <td>24</td>
        <td>2</td>
        <td>1123.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fdc7b7da368c77afe781a25dc1b427a881227d88" class="src_link" title="lib/pubnub/pam.rb">lib/pubnub/pam.rb</a></td>
        <td class="red strong">79.41 %</td>
        <td>67</td>
        <td>34</td>
        <td>27</td>
        <td>7</td>
        <td>123.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a3be43aae64c488094e7af695e4f0573fa5ec2b5" class="src_link" title="lib/pubnub/parser.rb">lib/pubnub/parser.rb</a></td>
        <td class="yellow strong">84.62 %</td>
        <td>21</td>
        <td>13</td>
        <td>11</td>
        <td>2</td>
        <td>1412.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2925973fd39d1e82bf8d130dd830d92e660bf9e0" class="src_link" title="lib/pubnub/uuid.rb">lib/pubnub/uuid.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>520.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b1069e18d1ff841fc0db7f87a554bfa001fa4cb1" class="src_link" title="lib/pubnub/validator.rb">lib/pubnub/validator.rb</a></td>
        <td class="red strong">46.67 %</td>
        <td>29</td>
        <td>15</td>
        <td>7</td>
        <td>8</td>
        <td>105.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c835454764b49cf4f7d980380ea42b5665462ddf" class="src_link" title="spec/lib/client_spec.rb">spec/lib/client_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>47</td>
        <td>27</td>
        <td>27</td>
        <td>0</td>
        <td>1.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3e100bb44c1081b191ba952a8f3ad352e0d1b7c1" class="src_link" title="spec/lib/encoder_spec.rb">spec/lib/encoder_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>51</td>
        <td>29</td>
        <td>29</td>
        <td>0</td>
        <td>1.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#03f96d06b27e7bd769fdcbd4a33f5516d091bc36" class="src_link" title="spec/lib/eof_error_spec.rb">spec/lib/eof_error_spec.rb</a></td>
        <td class="yellow strong">87.1 %</td>
        <td>48</td>
        <td>31</td>
        <td>27</td>
        <td>4</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e8568a38008be0fb0972fe9972e81d0e671c285c" class="src_link" title="spec/lib/formatting_envelope_spec.rb">spec/lib/formatting_envelope_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>304</td>
        <td>129</td>
        <td>129</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3d2bd72e18f7833198503bd8482bd354bd09e27c" class="src_link" title="spec/lib/heartbeat_spec.rb">spec/lib/heartbeat_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>110</td>
        <td>62</td>
        <td>62</td>
        <td>0</td>
        <td>1.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#30b353b666ca62e18db2f68e779ecd7449a562c1" class="src_link" title="spec/lib/integration/audit_dpc_spec.rb">spec/lib/integration/audit_dpc_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>544</td>
        <td>358</td>
        <td>358</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#75f2a11878c4f772fc828480099e9ed3e766a7f0" class="src_link" title="spec/lib/integration/audit_spec.rb">spec/lib/integration/audit_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>544</td>
        <td>358</td>
        <td>358</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#33f6f5e59455dd6c2ee82b8cd7d6c8c0f7acc931" class="src_link" title="spec/lib/integration/global_here_now_dpc_spec.rb">spec/lib/integration/global_here_now_dpc_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>541</td>
        <td>356</td>
        <td>356</td>
        <td>0</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c8c564cfc80c64e94676751432054d970408d33b" class="src_link" title="spec/lib/integration/global_here_now_spec.rb">spec/lib/integration/global_here_now_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>541</td>
        <td>356</td>
        <td>356</td>
        <td>0</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7f6efcba980aa35438161a33a846143df90bfedd" class="src_link" title="spec/lib/integration/grant_dpc_spec.rb">spec/lib/integration/grant_dpc_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>555</td>
        <td>366</td>
        <td>366</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#58f396307419cb95d93a225a21d01c9c5591ec06" class="src_link" title="spec/lib/integration/grant_spec.rb">spec/lib/integration/grant_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>555</td>
        <td>366</td>
        <td>366</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1915c660bd6afb277695fedb350d7d6fdf34a1ba" class="src_link" title="spec/lib/integration/here_now_dpc_spec.rb">spec/lib/integration/here_now_dpc_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>543</td>
        <td>357</td>
        <td>357</td>
        <td>0</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5b652e99bae759c7945ae1ec5438ddee4f6cd2fc" class="src_link" title="spec/lib/integration/here_now_spec.rb">spec/lib/integration/here_now_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>543</td>
        <td>357</td>
        <td>357</td>
        <td>0</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#505328d7f2135e95366a2466b48b82c5bd3c1aa5" class="src_link" title="spec/lib/integration/history_dpc_spec.rb">spec/lib/integration/history_dpc_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>541</td>
        <td>356</td>
        <td>356</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#614c23a83e5636048d2271242ad0e3e248f82899" class="src_link" title="spec/lib/integration/history_spec.rb">spec/lib/integration/history_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>541</td>
        <td>356</td>
        <td>356</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#32408f0c7d6279eacf8eeefc6c191f28ba020848" class="src_link" title="spec/lib/integration/leave_dpc_spec.rb">spec/lib/integration/leave_dpc_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>540</td>
        <td>356</td>
        <td>356</td>
        <td>0</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cdac4d0f6743b07358c382299f2ea0e751f9f880" class="src_link" title="spec/lib/integration/leave_spec.rb">spec/lib/integration/leave_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>540</td>
        <td>356</td>
        <td>356</td>
        <td>0</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#537867f56221c49032affde57e54777dc4bbf7c9" class="src_link" title="spec/lib/integration/multiplexed_subscribe_flow_spec.rb">spec/lib/integration/multiplexed_subscribe_flow_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>44</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c68d8cfa3c568c75e2cfad181d52564ad53316d5" class="src_link" title="spec/lib/integration/presence_dpc_spec.rb">spec/lib/integration/presence_dpc_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>557</td>
        <td>372</td>
        <td>372</td>
        <td>0</td>
        <td>2.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3b5783c9d0b73e9f37b87b3f81702e02d40d2ecc" class="src_link" title="spec/lib/integration/presence_spec.rb">spec/lib/integration/presence_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>557</td>
        <td>372</td>
        <td>372</td>
        <td>0</td>
        <td>2.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f3e490ff876d201c77b6b9e07ffb3fb9ad34cf97" class="src_link" title="spec/lib/integration/publish_dpc_spec.rb">spec/lib/integration/publish_dpc_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1877</td>
        <td>893</td>
        <td>893</td>
        <td>0</td>
        <td>1.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3f5a0fd37df2654aa13673c3f9fd7495ce90c987" class="src_link" title="spec/lib/integration/publish_spec.rb">spec/lib/integration/publish_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1872</td>
        <td>896</td>
        <td>896</td>
        <td>0</td>
        <td>1.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0321104742faaa74db6d19916349f7c15213c30b" class="src_link" title="spec/lib/integration/revoke_dpc_spec.rb">spec/lib/integration/revoke_dpc_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>555</td>
        <td>366</td>
        <td>366</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#64398207eae71bc2bbb52b8695ea8002e9884cd9" class="src_link" title="spec/lib/integration/revoke_spec.rb">spec/lib/integration/revoke_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>555</td>
        <td>366</td>
        <td>366</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ce76c95c8a9b679659c181df81cf82f33a6b326e" class="src_link" title="spec/lib/integration/state_spec.rb">spec/lib/integration/state_spec.rb</a></td>
        <td class="yellow strong">84.62 %</td>
        <td>84</td>
        <td>52</td>
        <td>44</td>
        <td>8</td>
        <td>1.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f30b05ce3e8199332ef77410766408921b6a3828" class="src_link" title="spec/lib/integration/subscribe_dpc_spec.rb">spec/lib/integration/subscribe_dpc_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>564</td>
        <td>376</td>
        <td>376</td>
        <td>0</td>
        <td>2.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#eeff47e94b4b628be52db1454e9b5469b237c343" class="src_link" title="spec/lib/integration/subscribe_spec.rb">spec/lib/integration/subscribe_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>564</td>
        <td>376</td>
        <td>376</td>
        <td>0</td>
        <td>2.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#84a279de169b27316e8d11b6b565389a75dfc2ac" class="src_link" title="spec/lib/integration/time_dpc_spec.rb">spec/lib/integration/time_dpc_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>541</td>
        <td>356</td>
        <td>356</td>
        <td>0</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#17a75dbb569f6a8de1e739c74c92f0a525170cfe" class="src_link" title="spec/lib/integration/time_spec.rb">spec/lib/integration/time_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>541</td>
        <td>356</td>
        <td>356</td>
        <td>0</td>
        <td>2.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4c6d8afc4aa02b78e5df216685170ff01d729ead" class="src_link" title="spec/lib/integration/v3_presence_dpc_spec.rb">spec/lib/integration/v3_presence_dpc_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>557</td>
        <td>372</td>
        <td>372</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0c4b4d4cc312b301d800951a3313bf48a404f93c" class="src_link" title="spec/lib/integration/v3_presence_spec.rb">spec/lib/integration/v3_presence_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>557</td>
        <td>372</td>
        <td>372</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ed49d693fa488c369ed4ef97b096c7804a25f6dd" class="src_link" title="spec/lib/integration/where_now_spec.rb">spec/lib/integration/where_now_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>312</td>
        <td>195</td>
        <td>195</td>
        <td>0</td>
        <td>2.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#38612edd0379361e1e4282d94faf8dbad5669835" class="src_link" title="spec/lib/retry_logic_spec.rb">spec/lib/retry_logic_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>53</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>1.3</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.9.1 
        and simplecov-html v0.8.0<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="392ca6758e7228e2adcf4c15d0c20d83ce447438">
  <div class="header">
    <h3>lib/pubnub.rb</h3>
    <h4><span class="yellow">86.96 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby">## www.pubnub.com - PubNub realtime push service in the cloud.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">## http://www.pubnub.com/blog/ruby-push-api - Ruby Push API Blog</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">## PubNub Real Time Push APIs and Notifications Framework</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">## Copyright (c) 2014 PubNub</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">## http://www.pubnub.com/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">## -----------------------------------</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">## PubNub Real-time Push Cloud API</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">## -----------------------------------</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;json&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;base64&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;open-uri&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;openssl&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;eventmachine&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;net/http/persistent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;logger&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pubnub/version&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pubnub/client&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">class Object</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def blank?</code>
        </li>
      
        <li class="covered" data-hits="27836" data-linenumber="26">
          <span class="hits">27836</span>
          
          <code class="ruby">    respond_to?(:empty?) ? empty? : !self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def present?</code>
        </li>
      
        <li class="covered" data-hits="2297" data-linenumber="30">
          <span class="hits">2297</span>
          
          <code class="ruby">    !blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">class Proc</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def try(*a, &amp;b)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    if a.empty? &amp;&amp; block_given?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">      yield self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">      __send__(*a, &amp;b)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  class &lt;&lt; self</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">    def new(options = {})</code>
        </li>
      
        <li class="covered" data-hits="918" data-linenumber="47">
          <span class="hits">918</span>
          
          <code class="ruby">      Pubnub::Client.new(options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="19b94f2f4eadef40df6a676f7d8502995a0dbcbd">
  <div class="header">
    <h3>lib/pubnub/client.rb</h3>
    <h4><span class="red">68.18 %</span> covered</h4>
    <div>
      <b>220</b> relevant lines. 
      <span class="green"><b>150</b> lines covered</span> and
      <span class="red"><b>70</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pubnub/configuration&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pubnub/parser&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pubnub/envelope&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pubnub/crypto&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pubnub/uuid&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pubnub/exceptions&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pubnub/event&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pubnub/formatter&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pubnub/validator&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;pubnub/pam&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  class Client</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    include Configuration</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :env</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :single_event_connections_pool, :subscribe_event_connections_pool, :uuid, :async_events</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    EVENTS = %w(publish subscribe presence leave history here_now audit grant revoke time heartbeat where_now state)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    VERSION = Pubnub::VERSION</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    EVENTS.each do |event_name|</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="23">
          <span class="hits">13</span>
          
          <code class="ruby">      require File.join(&#39;pubnub&#39;, &#39;events&#39;, event_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    EVENTS.each do |event_name|</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="27">
          <span class="hits">13</span>
          
          <code class="ruby">      define_method event_name do |params = {}, &amp;block|</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="28">
          <span class="hits">1026</span>
          
          <code class="ruby">        params[:callback] = block if params[:callback].nil?</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="29">
          <span class="hits">1026</span>
          
          <code class="ruby">        event = Pubnub.const_get(classify_method(event_name)).new(params, self)</code>
        </li>
      
        <li class="covered" data-hits="2052" data-linenumber="30">
          <span class="hits">2052</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Created event &#39; + event.class.to_s}</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="31">
          <span class="hits">1026</span>
          
          <code class="ruby">        event.fire(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    alias_method :unsubscribe, :leave</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options)</code>
        </li>
      
        <li class="covered" data-hits="918" data-linenumber="37">
          <span class="hits">918</span>
          
          <code class="ruby">      validate!(options)</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="38">
          <span class="hits">910</span>
          
          <code class="ruby">      setup_app(options) # After that we have to use @env in that method instead of options</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="39">
          <span class="hits">910</span>
          
          <code class="ruby">      create_connections_pools(@env)</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="40">
          <span class="hits">910</span>
          
          <code class="ruby">      create_subscriptions_pools(@env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      # start_event_machine(@env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    def paged_history(options = {}, &amp;block)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">      channel  = options[:channel]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">      page     = options[:page]      || 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">      limit    = options[:limit]     || 100</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">      callback = options[:callback]  || block</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">      sync     = options[:http_sync] ? true : false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      start_tt = options[:start]     || nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">      end_tt   = options[:end]       || nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">      current_start_tt = start_tt</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">      if sync</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">          puts &quot;page = #{page}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">          envelopes = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">          page.times do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">            envelopes = self.history(:channel =&gt; channel, :http_sync =&gt; true, :count =&gt; limit, :start =&gt; current_start_tt, :end =&gt; end_tt)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">            current_start_tt = envelopes.last.history_start.to_i - 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">          envelopes.each do |envelope|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">            callback.call envelope</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">          end if callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">        EM.defer do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">          until msgs.size &lt;= page * entries</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">            msgs.merge!(self.history(:channel =&gt; channel, :http_sync =&gt; true, :start =&gt; start_tt, :end =&gt; end_tt, :limit =&gt; entries))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">          msgs.reverse[0..entries].each do |envelope|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">            callback.call envelope</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">    def state_for(origin = DEFAULT_ORIGIN)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">      @env[:state][origin]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_state(state, channel, origin = DEFAULT_ORIGIN)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="91">
          <span class="hits">5</span>
          
          <code class="ruby">      raise &#39;You can set state only as hash&#39; unless (state.is_a?(Hash) || state.is_a?(NilClass))</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="92">
          <span class="hits">5</span>
          
          <code class="ruby">      @env[:state] = Hash.new         if @env[:state].nil?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="93">
          <span class="hits">5</span>
          
          <code class="ruby">      @env[:state][origin] = Hash.new if @env[:state][origin].nil?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="94">
          <span class="hits">5</span>
          
          <code class="ruby">      @env[:state][origin][channel.to_s] = state</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">    def add_to_state(hash, channel, origin = DEFAULT_ORIGIN)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">      raise &#39;You can add to state only hash&#39; unless hash.is_a?(Hash)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">      @env[:state][origin][channel] = Hash.new if @env[:state][channel].nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">      @env[:state][origin][channel].merge!(hash)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">    def shutdown(stop_em = false)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">      @single_event_connections_pool.each do |origin, conn|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="105">
          
          
          <code class="ruby">        conn.shutdown_in_all_threads</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">        conn = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">      @single_event_connections_pool = Hash.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">      @subscribe_event_connections_pool.each do |origin, conn|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">        conn.shutdown_in_all_threads</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">        conn = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">      @subscribe_event_connections_pool = Hash.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">      @env[:callback_pool] = Hash.new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">      @env[:subscriptions] = Hash.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">      EM.stop if stop_em</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">      $logger.info(&#39;Pubnub&#39;){&#39;Bye!&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">    def stop_async</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#stop_async | fired&#39;}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="126">
          
          
          <code class="ruby">      @env[:subscribe_railgun].cancel unless @env[:subscribe_railgun].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="127">
          
          
          <code class="ruby">      @env[:respirator].cancel        unless @env[:respirator].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="128">
          
          
          <code class="ruby">      @env[:subscribe_railgun].cancel unless @env[:subscribe_railgun].blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">      @env[:subscribe_railgun] = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="131">
          
          
          <code class="ruby">      @env[:respirator] = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">      @env[:subscribe_railgun] = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">      EM.stop</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#stop_async | timers killed&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">    def restore_async</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">      start_event_machine</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">      start_subscribe unless @env[:subscriptions].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">      start_railgun</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">    def start_respirator</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="146">
          <span class="hits">10</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_respirator | fired&#39;}</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="147">
          <span class="hits">5</span>
          
          <code class="ruby">      if @env[:heartbeat]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="148">
          <span class="hits">6</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_respirator | starting&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">        if @env[:heartbeat] != @env[:respirator].interval</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">          $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_respirator | destroy old respirator&#39;}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">          @env[:respirator].cancel</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="153">
          
          
          <code class="ruby">          @env[:respirator] = nil</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="154">
          <span class="hits">3</span>
          
          <code class="ruby">        end if @env[:respirator]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="156">
          <span class="hits">3</span>
          
          <code class="ruby">        @env[:respirator] = EM.add_periodic_timer((@env[:heartbeat].to_i/2) - 1) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">          @env[:subscriptions].each do |origin, subscribe|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="158">
          <span class="hits">2</span>
          
          <code class="ruby">            $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_respirator | BUM&#39;}</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="159">
          <span class="hits">2</span>
          
          <code class="ruby">            EM.defer { heartbeat(:channel =&gt; subscribe.get_channels){ |e| $logger.debug(&#39;Pubnub::Client#start_respirator | bum&#39;) } }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="161">
          <span class="hits">3</span>
          
          <code class="ruby">        end unless @env[:respirator]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="163">
          <span class="hits">6</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_respirator | started&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">    def start_subscribe(override = false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="203" data-linenumber="169">
          <span class="hits">203</span>
          
          <code class="ruby">      start_event_machine</code>
        </li>
      
        <li class="covered" data-hits="203" data-linenumber="170">
          <span class="hits">203</span>
          
          <code class="ruby">      start_respirator if @env[:heartbeat]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="203" data-linenumber="172">
          <span class="hits">203</span>
          
          <code class="ruby">      if override</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="173">
          
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_subscribe | Override&#39;}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="174">
          
          
          <code class="ruby">        @env[:subscribe_railgun].cancel</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">        @env[:subscribe_railgun] = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="176">
          
          
          <code class="ruby">        @env[:wait_for_response].each do |k,v|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="177">
          
          
          <code class="ruby">          @env[:wait_for_response][k] = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="203" data-linenumber="181">
          <span class="hits">203</span>
          
          <code class="ruby">      if @env[:subscribe_railgun] &amp;&amp; @subscribe_deffered_thread</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="182">
          
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_subscribe | Aborting previous request&#39;}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="183">
          
          
          <code class="ruby">        @subscribe_deffered_thread.kill</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="184">
          
          
          <code class="ruby">        Thread.pass until @subscribe_deffered_thread.status == false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="203" data-linenumber="187">
          <span class="hits">203</span>
          
          <code class="ruby">      @env[:wait_for_response] = Hash.new unless @wait_for_response</code>
        </li>
      
        <li class="covered" data-hits="203" data-linenumber="188">
          <span class="hits">203</span>
          
          <code class="ruby">      unless @env[:subscribe_railgun]</code>
        </li>
      
        <li class="covered" data-hits="167" data-linenumber="189">
          <span class="hits">167</span>
          
          <code class="ruby">        @env[:subscribe_railgun] = EM.add_periodic_timer(PERIODIC_TIMER_INTERVAL) do</code>
        </li>
      
        <li class="covered" data-hits="230" data-linenumber="190">
          <span class="hits">230</span>
          
          <code class="ruby">          begin</code>
        </li>
      
        <li class="covered" data-hits="230" data-linenumber="191">
          <span class="hits">230</span>
          
          <code class="ruby">            @env[:subscriptions].each do |origin, subscribe|</code>
        </li>
      
        <li class="covered" data-hits="226" data-linenumber="192">
          <span class="hits">226</span>
          
          <code class="ruby">              unless @env[:wait_for_response][origin]</code>
        </li>
      
        <li class="covered" data-hits="221" data-linenumber="193">
          <span class="hits">221</span>
          
          <code class="ruby">                @env[:wait_for_response][origin] = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="442" data-linenumber="195">
          <span class="hits">442</span>
          
          <code class="ruby">                $logger.debug(&#39;Pubnub&#39;){&#39;Async subscription running&#39;}</code>
        </li>
      
        <li class="covered" data-hits="442" data-linenumber="196">
          <span class="hits">442</span>
          
          <code class="ruby">                $logger.debug(&#39;Pubnub&#39;){&quot;origin: #{origin}&quot;}</code>
        </li>
      
        <li class="covered" data-hits="442" data-linenumber="197">
          <span class="hits">442</span>
          
          <code class="ruby">                $logger.debug(&#39;Pubnub&#39;){&quot;timetoken: #{@env[:timetoken]}&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="221" data-linenumber="199">
          <span class="hits">221</span>
          
          <code class="ruby">                EM.defer do</code>
        </li>
      
        <li class="covered" data-hits="221" data-linenumber="200">
          <span class="hits">221</span>
          
          <code class="ruby">                  @subscribe_deffered_thread = Thread.current</code>
        </li>
      
        <li class="covered" data-hits="221" data-linenumber="201">
          <span class="hits">221</span>
          
          <code class="ruby">                  subscribe.start_event(self) if subscribe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">                  # @env[:wait_for_response][origin] = false # moved to Event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">          rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="208">
          
          
          <code class="ruby">            $logger.error(&#39;Pubnub&#39;){e}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="209">
          
          
          <code class="ruby">            $logger.error(&#39;Pubnub&#39;){e.backtrace}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">    def subscription_running?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="216">
          
          
          <code class="ruby">      @env[:subscribe_railgun] &amp;&amp; !@env[:subscriptions].empty? ? true : false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">    def create_subscriptions_pools(env)</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="220">
          <span class="hits">910</span>
          
          <code class="ruby">      @env[:subscriptions]        = Hash.new</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="221">
          <span class="hits">910</span>
          
          <code class="ruby">      @env[:callbacks_pool]       = Hash.new</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="222">
          <span class="hits">910</span>
          
          <code class="ruby">      @env[:error_callbacks_pool] = Hash.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">    def update_timetoken(timetoken)</code>
        </li>
      
        <li class="covered" data-hits="739" data-linenumber="226">
          <span class="hits">739</span>
          
          <code class="ruby">      @env[:timetoken] = timetoken.to_i</code>
        </li>
      
        <li class="covered" data-hits="1478" data-linenumber="227">
          <span class="hits">1478</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&quot;Pubnub::Client#update_timetoken | Current timetoken is eq #{@env[:timetoken]}&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_uuid(uuid)</code>
        </li>
      
        <li class="covered" data-hits="862" data-linenumber="231">
          <span class="hits">862</span>
          
          <code class="ruby">      leave_all unless @env[:subscriptions].empty?</code>
        </li>
      
        <li class="covered" data-hits="862" data-linenumber="232">
          <span class="hits">862</span>
          
          <code class="ruby">      @env[:uuid] = uuid</code>
        </li>
      
        <li class="covered" data-hits="862" data-linenumber="233">
          <span class="hits">862</span>
          
          <code class="ruby">      start_subscribe(true) unless @env[:subscriptions].empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">    alias_method :session_uuid=, :set_uuid</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">    alias_method :uuid=, :set_uuid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_auth_key(auth_key)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="239">
          <span class="hits">3</span>
          
          <code class="ruby">      leave_all unless @env[:subscriptions].empty?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="240">
          <span class="hits">3</span>
          
          <code class="ruby">      @env[:auth_key] = auth_key</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="241">
          <span class="hits">3</span>
          
          <code class="ruby">      start_subscribe(true) unless @env[:subscriptions].empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">    alias_method :auth_key=, :set_auth_key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_heartbeat(heartbeat = nil)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="246">
          <span class="hits">8</span>
          
          <code class="ruby">      if heartbeat</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="247">
          <span class="hits">8</span>
          
          <code class="ruby">        @env[:heartbeat] = heartbeat</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="249">
          <span class="hits">8</span>
          
          <code class="ruby">      @env[:heartbeat]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="251">
          <span class="hits">1</span>
          
          <code class="ruby">    alias_method :heartbeat=, :set_heartbeat</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_heartbeat</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">      @env[:heartbeat]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_cipher_key(cipher_key)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="258">
          
          
          <code class="ruby">      @env[:cipher_key] = cipher_key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">    alias_method :cipher_key=, :set_cipher_key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">    def start_railgun</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="263">
          <span class="hits">345</span>
          
          <code class="ruby">      start_event_machine(@env)</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="264">
          <span class="hits">345</span>
          
          <code class="ruby">      if @env[:railgun]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="265">
          <span class="hits">2</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_railgun | Railgun already initialized&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="688" data-linenumber="267">
          <span class="hits">688</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_railgun | Initializing railgun&#39;}</code>
        </li>
      
        <li class="covered" data-hits="344" data-linenumber="268">
          <span class="hits">344</span>
          
          <code class="ruby">        @env[:railgun] = EM.add_periodic_timer(0.01) do</code>
        </li>
      
        <li class="covered" data-hits="8188" data-linenumber="269">
          <span class="hits">8188</span>
          
          <code class="ruby">          @async_events.each do |event|</code>
        </li>
      
        <li class="covered" data-hits="726" data-linenumber="270">
          <span class="hits">726</span>
          
          <code class="ruby">            EM.defer do</code>
        </li>
      
        <li class="covered" data-hits="725" data-linenumber="271">
          <span class="hits">725</span>
          
          <code class="ruby">              event.fire(self) unless event.fired</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="8914" data-linenumber="274">
          <span class="hits">8914</span>
          
          <code class="ruby">          @async_events.delete_if {|event| event.finished }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="276">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="279">
          <span class="hits">1</span>
          
          <code class="ruby">    def disabled_persistent_connection?</code>
        </li>
      
        <li class="covered" data-hits="2098" data-linenumber="280">
          <span class="hits">2098</span>
          
          <code class="ruby">      @env[:disable_persistent_connection].present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="285">
          <span class="hits">1</span>
          
          <code class="ruby">    def leave_all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="286">
          
          
          <code class="ruby">      @env[:subscriptions].each do |origin, subscribe|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="287">
          
          
          <code class="ruby">        leave(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">            :origin =&gt; origin,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="289">
          
          
          <code class="ruby">            :channel =&gt; subscribe.get_channels.map{|c| c.to_s}.join(&#39;,&#39;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">            :http_sync =&gt; true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">            :skip_remove =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">        )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="294">
          
          
          <code class="ruby">        subscribe.set_timetoken(0)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">    def start_event_machine(options = nil)</code>
        </li>
      
        <li class="covered" data-hits="1096" data-linenumber="299">
          <span class="hits">1096</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_event_machine | starting EM in new thread&#39;}</code>
        </li>
      
        <li class="covered" data-hits="548" data-linenumber="300">
          <span class="hits">548</span>
          
          <code class="ruby">      if defined?(Thin)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="301">
          
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_event_machine | We\&#39;re running on thin&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1096" data-linenumber="303">
          <span class="hits">1096</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_event_machine | We aren\&#39;t running on thin&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="548" data-linenumber="305">
          <span class="hits">548</span>
          
          <code class="ruby">      if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="226" data-linenumber="306">
          <span class="hits">226</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_event_machine | EM already running&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="870" data-linenumber="308">
          <span class="hits">870</span>
          
          <code class="ruby">        Thread.new { EM.run {} }</code>
        </li>
      
        <li class="covered" data-hits="435" data-linenumber="309">
          <span class="hits">435</span>
          
          <code class="ruby">        Thread.pass until EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="870" data-linenumber="310">
          <span class="hits">870</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Client#start_event_machine | EM started in new thread&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">    def setup_app(options)</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="315">
          <span class="hits">910</span>
          
          <code class="ruby">      $logger = options[:logger] || Logger.new(&#39;pubnub.log&#39;)</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="316">
          <span class="hits">910</span>
          
          <code class="ruby">      @env = symbolize_options_keys(options)</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="317">
          <span class="hits">910</span>
          
          <code class="ruby">      @env = set_default_values(@env)</code>
        </li>
      
        <li class="covered" data-hits="18370" data-linenumber="318">
          <span class="hits">18370</span>
          
          <code class="ruby">      @env.delete_if { |k,v| v.blank? } # nillify if blank</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="319">
          <span class="hits">910</span>
          
          <code class="ruby">      @async_events = Array.new</code>
        </li>
      
        <li class="covered" data-hits="1820" data-linenumber="320">
          <span class="hits">1820</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&quot;\n\nCreated new Pubnub::Client instance&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="321">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">    def create_connections_pools(options)</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="324">
          <span class="hits">910</span>
          
          <code class="ruby">      @subscribe_event_connections_pool = Hash.new</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="325">
          <span class="hits">910</span>
          
          <code class="ruby">      @single_event_connections_pool    = Hash.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_default_values(env)</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="329">
          <span class="hits">910</span>
          
          <code class="ruby">      defaults = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">          :error_callback             =&gt; DEFAULT_ERROR_CALLBACK,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">          :connect_callback           =&gt; DEFAULT_CONNECT_CALLBACK,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">          :ssl                        =&gt; DEFAULT_SSL,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">          :timetoken                  =&gt; DEFAULT_TIMETOKEN,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="334">
          
          
          <code class="ruby">          :uuid                       =&gt; UUID.new.generate,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="335">
          
          
          <code class="ruby">          :port                       =&gt; DEFAULT_CONNECTION_PORT,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">          :origin                     =&gt; DEFAULT_ORIGIN,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="337">
          
          
          <code class="ruby">          :subscribe_timeout          =&gt; DEFAULT_SUBSCRIBE_TIMEOUT,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby">          :timeout                    =&gt; DEFAULT_NON_SUBSCRIBE_TIMEOUT,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">          :max_retries                =&gt; MAX_RETRIES,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="340">
          
          
          <code class="ruby">          :non_subscribe_timeout      =&gt; DEFAULT_NON_SUBSCRIBE_TIMEOUT,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby">          :reconnect_max_attempts     =&gt; DEFAULT_RECONNECT_ATTEMPTS,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">          :reconnect_retry_interval   =&gt; DEFAULT_RECONNECT_INTERVAL,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="343">
          
          
          <code class="ruby">          :reconnect_response_timeout =&gt; DEFAULT_RECONNECT_RESPONSE_TIMEOUT,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="344">
          
          
          <code class="ruby">          :ttl                        =&gt; DEFAULT_TTL,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">          :secret_key                 =&gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">      # Let&#39;s fill missing keys with default values</code>
        </li>
      
        <li class="covered" data-hits="1820" data-linenumber="349">
          <span class="hits">1820</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Setting default values&#39;}</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="350">
          <span class="hits">910</span>
          
          <code class="ruby">      defaults.each do |key,default_value|</code>
        </li>
      
        <li class="covered" data-hits="14560" data-linenumber="351">
          <span class="hits">14560</span>
          
          <code class="ruby">        env[key] = default_value if @env[key].nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="354">
          <span class="hits">910</span>
          
          <code class="ruby">      env</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">    def symbolize_options_keys(options)</code>
        </li>
      
        <li class="covered" data-hits="1820" data-linenumber="358">
          <span class="hits">1820</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Symbolizing options keys&#39;}</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="359">
          <span class="hits">910</span>
          
          <code class="ruby">      symbolized_options = {}</code>
        </li>
      
        <li class="covered" data-hits="6481" data-linenumber="360">
          <span class="hits">6481</span>
          
          <code class="ruby">      options.each_key { |k| symbolized_options.merge!({ k.to_sym =&gt; options[k] }) }</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="361">
          <span class="hits">910</span>
          
          <code class="ruby">      symbolized_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="364">
          <span class="hits">1</span>
          
          <code class="ruby">    def classify_method(method)</code>
        </li>
      
        <li class="covered" data-hits="2196" data-linenumber="365">
          <span class="hits">2196</span>
          
          <code class="ruby">      method.split(&#39;_&#39;).map{ |w| w.capitalize }.join</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="367">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!(parameters)</code>
        </li>
      
        <li class="covered" data-hits="918" data-linenumber="369">
          <span class="hits">918</span>
          
          <code class="ruby">      raise InitializationError.new(:object =&gt; self, :message =&gt; &#39;Origin parameter is not valid. Should be type of String&#39;)                  unless parameters[:origin].is_a?(String) || parameters[:origin].blank?</code>
        </li>
      
        <li class="covered" data-hits="918" data-linenumber="370">
          <span class="hits">918</span>
          
          <code class="ruby">      raise InitializationError.new(:object =&gt; self, :message =&gt; &#39;Missing required :subscribe_key parameter&#39;)                                unless parameters[:subscribe_key]</code>
        </li>
      
        <li class="covered" data-hits="916" data-linenumber="371">
          <span class="hits">916</span>
          
          <code class="ruby">      raise InitializationError.new(:object =&gt; self, :message =&gt; &#39;Subscribe key parameter is not valid. Should be type of String or Symbol&#39;) unless [String, Symbol].include?(parameters[:subscribe_key].class)</code>
        </li>
      
        <li class="covered" data-hits="913" data-linenumber="372">
          <span class="hits">913</span>
          
          <code class="ruby">      raise InitializationError.new(:object =&gt; self, :message =&gt; &#39;Publish key parameter is not valid. Should be type of String or Symbol&#39;)   unless [String, Symbol].include?(parameters[:publish_key].class) || parameters[:publish_key].blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="373">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="374">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4072703bac52be1810da25906abee4c805c961b1">
  <div class="header">
    <h3>lib/pubnub/configuration.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>29</b> relevant lines. 
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Configuration</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_ERROR_CALLBACK             = lambda { |err| puts err.inspect }</code>
        </li>
      
        <li class="covered" data-hits="484" data-linenumber="4">
          <span class="hits">484</span>
          
          <code class="ruby">    DEFAULT_CONNECT_CALLBACK           = lambda { |msg| msg.inspect }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_SSL                        = false</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_CONNECTION_PORT            = 80</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_NON_SUBSCRIBE_TIMEOUT      = 310</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_SUBSCRIBE_TIMEOUT          = 310</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_RECONNECT_ATTEMPTS         = 10</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_RECONNECT_INTERVAL         = 10</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_RECONNECT_RESPONSE_TIMEOUT = 10</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_TIMETOKEN                  = 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_ORIGIN                     = &#39;pubsub.pubnub.com&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_PORT                       = 80</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_METHOD                     = &#39;GET&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_CONTENT_TYPE               = &#39;application/json&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_PATH                       = &#39;/&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_PARAMS                     = {}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_HEADERS                    = {}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_SSL_SET                    = false</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_TIMEOUT                    = 5</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_ENCODING                   = nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_AUTO_RECONNECT             = true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_CALLBACK                   = lambda { |data| puts data }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_CHANNEL                    = &#39;hello_world&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    PERIODIC_TIMER_INTERVAL            = 0.25</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    MAX_RETRIES                        = 10</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    RETRIES_INTERVAL                   = 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    DEFAULT_TTL                        = 1440</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="edd18fe047bb4c555be3d79e75a773953da761c9">
  <div class="header">
    <h3>lib/pubnub/crypto.rb</h3>
    <h4><span class="green">91.67 %</span> covered</h4>
    <div>
      <b>36</b> relevant lines. 
      <span class="green"><b>33</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># TODO that file isn&#39;t refactored yet!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  class Crypto</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(cipher_key)</code>
        </li>
      
        <li class="covered" data-hits="306" data-linenumber="5">
          <span class="hits">306</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Initializing Crypto&#39;}</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="6">
          <span class="hits">153</span>
          
          <code class="ruby">      @alg = &#39;AES-256-CBC&#39;</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="7">
          <span class="hits">153</span>
          
          <code class="ruby">      sha256_key = Digest::SHA256.hexdigest(cipher_key)</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="8">
          <span class="hits">153</span>
          
          <code class="ruby">      @key = sha256_key.slice(0,32)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="10">
          <span class="hits">153</span>
          
          <code class="ruby">      @iv = &#39;0123456789012345&#39;</code>
        </li>
      
        <li class="covered" data-hits="306" data-linenumber="11">
          <span class="hits">306</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Initialized Crypto&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    def encrypt(message)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="17">
          <span class="hits">132</span>
          
          <code class="ruby">      aes = OpenSSL::Cipher::Cipher.new(@alg)</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="18">
          <span class="hits">132</span>
          
          <code class="ruby">      aes.encrypt</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="19">
          <span class="hits">132</span>
          
          <code class="ruby">      aes.key = @key</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="20">
          <span class="hits">132</span>
          
          <code class="ruby">      aes.iv = @iv</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="22">
          <span class="hits">132</span>
          
          <code class="ruby">      json_message = message.to_json</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="23">
          <span class="hits">132</span>
          
          <code class="ruby">      cipher = aes.update(json_message)</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="24">
          <span class="hits">132</span>
          
          <code class="ruby">      cipher &lt;&lt; aes.final</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="26">
          <span class="hits">132</span>
          
          <code class="ruby">      Base64.strict_encode64(cipher)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    def decrypt(cipher_text)</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="31">
          <span class="hits">42</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&quot;Decrypting: #{cipher_text}&quot;}</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="32">
          <span class="hits">21</span>
          
          <code class="ruby">      decode_cipher = OpenSSL::Cipher::Cipher.new(@alg)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="33">
          <span class="hits">21</span>
          
          <code class="ruby">      decode_cipher.decrypt</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="34">
          <span class="hits">21</span>
          
          <code class="ruby">      decode_cipher.key = @key</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="35">
          <span class="hits">21</span>
          
          <code class="ruby">      decode_cipher.iv = @iv</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="37">
          <span class="hits">21</span>
          
          <code class="ruby">      plain_text = &#39;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="39">
          <span class="hits">21</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="40">
          <span class="hits">21</span>
          
          <code class="ruby">        undecoded_text = Base64.decode64(cipher_text)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="41">
          <span class="hits">21</span>
          
          <code class="ruby">        plain_text = decode_cipher.update(undecoded_text)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="42">
          <span class="hits">21</span>
          
          <code class="ruby">        plain_text &lt;&lt; decode_cipher.final</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">        $logger.error(&#39;Pubnub&#39;){&#39;DECRYPTION ERROR&#39;}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">        plain_text = &#39;&quot;DECRYPTION ERROR&quot;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="48">
          <span class="hits">21</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="49">
          <span class="hits">21</span>
          
          <code class="ruby">        JSON.load(plain_text)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      rescue JSON::ParserError</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">        JSON.load(&quot;[#{plain_text}]&quot;)[0] # srsly ruby? srsly?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="54">
          <span class="hits">42</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Finished decrypting&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="56">
          <span class="hits">21</span>
          
          <code class="ruby">      plain_text</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fa35aa90972b3af15bdc905874d390b57459bb6f">
  <div class="header">
    <h3>lib/pubnub/envelope.rb</h3>
    <h4><span class="yellow">85.71 %</span> covered</h4>
    <div>
      <b>14</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Envelope</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    INSTANCE_VARIABLES = [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">        :channel,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">        :error,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">        :error_message,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">        :first,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">        :history_end,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">        :history_start,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">        :last,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">        :message,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">        :object,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">        :payload,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">        :response,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">        :response_message,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">        :service,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">        :status,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">        :timetoken,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">        :timetoken_update</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    INSTANCE_VARIABLES.each do |var_name|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="24">
          <span class="hits">16</span>
          
          <code class="ruby">      attr_accessor var_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    alias_method &#39;msg&#39;, &#39;message&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    alias_method &#39;status_code&#39;, &#39;status&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(parameters, app)</code>
        </li>
      
        <li class="covered" data-hits="1324" data-linenumber="31">
          <span class="hits">1324</span>
          
          <code class="ruby">      INSTANCE_VARIABLES.each do |var_name|</code>
        </li>
      
        <li class="covered" data-hits="21184" data-linenumber="32">
          <span class="hits">21184</span>
          
          <code class="ruby">        instance_variable_set(&quot;@#{var_name.to_s}&quot;, parameters[var_name])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    def is_last?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">      @last ? true : false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    def is_first?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">      @first ? true : false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3f25c00544b6a5ac0cc10955314fc915697314c7">
  <div class="header">
    <h3>lib/pubnub/event.rb</h3>
    <h4><span class="green">95.14 %</span> covered</h4>
    <div>
      <b>288</b> relevant lines. 
      <span class="green"><b>274</b> lines covered</span> and
      <span class="red"><b>14</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :fired, :finished</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="7">
          <span class="hits">1026</span>
          
          <code class="ruby">      @app              = app</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="8">
          <span class="hits">1026</span>
          
          <code class="ruby">      @origin           = options[:origin]          || app.env[:origin]</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="9">
          <span class="hits">1026</span>
          
          <code class="ruby">      @channel          = options[:channel]</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="10">
          <span class="hits">1026</span>
          
          <code class="ruby">      @message          = options[:message]</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="11">
          <span class="hits">1026</span>
          
          <code class="ruby">      @http_sync        = options[:http_sync]</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="12">
          <span class="hits">1026</span>
          
          <code class="ruby">      @callback         = options[:callback]</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="13">
          <span class="hits">1026</span>
          
          <code class="ruby">      @error_callback   = options[:error_callback]  || app.env[:error_callback]</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="14">
          <span class="hits">1026</span>
          
          <code class="ruby">      @connect_callback = options[:error_callback]  || app.env[:connect_callback]</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="15">
          <span class="hits">1026</span>
          
          <code class="ruby">      @ssl              = options[:ssl]             || app.env[:ssl]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="17">
          <span class="hits">1026</span>
          
          <code class="ruby">      @cipher_key       = app.env[:cipher_key]</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="18">
          <span class="hits">1026</span>
          
          <code class="ruby">      @secret_key       = app.env[:secret_key]</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="19">
          <span class="hits">1026</span>
          
          <code class="ruby">      @auth_key         = options[:auth_key]        || app.env[:auth_key]</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="20">
          <span class="hits">1026</span>
          
          <code class="ruby">      @publish_key      = app.env[:publish_key]</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="21">
          <span class="hits">1026</span>
          
          <code class="ruby">      @subscribe_key    = app.env[:subscribe_key]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="23">
          <span class="hits">1026</span>
          
          <code class="ruby">      @response         = nil</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="24">
          <span class="hits">1026</span>
          
          <code class="ruby">      @timetoken        = app.env[:timetoken] || 0</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="25">
          <span class="hits">1026</span>
          
          <code class="ruby">      validate!</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="26">
          <span class="hits">1026</span>
          
          <code class="ruby">      @original_channel = format_channels(@channel, false)</code>
        </li>
      
        <li class="covered" data-hits="1026" data-linenumber="27">
          <span class="hits">1026</span>
          
          <code class="ruby">      @channel          = format_channels(@channel)</code>
        </li>
      
        <li class="covered" data-hits="2052" data-linenumber="28">
          <span class="hits">2052</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&quot;Event#initialize | Initialized #{self.class.to_s}&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    def fire(app)</code>
        </li>
      
        <li class="covered" data-hits="1840" data-linenumber="32">
          <span class="hits">1840</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::Event#fire&#39;}</code>
        </li>
      
        <li class="covered" data-hits="920" data-linenumber="33">
          <span class="hits">920</span>
          
          <code class="ruby">      @fired = true</code>
        </li>
      
        <li class="covered" data-hits="1840" data-linenumber="34">
          <span class="hits">1840</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Event#fire&#39;}</code>
        </li>
      
        <li class="covered" data-hits="920" data-linenumber="35">
          <span class="hits">920</span>
          
          <code class="ruby">      setup_connection(app) unless connection_exist?(app)</code>
        </li>
      
        <li class="covered" data-hits="920" data-linenumber="36">
          <span class="hits">920</span>
          
          <code class="ruby">      envelopes = start_event(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def send_request(app)</code>
        </li>
      
        <li class="covered" data-hits="1147" data-linenumber="40">
          <span class="hits">1147</span>
          
          <code class="ruby">      if app.disabled_persistent_connection?</code>
        </li>
      
        <li class="covered" data-hits="516" data-linenumber="41">
          <span class="hits">516</span>
          
          <code class="ruby">        @response = Net::HTTP.get_response uri(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="631" data-linenumber="43">
          <span class="hits">631</span>
          
          <code class="ruby">        @response = get_connection(app).request(uri(app))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def start_event(app, count = 0)</code>
        </li>
      
        <li class="covered" data-hits="1592" data-linenumber="48">
          <span class="hits">1592</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="1592" data-linenumber="49">
          <span class="hits">1592</span>
          
          <code class="ruby">        if count &lt;= app.env[:max_retries]</code>
        </li>
      
        <li class="covered" data-hits="2296" data-linenumber="50">
          <span class="hits">2296</span>
          
          <code class="ruby">          $logger.debug(&#39;Pubnub&#39;){&#39;Event#start_event | sending request&#39;}</code>
        </li>
      
        <li class="covered" data-hits="2296" data-linenumber="51">
          <span class="hits">2296</span>
          
          <code class="ruby">          $logger.debug(&#39;Pubnub&#39;){&quot;Event#start_event | tt: #{@timetoken}; ctt #{app.env[:timetoken]}&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1148" data-linenumber="52">
          <span class="hits">1148</span>
          
          <code class="ruby">          @response = send_request(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1563" data-linenumber="55">
          <span class="hits">1563</span>
          
          <code class="ruby">        error = response_error(@response, app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1563" data-linenumber="57">
          <span class="hits">1563</span>
          
          <code class="ruby">        if ![error].flatten.include?(:json) || count &gt; app.env[:max_retries]</code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="58">
          <span class="hits">1138</span>
          
          <code class="ruby">          handle_response(@response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="425" data-linenumber="60">
          <span class="hits">425</span>
          
          <code class="ruby">          start_event(app, count + 1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="62">
          <span class="hits">26</span>
          
          <code class="ruby">      rescue =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="63">
          <span class="hits">52</span>
          
          <code class="ruby">        $logger.error(&#39;Pubnub&#39;){e.inspect}</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="64">
          <span class="hits">26</span>
          
          <code class="ruby">        if count &lt;= app.env[:max_retries]</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="65">
          <span class="hits">26</span>
          
          <code class="ruby">          start_event(app, count + 1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">          $logger.error(&#39;Pubnub&#39;){&quot;Aborting #{self.class} event due to network errors and reaching max retries&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="959" data-linenumber="73">
          <span class="hits">959</span>
          
          <code class="ruby">      if @allow_multiple_channels == true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">        raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid channel(s) format! Should be type of: String, Symbol, or Array of both&#39;) unless valid_channel?(true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">      elsif @allow_multiple_channels == false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">        raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid channel(s) format! Should be type of: String, Symbol&#39;) unless valid_channel?(false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="959" data-linenumber="79">
          <span class="hits">959</span>
          
          <code class="ruby">      unless @doesnt_require_callback</code>
        </li>
      
        <li class="covered" data-hits="959" data-linenumber="80">
          <span class="hits">959</span>
          
          <code class="ruby">        raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Callback parameter is required while using async&#39;) if (!@http_sync &amp;&amp; @callback.blank?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">    def response_error(response, app)</code>
        </li>
      
        <li class="covered" data-hits="1563" data-linenumber="88">
          <span class="hits">1563</span>
          
          <code class="ruby">      if Parser.valid_json?(response.body) &amp;&amp; (200..206).include?(response.code.to_i)</code>
        </li>
      
        <li class="covered" data-hits="483" data-linenumber="89">
          <span class="hits">483</span>
          
          <code class="ruby">        error = false</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="90">
          <span class="hits">216</span>
          
          <code class="ruby">      elsif Parser.valid_json?(response.body) &amp;&amp; !(200..206).include?(response.code.to_i)</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="91">
          <span class="hits">216</span>
          
          <code class="ruby">        error = [:code]</code>
        </li>
      
        <li class="covered" data-hits="864" data-linenumber="92">
          <span class="hits">864</span>
          
          <code class="ruby">      elsif !Parser.valid_json?(response.body) &amp;&amp; (200..206).include?(response.code.to_i)</code>
        </li>
      
        <li class="covered" data-hits="425" data-linenumber="93">
          <span class="hits">425</span>
          
          <code class="ruby">        error = [:json]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="439" data-linenumber="95">
          <span class="hits">439</span>
          
          <code class="ruby">        error = [:code, :json]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1563" data-linenumber="98">
          <span class="hits">1563</span>
          
          <code class="ruby">      error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">    def handle_response(response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2276" data-linenumber="103">
          <span class="hits">2276</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Event#handle_response&#39;}</code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="104">
          <span class="hits">1138</span>
          
          <code class="ruby">      envelopes = format_envelopes(response, app, error)</code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="105">
          <span class="hits">1138</span>
          
          <code class="ruby">      update_app_timetoken(envelopes, app)</code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="106">
          <span class="hits">1138</span>
          
          <code class="ruby">      fire_callbacks(envelopes,app)</code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="107">
          <span class="hits">1138</span>
          
          <code class="ruby">      @finished = true</code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="108">
          <span class="hits">1138</span>
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">    def update_app_timetoken(envelopes, app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      # stub</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">    def fire_callbacks(envelopes, app)</code>
        </li>
      
        <li class="covered" data-hits="1840" data-linenumber="117">
          <span class="hits">1840</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Firing callbacks&#39;}</code>
        </li>
      
        <li class="covered" data-hits="920" data-linenumber="118">
          <span class="hits">920</span>
          
          <code class="ruby">      envelopes.each do |envelope|</code>
        </li>
      
        <li class="covered" data-hits="991" data-linenumber="119">
          <span class="hits">991</span>
          
          <code class="ruby">        @callback.call(envelope)       if !envelope.error &amp;&amp; @callback &amp;&amp; !envelope.timetoken_update</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">        #if envelope.timetoken_update || envelope.timetoken.to_i &gt; app.env[:timetoken].to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">        #  update_timetoken(app, envelope.timetoken)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">        #end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="920" data-linenumber="124">
          <span class="hits">920</span>
          
          <code class="ruby">      @error_callback.call(envelopes.first) if envelopes.first.error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">    def update_timetoken(app, timetoken)</code>
        </li>
      
        <li class="covered" data-hits="327" data-linenumber="129">
          <span class="hits">327</span>
          
          <code class="ruby">      @timetoken = timetoken.to_i</code>
        </li>
      
        <li class="covered" data-hits="327" data-linenumber="130">
          <span class="hits">327</span>
          
          <code class="ruby">      app.update_timetoken(timetoken.to_i)</code>
        </li>
      
        <li class="covered" data-hits="654" data-linenumber="131">
          <span class="hits">654</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&quot;Updated timetoken to #{timetoken}&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">    def add_common_data_to_envelopes(envelopes, response, app, error)</code>
        </li>
      
        <li class="covered" data-hits="2276" data-linenumber="135">
          <span class="hits">2276</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Event#add_common_data_to_envelopes&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="137">
          <span class="hits">1138</span>
          
          <code class="ruby">      envelopes.each do |envelope|</code>
        </li>
      
        <li class="covered" data-hits="1324" data-linenumber="138">
          <span class="hits">1324</span>
          
          <code class="ruby">        envelope.response      = response.body</code>
        </li>
      
        <li class="covered" data-hits="1324" data-linenumber="139">
          <span class="hits">1324</span>
          
          <code class="ruby">        envelope.object        = response</code>
        </li>
      
        <li class="covered" data-hits="1324" data-linenumber="140">
          <span class="hits">1324</span>
          
          <code class="ruby">        envelope.status        = response.code.to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="143">
          <span class="hits">1138</span>
          
          <code class="ruby">      envelopes.last.last   = true</code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="144">
          <span class="hits">1138</span>
          
          <code class="ruby">      envelopes.first.first = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="146">
          <span class="hits">1138</span>
          
          <code class="ruby">      envelopes = insert_errors(envelopes, error, app) if error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="148">
          <span class="hits">1138</span>
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">    def insert_errors(envelopes, error_symbol, app)</code>
        </li>
      
        <li class="covered" data-hits="655" data-linenumber="152">
          <span class="hits">655</span>
          
          <code class="ruby">      case error_symbol</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">        when [:json]</code>
        </li>
      
        <li class="covered" data-hits="212" data-linenumber="154">
          <span class="hits">212</span>
          
          <code class="ruby">          error_message = &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="212" data-linenumber="155">
          <span class="hits">212</span>
          
          <code class="ruby">          error         = JSONParseError.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">              :app     =&gt; app,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">              :message =&gt; error_message,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">              :request =&gt; self.class,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">              :response =&gt; @response.body,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">              :error    =&gt; error_symbol</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">        when [:code]</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="163">
          <span class="hits">216</span>
          
          <code class="ruby">          error_message = &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="164">
          <span class="hits">216</span>
          
          <code class="ruby">          error         = ResponseError.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">              :app     =&gt; app,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">              :message =&gt; error_message,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">              :request =&gt; self.class,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">              :response =&gt; @response.body,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">              :error    =&gt; error_symbol</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">        when [:code, :json]</code>
        </li>
      
        <li class="covered" data-hits="227" data-linenumber="172">
          <span class="hits">227</span>
          
          <code class="ruby">          error_message = &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="227" data-linenumber="173">
          <span class="hits">227</span>
          
          <code class="ruby">          error         = ResponseError.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">              :app     =&gt; app,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">              :message =&gt; error_message,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">              :request =&gt; self.class,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">              :response =&gt; @response.body,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">              :error    =&gt; error_symbol</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="181">
          
          
          <code class="ruby">          error_message = &#39;[0, &quot;Unknown Error.&quot;]&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="182">
          
          
          <code class="ruby">          error         = Error.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">              :app     =&gt; app,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">              :message =&gt; error_message,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">              :request =&gt; self.class,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">              :response =&gt; @response.body,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">              :error    =&gt; error_symbol</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="655" data-linenumber="191">
          <span class="hits">655</span>
          
          <code class="ruby">      envelopes.first.error   = error</code>
        </li>
      
        <li class="covered" data-hits="655" data-linenumber="192">
          <span class="hits">655</span>
          
          <code class="ruby">      envelopes.first.message = error_message</code>
        </li>
      
        <li class="covered" data-hits="655" data-linenumber="193">
          <span class="hits">655</span>
          
          <code class="ruby">      envelopes.first.last = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="655" data-linenumber="195">
          <span class="hits">655</span>
          
          <code class="ruby">      [envelopes.first]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">    def uri(app)</code>
        </li>
      
        <li class="covered" data-hits="2294" data-linenumber="199">
          <span class="hits">2294</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&quot;#{self.class}#uri #{[origin(app), path(app), &#39;?&#39;, params_hash_to_url_params(parameters(app))].join}&quot;}</code>
        </li>
      
        <li class="covered" data-hits="1147" data-linenumber="200">
          <span class="hits">1147</span>
          
          <code class="ruby">      URI [origin(app), path(app), &#39;?&#39;, params_hash_to_url_params(parameters(app))].join</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">    def origin(app)</code>
        </li>
      
        <li class="covered" data-hits="2294" data-linenumber="204">
          <span class="hits">2294</span>
          
          <code class="ruby">      h = @ssl ? &#39;https://&#39; : &#39;http://&#39;</code>
        </li>
      
        <li class="covered" data-hits="2294" data-linenumber="205">
          <span class="hits">2294</span>
          
          <code class="ruby">      h + @origin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">    def parameters(app)</code>
        </li>
      
        <li class="covered" data-hits="2294" data-linenumber="209">
          <span class="hits">2294</span>
          
          <code class="ruby">      required = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">          :pnsdk =&gt; &quot;PubNub-Ruby/#{Pubnub::VERSION}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2294" data-linenumber="213">
          <span class="hits">2294</span>
          
          <code class="ruby">      empty_if_blank = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby">          :auth =&gt; @auth_key,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">          :uuid =&gt; app.env[:uuid]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6882" data-linenumber="218">
          <span class="hits">6882</span>
          
          <code class="ruby">      empty_if_blank.delete_if {|k, v| v.blank? }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2294" data-linenumber="220">
          <span class="hits">2294</span>
          
          <code class="ruby">      required.merge(empty_if_blank)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">  module SingleEvent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">    def fire(app)</code>
        </li>
      
        <li class="covered" data-hits="2048" data-linenumber="228">
          <span class="hits">2048</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::SingleEvent#fire&#39;}</code>
        </li>
      
        <li class="covered" data-hits="1024" data-linenumber="229">
          <span class="hits">1024</span>
          
          <code class="ruby">      if @http_sync</code>
        </li>
      
        <li class="covered" data-hits="672" data-linenumber="230">
          <span class="hits">672</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::SingleEvent#fire | Sync event!&#39;}</code>
        </li>
      
        <li class="covered" data-hits="336" data-linenumber="231">
          <span class="hits">336</span>
          
          <code class="ruby">        super(app)</code>
        </li>
      
        <li class="covered" data-hits="688" data-linenumber="232">
          <span class="hits">688</span>
          
          <code class="ruby">      elsif app.async_events.include? self</code>
        </li>
      
        <li class="covered" data-hits="686" data-linenumber="233">
          <span class="hits">686</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::SingleEvent#fire | Event already on list!&#39;}</code>
        </li>
      
        <li class="covered" data-hits="343" data-linenumber="234">
          <span class="hits">343</span>
          
          <code class="ruby">        super(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="690" data-linenumber="236">
          <span class="hits">690</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::SingleEvent#fire | Adding event to async_events&#39;}</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="237">
          <span class="hits">345</span>
          
          <code class="ruby">        app.async_events &lt;&lt; self</code>
        </li>
      
        <li class="covered" data-hits="690" data-linenumber="238">
          <span class="hits">690</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Pubnub::SingleEvent#fire | Starting railgun&#39;}</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="239">
          <span class="hits">345</span>
          
          <code class="ruby">        app.start_railgun</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">    def setup_connection(app)</code>
        </li>
      
        <li class="covered" data-hits="678" data-linenumber="246">
          <span class="hits">678</span>
          
          <code class="ruby">      app.single_event_connections_pool[@origin] = new_connection(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="249">
          <span class="hits">1</span>
          
          <code class="ruby">    def connection_exist?(app)</code>
        </li>
      
        <li class="covered" data-hits="679" data-linenumber="250">
          <span class="hits">679</span>
          
          <code class="ruby">      !app.single_event_connections_pool[@origin].nil? &amp;&amp; !app.single_event_connections_pool[@origin].nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_connection(app)</code>
        </li>
      
        <li class="covered" data-hits="356" data-linenumber="254">
          <span class="hits">356</span>
          
          <code class="ruby">      app.single_event_connections_pool[@origin]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">    def new_connection(app)</code>
        </li>
      
        <li class="covered" data-hits="678" data-linenumber="258">
          <span class="hits">678</span>
          
          <code class="ruby">      unless app.disabled_persistent_connection?</code>
        </li>
      
        <li class="covered" data-hits="354" data-linenumber="259">
          <span class="hits">354</span>
          
          <code class="ruby">        connection = Net::HTTP::Persistent.new &quot;pubnub_ruby_client_v#{Pubnub::VERSION}&quot;</code>
        </li>
      
        <li class="covered" data-hits="354" data-linenumber="260">
          <span class="hits">354</span>
          
          <code class="ruby">        connection.idle_timeout   = app.env[:subscribe_timeout]</code>
        </li>
      
        <li class="covered" data-hits="354" data-linenumber="261">
          <span class="hits">354</span>
          
          <code class="ruby">        connection.read_timeout   = app.env[:subscribe_timeout]</code>
        </li>
      
        <li class="covered" data-hits="354" data-linenumber="262">
          <span class="hits">354</span>
          
          <code class="ruby">        @connect_callback.call &quot;New subscribe connection to #{@origin}&quot;</code>
        </li>
      
        <li class="covered" data-hits="354" data-linenumber="263">
          <span class="hits">354</span>
          
          <code class="ruby">        connection.proxy_from_env</code>
        </li>
      
        <li class="covered" data-hits="354" data-linenumber="264">
          <span class="hits">354</span>
          
          <code class="ruby">        connection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">  module SubscribeEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">    def fire(app)</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="271">
          <span class="hits">345</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="690" data-linenumber="272">
          <span class="hits">690</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;SubscribeEvent#fire&#39;}</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="273">
          <span class="hits">345</span>
          
          <code class="ruby">        if @http_sync</code>
        </li>
      
        <li class="covered" data-hits="482" data-linenumber="274">
          <span class="hits">482</span>
          
          <code class="ruby">          $logger.debug(&#39;Pubnub&#39;){&#39;SubscribeEvent#fire sync&#39;}</code>
        </li>
      
        <li class="covered" data-hits="241" data-linenumber="275">
          <span class="hits">241</span>
          
          <code class="ruby">          if self.class == Pubnub::Subscribe &amp;&amp; app.env[:heartbeat]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">            app.heartbeat(:channel =&gt; @channel, :http_sync =&gt; true)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">            envelopes = super</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">            @channel.each do |channel|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="279">
          <span class="hits">1</span>
          
          <code class="ruby">              app.leave(:channel =&gt; channel, :http_sync =&gt; true, :skip_remove =&gt; true, :force =&gt; true) unless (app.env[:subscriptions][@origin] &amp;&amp; app.env[:subscriptions][@origin].get_channels.include(channel))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="240" data-linenumber="282">
          <span class="hits">240</span>
          
          <code class="ruby">            envelopes = super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="241" data-linenumber="284">
          <span class="hits">241</span>
          
          <code class="ruby">          envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="208" data-linenumber="286">
          <span class="hits">208</span>
          
          <code class="ruby">          $logger.debug(&#39;Pubnub&#39;){&#39;SubscribeEvent#fire async&#39;}</code>
        </li>
      
        <li class="covered" data-hits="208" data-linenumber="287">
          <span class="hits">208</span>
          
          <code class="ruby">          $logger.debug(&#39;Pubnub&#39;){&quot;Channel: #{@channel}&quot;}</code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="288">
          <span class="hits">104</span>
          
          <code class="ruby">          setup_connection(app) unless connection_exist?(app)</code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="289">
          <span class="hits">104</span>
          
          <code class="ruby">          unless app.env[:subscriptions][@origin].blank?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="290">
          <span class="hits">2</span>
          
          <code class="ruby">            @channel.each do |channel|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="291">
          <span class="hits">2</span>
          
          <code class="ruby">              if app.env[:subscriptions][@origin].get_channels.include?(channel)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="292">
          
          
          <code class="ruby">                @channel.delete(channel)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="293">
          
          
          <code class="ruby">                $logger.error(&#39;Pubnub&#39;){&quot;Already subscribed to channel #{channel}, you have to leave that channel first&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="297">
          <span class="hits">2</span>
          
          <code class="ruby">            @channel.each do |channel|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="298">
          <span class="hits">4</span>
          
          <code class="ruby">              $logger.debug(&#39;Pubnub&#39;){&#39;SubscribeEvent#add_channel | Adding channel&#39;}</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="299">
          <span class="hits">2</span>
          
          <code class="ruby">              app.env[:subscriptions][@origin].add_channel(channel, app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="302">
          <span class="hits">2</span>
          
          <code class="ruby">            if @channel.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="303">
          
          
          <code class="ruby">              false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="305">
          <span class="hits">2</span>
          
          <code class="ruby">              app.start_respirator</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="306">
          <span class="hits">2</span>
          
          <code class="ruby">              true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="310">
          <span class="hits">104</span>
          
          <code class="ruby">          if app.env[:subscriptions][@origin].nil?</code>
        </li>
      
        <li class="covered" data-hits="102" data-linenumber="311">
          <span class="hits">102</span>
          
          <code class="ruby">            app.env[:subscriptions][@origin]        = self            if app.env[:subscriptions][@origin].nil?</code>
        </li>
      
        <li class="covered" data-hits="102" data-linenumber="312">
          <span class="hits">102</span>
          
          <code class="ruby">            app.env[:callbacks_pool][@origin]       = Hash.new        if app.env[:callbacks_pool][@origin].nil?</code>
        </li>
      
        <li class="covered" data-hits="102" data-linenumber="313">
          <span class="hits">102</span>
          
          <code class="ruby">            app.env[:error_callbacks_pool][@origin] = @error_callback if app.env[:error_callbacks_pool][@origin].nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="314">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="102" data-linenumber="315">
          <span class="hits">102</span>
          
          <code class="ruby">            @channel.each do |channel|</code>
        </li>
      
        <li class="covered" data-hits="102" data-linenumber="316">
          <span class="hits">102</span>
          
          <code class="ruby">              app.env[:callbacks_pool][@origin][channel] = Hash.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="102" data-linenumber="318">
          <span class="hits">102</span>
          
          <code class="ruby">              app.env[:callbacks_pool][@origin][channel][:callback]       = @callback       unless app.env[:callbacks_pool][@origin][:callback]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="320">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="321">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="322">
          <span class="hits">2</span>
          
          <code class="ruby">            @channel.each do |channel|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="323">
          <span class="hits">2</span>
          
          <code class="ruby">              app.env[:callbacks_pool][@origin][channel] = Hash.new</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="324">
          <span class="hits">2</span>
          
          <code class="ruby">              app.env[:callbacks_pool][@origin][channel] = Hash.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="326">
          <span class="hits">2</span>
          
          <code class="ruby">              app.env[:callbacks_pool][@origin][channel][:callback]       = @callback       unless app.env[:callbacks_pool][@origin][:callback]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="327">
          <span class="hits">2</span>
          
          <code class="ruby">              app.env[:callbacks_pool][@origin][channel][:error_callback] = @error_callback unless app.env[:callbacks_pool][@origin][:error_callback]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="331">
          <span class="hits">104</span>
          
          <code class="ruby">          app.start_subscribe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="334">
          
          
          <code class="ruby">      rescue =&gt; error</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="335">
          
          
          <code class="ruby">        $logger.error(&#39;Pubnub&#39;){error}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="337">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_timetoken(timetoken)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="340">
          
          
          <code class="ruby">      @timetoken = timetoken</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">    def add_channel(channel, app)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="344">
          <span class="hits">2</span>
          
          <code class="ruby">      @channel = @channel + format_channels(channel)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="345">
          <span class="hits">4</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;SubscribeEvent#add_channel | Added channel&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="348">
          <span class="hits">1</span>
          
          <code class="ruby">    def remove_channel(channel, app)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="349">
          <span class="hits">3</span>
          
          <code class="ruby">      @channel = @channel - format_channels(channel)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="350">
          <span class="hits">6</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;SubscribeEvent#remove_channel | Removed channel&#39;}</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="351">
          <span class="hits">3</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="352">
          <span class="hits">3</span>
          
          <code class="ruby">        shutdown_subscribe(app) if @channel.empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="353">
          
          
          <code class="ruby">      rescue =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="354">
          
          
          <code class="ruby">        $logger.error(&#39;Pubnub&#39;){e.message}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="355">
          
          
          <code class="ruby">        $logger.error(&#39;Pubnub&#39;){e.backtrace}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_channels</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="360">
          <span class="hits">13</span>
          
          <code class="ruby">      @channel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">    def parameters(app)</code>
        </li>
      
        <li class="covered" data-hits="934" data-linenumber="366">
          <span class="hits">934</span>
          
          <code class="ruby">      parameters = super(app)</code>
        </li>
      
        <li class="covered" data-hits="934" data-linenumber="367">
          <span class="hits">934</span>
          
          <code class="ruby">      parameters.merge!({:heartbeat =&gt; app.env[:heartbeat]})                 if app.env[:heartbeat]</code>
        </li>
      
        <li class="covered" data-hits="934" data-linenumber="368">
          <span class="hits">934</span>
          
          <code class="ruby">      parameters.merge!({:state  =&gt; encode_state(app.env[:state][@origin])}) if app.env[:state] &amp;&amp; app.env[:state][@origin]</code>
        </li>
      
        <li class="covered" data-hits="934" data-linenumber="369">
          <span class="hits">934</span>
          
          <code class="ruby">      parameters</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="370">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">    def encode_state(state)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="373">
          <span class="hits">6</span>
          
          <code class="ruby">      URI.encode_www_form_component(state.to_json).gsub(&#39;+&#39;, &#39;%20&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="374">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">    def update_app_timetoken(envelopes, app)</code>
        </li>
      
        <li class="covered" data-hits="918" data-linenumber="377">
          <span class="hits">918</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Event#update_app_timetoken&#39;}</code>
        </li>
      
        <li class="covered" data-hits="459" data-linenumber="378">
          <span class="hits">459</span>
          
          <code class="ruby">      envelopes.each do |envelope|</code>
        </li>
      
        <li class="covered" data-hits="613" data-linenumber="379">
          <span class="hits">613</span>
          
          <code class="ruby">        if envelope.timetoken_update || envelope.timetoken.to_i &gt; app.env[:timetoken].to_i</code>
        </li>
      
        <li class="covered" data-hits="327" data-linenumber="380">
          <span class="hits">327</span>
          
          <code class="ruby">          update_timetoken(app, envelope.timetoken)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="459" data-linenumber="383">
          <span class="hits">459</span>
          
          <code class="ruby">      app.env[:wait_for_response][@origin] = false unless @http_sync</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="385">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">    def shutdown_subscribe(app)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">      app.env[:subscriptions][@origin]  = nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">      app.env[:subscriptions].delete(@origin)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">      app.env[:callbacks_pool][@origin] = nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">      app.env[:callbacks_pool].delete(@origin)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">      app.subscribe_event_connections_pool[@origin].shutdown_in_all_threads</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="392">
          <span class="hits">1</span>
          
          <code class="ruby">      app.subscribe_event_connections_pool[@origin] = nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="393">
          <span class="hits">1</span>
          
          <code class="ruby">      app.subscribe_event_connections_pool.delete(@origin)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">    def fire_callbacks(envelopes, app)</code>
        </li>
      
        <li class="covered" data-hits="459" data-linenumber="397">
          <span class="hits">459</span>
          
          <code class="ruby">      if @http_sync</code>
        </li>
      
        <li class="covered" data-hits="241" data-linenumber="398">
          <span class="hits">241</span>
          
          <code class="ruby">        super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="399">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="218" data-linenumber="400">
          <span class="hits">218</span>
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="covered" data-hits="436" data-linenumber="401">
          <span class="hits">436</span>
          
          <code class="ruby">          $logger.debug(&#39;Pubnub&#39;){&#39;Event#fire_callbacks async&#39;}</code>
        </li>
      
        <li class="covered" data-hits="218" data-linenumber="402">
          <span class="hits">218</span>
          
          <code class="ruby">          envelopes.each do |envelope|</code>
        </li>
      
        <li class="covered" data-hits="234" data-linenumber="403">
          <span class="hits">234</span>
          
          <code class="ruby">            app.env[:callbacks_pool][@origin][envelope.channel][:callback].call(envelope) if !envelope.error &amp;&amp; !envelope.timetoken_update</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="404">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="422" data-linenumber="405">
          <span class="hits">422</span>
          
          <code class="ruby">          $logger.debug(&#39;Pubnub&#39;){&#39;We can send next request now&#39;}</code>
        </li>
      
        <li class="covered" data-hits="211" data-linenumber="406">
          <span class="hits">211</span>
          
          <code class="ruby">          app.env[:error_callbacks_pool][@origin].call(envelopes.first) if envelopes.first.error</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="407">
          <span class="hits">22</span>
          
          <code class="ruby">        rescue =&gt; error</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="408">
          <span class="hits">44</span>
          
          <code class="ruby">          $logger.error(&#39;Pubnub&#39;){error}</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="409">
          <span class="hits">44</span>
          
          <code class="ruby">          $logger.error(&#39;Pubnub&#39;){error.backtrace}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="459" data-linenumber="411">
          <span class="hits">459</span>
          
          <code class="ruby">      end unless envelopes.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">    def setup_connection(app)</code>
        </li>
      
        <li class="covered" data-hits="273" data-linenumber="416">
          <span class="hits">273</span>
          
          <code class="ruby">      app.subscribe_event_connections_pool[@origin] = new_connection(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="417">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="418">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">    def connection_exist?(app)</code>
        </li>
      
        <li class="covered" data-hits="345" data-linenumber="420">
          <span class="hits">345</span>
          
          <code class="ruby">      !app.subscribe_event_connections_pool[@origin].nil? &amp;&amp; !app.subscribe_event_connections_pool[@origin].nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_connection(app)</code>
        </li>
      
        <li class="covered" data-hits="275" data-linenumber="424">
          <span class="hits">275</span>
          
          <code class="ruby">      app.subscribe_event_connections_pool[@origin]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="426">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="427">
          <span class="hits">1</span>
          
          <code class="ruby">    def channels_for_url(channels)</code>
        </li>
      
        <li class="covered" data-hits="934" data-linenumber="428">
          <span class="hits">934</span>
          
          <code class="ruby">      channels.join(&#39;,&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="430">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(app)</code>
        </li>
      
        <li class="covered" data-hits="934" data-linenumber="432">
          <span class="hits">934</span>
          
          <code class="ruby">      path = URI.escape(&quot;/subscribe/#{@subscribe_key}/#{channels_for_url(@channel)}/0/#{@timetoken}&quot;).gsub(/\?/,&#39;%3F&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="433">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">    def timetoken(parsed_response)</code>
        </li>
      
        <li class="covered" data-hits="613" data-linenumber="436">
          <span class="hits">613</span>
          
          <code class="ruby">      parsed_response[1] if parsed_response.is_a? Array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="437">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="438">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">    def message(parsed_response, i, channel, app)</code>
        </li>
      
        <li class="covered" data-hits="232" data-linenumber="440">
          <span class="hits">232</span>
          
          <code class="ruby">      if app.env[:cipher_key].blank? || channel.index(&#39;-pnpres&#39;)</code>
        </li>
      
        <li class="covered" data-hits="211" data-linenumber="441">
          <span class="hits">211</span>
          
          <code class="ruby">        parsed_response.first[i]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="443">
          <span class="hits">21</span>
          
          <code class="ruby">        pc = Crypto.new(app.env[:cipher_key])</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="444">
          <span class="hits">21</span>
          
          <code class="ruby">        pc.decrypt(parsed_response.first[i])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="446">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">    def format_envelopes(response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="449">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="918" data-linenumber="450">
          <span class="hits">918</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Subscribe#format_envelopes&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="451">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="459" data-linenumber="452">
          <span class="hits">459</span>
          
          <code class="ruby">      parsed_response = Parser.parse_json(response.body) if Parser.valid_json?(response.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="453">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="918" data-linenumber="454">
          <span class="hits">918</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Subscribe#format_envelopes | Response parsed&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="459" data-linenumber="456">
          <span class="hits">459</span>
          
          <code class="ruby">      envelopes = Array.new</code>
        </li>
      
        <li class="covered" data-hits="459" data-linenumber="457">
          <span class="hits">459</span>
          
          <code class="ruby">      if error</code>
        </li>
      
        <li class="covered" data-hits="318" data-linenumber="458">
          <span class="hits">318</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Subscribe#format_envelopes | Error&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">        envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="460">
          
          
          <code class="ruby">            {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="461">
          
          
          <code class="ruby">                :channel           =&gt; @channel,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="462">
          
          
          <code class="ruby">                :timetoken         =&gt; timetoken(parsed_response)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="463">
          
          
          <code class="ruby">            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="464">
          
          
          <code class="ruby">            app</code>
        </li>
      
        <li class="covered" data-hits="159" data-linenumber="465">
          <span class="hits">159</span>
          
          <code class="ruby">        )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="466">
          
          
          <code class="ruby">      elsif parsed_response[0].empty?</code>
        </li>
      
        <li class="covered" data-hits="444" data-linenumber="467">
          <span class="hits">444</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Subscribe#format_envelopes | Timetoken&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="468">
          
          
          <code class="ruby">        envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="469">
          
          
          <code class="ruby">            {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="470">
          
          
          <code class="ruby">                :channel           =&gt; @channel.first,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">                :response_message  =&gt; parsed_response,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">                :timetoken         =&gt; timetoken(parsed_response),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">                :timetoken_update  =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">            app</code>
        </li>
      
        <li class="covered" data-hits="222" data-linenumber="476">
          <span class="hits">222</span>
          
          <code class="ruby">        )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="477">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="156" data-linenumber="478">
          <span class="hits">156</span>
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Subscribe#format_envelopes | Not timetoken update&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="479">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="78" data-linenumber="480">
          <span class="hits">78</span>
          
          <code class="ruby">        if parsed_response[2]</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="481">
          <span class="hits">12</span>
          
          <code class="ruby">          channels = parsed_response[2].split(&#39;,&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="482">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="483">
          <span class="hits">66</span>
          
          <code class="ruby">          channels = @channel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="484">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="78" data-linenumber="486">
          <span class="hits">78</span>
          
          <code class="ruby">        parsed_response[0].size.times do |i|</code>
        </li>
      
        <li class="covered" data-hits="232" data-linenumber="487">
          <span class="hits">232</span>
          
          <code class="ruby">          if channels.size &lt;= 1</code>
        </li>
      
        <li class="covered" data-hits="208" data-linenumber="488">
          <span class="hits">208</span>
          
          <code class="ruby">            channel = channels.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="490">
          <span class="hits">24</span>
          
          <code class="ruby">            channel = channels[i]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="491">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="464" data-linenumber="492">
          <span class="hits">464</span>
          
          <code class="ruby">          $logger.debug(&#39;Pubnub&#39;){&quot;Subscribe#format_envelopes | Channel #{channel} created&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="493">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="464" data-linenumber="494">
          <span class="hits">464</span>
          
          <code class="ruby">          $logger.debug(&#39;Pubnub&#39;){&quot;#{parsed_response}&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="495">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="496">
          
          
          <code class="ruby">          envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="497">
          
          
          <code class="ruby">              {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="498">
          
          
          <code class="ruby">                  :message           =&gt; message(parsed_response, i, channel, app),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="499">
          
          
          <code class="ruby">                  :channel           =&gt; channel,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="500">
          
          
          <code class="ruby">                  :response_message  =&gt; parsed_response,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="501">
          
          
          <code class="ruby">                  :timetoken         =&gt; timetoken(parsed_response)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="502">
          
          
          <code class="ruby">              },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">              app</code>
        </li>
      
        <li class="covered" data-hits="232" data-linenumber="504">
          <span class="hits">232</span>
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="464" data-linenumber="506">
          <span class="hits">464</span>
          
          <code class="ruby">          $logger.debug(&#39;Pubnub&#39;){&#39;Subscribe#format_envelopes | Envelopes created&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="508">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="509">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="510">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="918" data-linenumber="511">
          <span class="hits">918</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&#39;Subscribe#format_envelopes | envelopes created&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="512">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="459" data-linenumber="513">
          <span class="hits">459</span>
          
          <code class="ruby">      envelopes = add_common_data_to_envelopes(envelopes, response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="514">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="459" data-linenumber="515">
          <span class="hits">459</span>
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="516">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="517">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="519">
          <span class="hits">1</span>
          
          <code class="ruby">    def new_connection(app)</code>
        </li>
      
        <li class="covered" data-hits="273" data-linenumber="520">
          <span class="hits">273</span>
          
          <code class="ruby">      unless app.disabled_persistent_connection?</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="521">
          <span class="hits">129</span>
          
          <code class="ruby">        connection = Net::HTTP::Persistent.new &quot;pubnub_ruby_client_v#{Pubnub::VERSION}&quot;</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="522">
          <span class="hits">129</span>
          
          <code class="ruby">        connection.idle_timeout   = app.env[:subscribe_timeout]</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="523">
          <span class="hits">129</span>
          
          <code class="ruby">        connection.read_timeout   = app.env[:subscribe_timeout]</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="524">
          <span class="hits">129</span>
          
          <code class="ruby">        @connect_callback.call &quot;New subscribe connection to #{@origin}&quot;</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="525">
          <span class="hits">129</span>
          
          <code class="ruby">        connection.proxy_from_env</code>
        </li>
      
        <li class="covered" data-hits="129" data-linenumber="526">
          <span class="hits">129</span>
          
          <code class="ruby">        connection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="527">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="528">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="529">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="530">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="531">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b6a29fd7b2f3385a44ec0451125fefa368b53752">
  <div class="header">
    <h3>lib/pubnub/events/audit.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>20</b> relevant lines. 
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Audit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SingleEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::PAM</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="10">
          <span class="hits">67</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="11">
          <span class="hits">67</span>
          
          <code class="ruby">      @event = &#39;audit&#39;</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="12">
          <span class="hits">67</span>
          
          <code class="ruby">      @allow_multiple_channels = false</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="13">
          <span class="hits">67</span>
          
          <code class="ruby">      @timestamp = current_time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="17">
          <span class="hits">67</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;publish_key is required by Audit&#39;) unless @publish_key</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="18">
          <span class="hits">67</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Parameter secret_key is required by Audit&#39;) if !@secret_key || @secret_key == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    def parameters(app, signature = false)</code>
        </li>
      
        <li class="covered" data-hits="134" data-linenumber="25">
          <span class="hits">134</span>
          
          <code class="ruby">      { :timestamp =&gt; @timestamp }.merge(super(app, signature))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      &#39;/&#39; + [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">          &#39;v1&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">          &#39;auth&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">          &#39;audit&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">          &#39;sub-key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">          @subscribe_key</code>
        </li>
      
        <li class="covered" data-hits="134" data-linenumber="35">
          <span class="hits">134</span>
          
          <code class="ruby">      ].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="394a57470d2e428906fc141a7bb7259e4cb2c431">
  <div class="header">
    <h3>lib/pubnub/events/grant.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>30</b> relevant lines. 
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Grant</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SingleEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::PAM</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="10">
          <span class="hits">66</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="11">
          <span class="hits">66</span>
          
          <code class="ruby">      @event = &#39;grant&#39;</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="12">
          <span class="hits">66</span>
          
          <code class="ruby">      @allow_multiple_channels = false</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="13">
          <span class="hits">66</span>
          
          <code class="ruby">      @timestamp = current_time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="15">
          <span class="hits">66</span>
          
          <code class="ruby">      @write = options[:write]</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="16">
          <span class="hits">66</span>
          
          <code class="ruby">      @read  = options[:read]</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="17">
          <span class="hits">66</span>
          
          <code class="ruby">      @ttl   = options[:ttl]   || Pubnub::Configuration::DEFAULT_TTL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="21">
          <span class="hits">66</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="23">
          <span class="hits">66</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;publish_key is required by Grant&#39;) unless @publish_key</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="24">
          <span class="hits">66</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Parameter secret_key is required by Grant&#39;) if !@secret_key || @secret_key == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="26">
          <span class="hits">66</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;write parameter accept only one of: 1, &quot;1&quot;, 0, &quot;0&quot;, true, false values&#39;) unless [nil, 1, &#39;1&#39;, 0, &#39;0&#39;, true, false].include?(@write)</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="27">
          <span class="hits">66</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;read parameter accept only: 1, &quot;1&quot;, 0, &quot;0&quot;, true, false values&#39;) unless [nil, 1, &#39;1&#39;, 0, &#39;0&#39;, true, false].include?(@read)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="29">
          <span class="hits">66</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;ttl parameter is too big, max value is: 525600&#39;) unless @ttl.to_i &lt;= 525600 || @ttl.nil?</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="30">
          <span class="hits">66</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;ttl parameter can\&#39;t be negative&#39;)               unless @ttl.to_i &gt;= 0      || @ttl.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    def parameters(app, signature = false)</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="37">
          <span class="hits">132</span>
          
          <code class="ruby">      write = [0, &#39;0&#39;, false].include?(@write) ? 0 : 1</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="38">
          <span class="hits">132</span>
          
          <code class="ruby">      read =  [0, &#39;0&#39;, false].include?(@read) ? 0 : 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">          :timestamp =&gt; @timestamp,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">          :w         =&gt; write,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">          :r         =&gt; read,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">          :ttl       =&gt; @ttl</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="45">
          <span class="hits">132</span>
          
          <code class="ruby">      }.merge(super(app, signature))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      &#39;/&#39; + [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">          &#39;v1&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">          &#39;auth&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">          &#39;grant&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">          &#39;sub-key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">          @subscribe_key</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="55">
          <span class="hits">132</span>
          
          <code class="ruby">      ].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9e4ee83ac81a9069d89486f89f9ed6dfa020113c">
  <div class="header">
    <h3>lib/pubnub/events/heartbeat.rb</h3>
    <h4><span class="green">96.43 %</span> covered</h4>
    <div>
      <b>28</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Heartbeat</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SingleEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="9">
          <span class="hits">2</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="10">
          <span class="hits">2</span>
          
          <code class="ruby">      @event = &#39;heartbeat&#39;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="11">
          <span class="hits">2</span>
          
          <code class="ruby">      @allow_multiple_channels = true</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="12">
          <span class="hits">2</span>
          
          <code class="ruby">      @doesnt_require_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    def fire(app)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="16">
          <span class="hits">3</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      &#39;/&#39; + [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">          &#39;v2&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">          &#39;presence&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">          &#39;sub-key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">          @subscribe_key,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">          &#39;channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">          @channel.join(&#39;,&#39;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">          &#39;heartbeat&#39;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="30">
          <span class="hits">4</span>
          
          <code class="ruby">      ].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    def parameters(app)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="34">
          <span class="hits">4</span>
          
          <code class="ruby">      parameters = super(app)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="35">
          <span class="hits">4</span>
          
          <code class="ruby">      parameters.merge!({:state =&gt; encode_state(app.env[:state][@origin])}) if app.env[:state] &amp;&amp; app.env[:state][@origin]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="36">
          <span class="hits">4</span>
          
          <code class="ruby">      parameters</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def encode_state(state)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">      URI.encode_www_form_component(state.to_json).gsub(&#39;+&#39;, &#39;%20&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    def format_envelopes(response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="45">
          <span class="hits">2</span>
          
          <code class="ruby">      parsed_response = Parser.parse_json(response.body) if Parser.valid_json?(response.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="47">
          <span class="hits">2</span>
          
          <code class="ruby">      envelopes = Array.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">          {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">              :message           =&gt; parsed_response,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">              :response_message  =&gt; parsed_response</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">          },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">          app</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="54">
          <span class="hits">2</span>
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="56">
          <span class="hits">2</span>
          
          <code class="ruby">      envelopes = add_common_data_to_envelopes(envelopes, response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="58">
          <span class="hits">2</span>
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="22da7f3439c34256d94a62e395cb427c4e802f58">
  <div class="header">
    <h3>lib/pubnub/events/here_now.rb</h3>
    <h4><span class="green">92.31 %</span> covered</h4>
    <div>
      <b>26</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class HereNow</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SingleEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="9">
          <span class="hits">128</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="10">
          <span class="hits">128</span>
          
          <code class="ruby">      @channel = @channel.first</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="11">
          <span class="hits">128</span>
          
          <code class="ruby">      @allow_multiple_channels = false</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="12">
          <span class="hits">128</span>
          
          <code class="ruby">      @event = &#39;here_now&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="16">
          <span class="hits">128</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      # check channel</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="19">
          <span class="hits">128</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid channel format! Should be type of: String, Symbol&#39;) unless [String, Symbol, NilClass].include?(@channel.class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(app)</code>
        </li>
      
        <li class="covered" data-hits="256" data-linenumber="26">
          <span class="hits">256</span>
          
          <code class="ruby">      unless @channel.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">        &#39;/&#39; + [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">            &#39;v2&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">            &#39;presence&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">            &#39;sub-key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">            @subscribe_key,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">            &#39;channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">            @channel</code>
        </li>
      
        <li class="covered" data-hits="256" data-linenumber="34">
          <span class="hits">256</span>
          
          <code class="ruby">        ].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">        $logger.debug(&#39;Pubnub&#39;){&#39;Global here_now&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">        &#39;/&#39; + [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">            &#39;v2&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">            &#39;presence&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">            &#39;sub-key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">            @subscribe_key</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">        ].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">    def format_envelopes(response, app, error)</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="47">
          <span class="hits">128</span>
          
          <code class="ruby">      parsed_response = Parser.parse_json(response.body) if Parser.valid_json?(response.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="49">
          <span class="hits">128</span>
          
          <code class="ruby">      envelopes = Array.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">          {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">              :message           =&gt; parsed_response,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">              :channel           =&gt; @channel,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">              :response_message  =&gt; parsed_response</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">          },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">          app</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="57">
          <span class="hits">128</span>
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="59">
          <span class="hits">128</span>
          
          <code class="ruby">      envelopes = add_common_data_to_envelopes(envelopes, response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="61">
          <span class="hits">128</span>
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="bb51312c3d9b70dc9d583499138643b4e0527aed">
  <div class="header">
    <h3>lib/pubnub/events/history.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>48</b> relevant lines. 
      <span class="green"><b>48</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class History</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SingleEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="10">
          <span class="hits">64</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="11">
          <span class="hits">64</span>
          
          <code class="ruby">      @start   = options[:start]</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="12">
          <span class="hits">64</span>
          
          <code class="ruby">      @end     = options[:end]</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="13">
          <span class="hits">64</span>
          
          <code class="ruby">      @count   = options[:count]</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="14">
          <span class="hits">64</span>
          
          <code class="ruby">      @reverse = options[:reverse]</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="15">
          <span class="hits">64</span>
          
          <code class="ruby">      @event   = &#39;history&#39;</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="16">
          <span class="hits">64</span>
          
          <code class="ruby">      @allow_multiple_channels = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="21">
          <span class="hits">64</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      # check channel</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="24">
          <span class="hits">64</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;History requires :channel argument&#39;) unless @channel</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="25">
          <span class="hits">64</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid channel format! Should be type of: String, Symbol&#39;) unless [String, Symbol].include?(@channel.class)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      # check if history parameters are valid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      # start</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="30">
          <span class="hits">64</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid :start parameter, should be type of Integer, Fixnum or String&#39;) unless [String, Fixnum, Integer, NilClass].include?(@start.class)</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="31">
          <span class="hits">64</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid :start parameter, should be positive integer number&#39;) if !@start.to_i.integer? &amp;&amp; @start.to_i &lt;= 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      # end</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="34">
          <span class="hits">64</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid :end parameter, should be type of Integer, Fixnum or String&#39;) unless [String, Fixnum, Integer, NilClass].include?(@end.class)</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="35">
          <span class="hits">64</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid :end parameter, should be positive integer number&#39;) if !@end.to_i.integer? &amp;&amp; @end.to_i &lt;= 0</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="36">
          <span class="hits">64</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid :end parameter, should be bigger than :start parameter. If you want to get messages in reverse order, use :reverse =&gt; true at call.&#39;) if @start.to_i &gt;= @end.to_i &amp;&amp; !@start.nil? &amp;&amp; @end.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      # count</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="38">
          <span class="hits">64</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid :count parameter, should be type of Integer, Fixnum or String&#39;) unless [String, Fixnum, Integer, NilClass].include?(@count.class)</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="39">
          <span class="hits">64</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid :count parameter, should be positive integer number&#39;) if !@count.to_i.integer? &amp;&amp; @count.to_i &lt;= 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      &#39;/&#39; + [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">          &#39;v2&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">          &#39;history&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          &#39;sub-key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">          @subscribe_key,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">          &#39;channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">          @channel</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="52">
          <span class="hits">128</span>
          
          <code class="ruby">      ].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">    def parameters(app)</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="56">
          <span class="hits">128</span>
          
          <code class="ruby">      params = super(app)</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="57">
          <span class="hits">128</span>
          
          <code class="ruby">      params.merge!({ :start   =&gt; @start }) if @start</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="58">
          <span class="hits">128</span>
          
          <code class="ruby">      params.merge!({ :end     =&gt; @end   }) if @end</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="59">
          <span class="hits">128</span>
          
          <code class="ruby">      params.merge!({ :count   =&gt; @count }) if @count</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="60">
          <span class="hits">128</span>
          
          <code class="ruby">      params.merge!({ :reverse =&gt; &#39;true&#39; }) if @reverse</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="61">
          <span class="hits">128</span>
          
          <code class="ruby">      params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">    def timetoken(parsed_response)</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="65">
          <span class="hits">96</span>
          
          <code class="ruby">      parsed_response[2] if parsed_response.is_a? Array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">    def response_message(parsed_response)</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="69">
          <span class="hits">48</span>
          
          <code class="ruby">      parsed_response[1] if parsed_response.is_a? Array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">    def format_envelopes(response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="74">
          <span class="hits">64</span>
          
          <code class="ruby">      parsed_response = Parser.parse_json(response.body) if Parser.valid_json?(response.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="76">
          <span class="hits">64</span>
          
          <code class="ruby">      envelopes = Array.new</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="77">
          <span class="hits">64</span>
          
          <code class="ruby">      if error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">        envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">            {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">                :channel           =&gt; @channel,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">                :timetoken         =&gt; timetoken(parsed_response),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">                :history_start     =&gt; @start,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">                :history_end       =&gt; @end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">            },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">            app</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="86">
          <span class="hits">48</span>
          
          <code class="ruby">        )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="88">
          <span class="hits">16</span>
          
          <code class="ruby">        parsed_response.first.each do |message|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">          envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">              {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">                  :message           =&gt; message,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">                  :channel           =&gt; @channel.first,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">                  :response_message  =&gt; response_message(parsed_response),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">                  :timetoken         =&gt; timetoken(parsed_response),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">                  :history_start     =&gt; parsed_response[1],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">                  :history_end       =&gt; parsed_response[2]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">              },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">              app</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="99">
          <span class="hits">48</span>
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="104">
          <span class="hits">64</span>
          
          <code class="ruby">      envelopes = add_common_data_to_envelopes(envelopes, response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="106">
          <span class="hits">64</span>
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2a8b923d8ca6efa7f29970ca669786df0255b4de">
  <div class="header">
    <h3>lib/pubnub/events/leave.rb</h3>
    <h4><span class="green">95.12 %</span> covered</h4>
    <div>
      <b>41</b> relevant lines. 
      <span class="green"><b>39</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Leave</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SingleEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="10">
          <span class="hits">67</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="11">
          <span class="hits">67</span>
          
          <code class="ruby">      @event = &#39;leave&#39;</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="12">
          <span class="hits">67</span>
          
          <code class="ruby">      @allow_multiple_channels = true</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="13">
          <span class="hits">67</span>
          
          <code class="ruby">      @doesnt_require_callback = true</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="14">
          <span class="hits">67</span>
          
          <code class="ruby">      @force = options[:force]</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="15">
          <span class="hits">67</span>
          
          <code class="ruby">      @skip_remove = options[:skip_remove]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="19">
          <span class="hits">67</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      # check channel</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="22">
          <span class="hits">67</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Leave requires :channel argument&#39;) unless @channel</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="23">
          <span class="hits">67</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid channel format! Should be type of: String, Symbol, or Array of both&#39;) unless valid_channel?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    def fire(app)</code>
        </li>
      
        <li class="covered" data-hits="198" data-linenumber="27">
          <span class="hits">198</span>
          
          <code class="ruby">      $logger.debug(&#39;Pubnub&#39;){&quot;Pubnub::Leave#fire&quot;}</code>
        </li>
      
        <li class="covered" data-hits="99" data-linenumber="28">
          <span class="hits">99</span>
          
          <code class="ruby">      unless @left</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="29">
          <span class="hits">67</span>
          
          <code class="ruby">        app.update_timetoken(0)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">        if app.env[:subscriptions][@origin].nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">          $logger.error(&#39;Pubnub&#39;){&#39;There\&#39;s no subscription for that origin&#39;}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">          raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;You cannot leave channel that is not subscribed&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="34">
          <span class="hits">2</span>
          
          <code class="ruby">          @channel.each do |channel|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="35">
          <span class="hits">6</span>
          
          <code class="ruby">            $logger.debug(&#39;Pubnub&#39;){&quot;#{app.env[:subscriptions][@origin].get_channels.to_s}.include? #{channel}&quot;}</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="36">
          <span class="hits">3</span>
          
          <code class="ruby">            raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;You cannot leave channel that is not subscribed&#39;) unless app.env[:subscriptions][@origin].get_channels.include?(channel)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="38">
          <span class="hits">67</span>
          
          <code class="ruby">        end unless @force</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">        @channel.each do |channel|</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="40">
          <span class="hits">67</span>
          
          <code class="ruby">          app.env[:subscriptions][@origin].remove_channel(channel, app) if app.env[:subscriptions][@origin]</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="41">
          <span class="hits">67</span>
          
          <code class="ruby">          @left = true</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="42">
          <span class="hits">67</span>
          
          <code class="ruby">        end unless @skip_remove</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="99" data-linenumber="44">
          <span class="hits">99</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="99" data-linenumber="45">
          <span class="hits">99</span>
          
          <code class="ruby">      app.start_subscribe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      &#39;/&#39; + [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">          &#39;v2&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">          &#39;presence&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">          &#39;sub-key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">          @subscribe_key,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">          &#39;channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">          @channel.join(&#39;,&#39;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">          &#39;leave&#39;</code>
        </li>
      
        <li class="covered" data-hits="130" data-linenumber="59">
          <span class="hits">130</span>
          
          <code class="ruby">      ].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">    def format_envelopes(response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="64">
          <span class="hits">65</span>
          
          <code class="ruby">      parsed_response = Parser.parse_json(response.body) if Parser.valid_json?(response.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="66">
          <span class="hits">65</span>
          
          <code class="ruby">      envelopes = Array.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">          {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">              :message           =&gt; parsed_response,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">              :response_message  =&gt; parsed_response</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">          },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">          app</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="73">
          <span class="hits">65</span>
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="75">
          <span class="hits">65</span>
          
          <code class="ruby">      envelopes = add_common_data_to_envelopes(envelopes, response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="77">
          <span class="hits">65</span>
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a89a5563de3ee5ff8017dbf825e6d0b1689aada5">
  <div class="header">
    <h3>lib/pubnub/events/presence.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Presence</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SubscribeEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="192" data-linenumber="10">
          <span class="hits">192</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="384" data-linenumber="11">
          <span class="hits">384</span>
          
          <code class="ruby">      @channel = @channel.map {|c| c + &#39;-pnpres&#39;}</code>
        </li>
      
        <li class="covered" data-hits="192" data-linenumber="12">
          <span class="hits">192</span>
          
          <code class="ruby">      @event = &#39;presence&#39;</code>
        </li>
      
        <li class="covered" data-hits="192" data-linenumber="13">
          <span class="hits">192</span>
          
          <code class="ruby">      @allow_multiple_channels = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def fire(app)</code>
        </li>
      
        <li class="covered" data-hits="192" data-linenumber="18">
          <span class="hits">192</span>
          
          <code class="ruby">      app.update_timetoken(0)</code>
        </li>
      
        <li class="covered" data-hits="192" data-linenumber="19">
          <span class="hits">192</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="192" data-linenumber="23">
          <span class="hits">192</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      # Check channels</code>
        </li>
      
        <li class="covered" data-hits="192" data-linenumber="26">
          <span class="hits">192</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Presence requires :channel or :channels argument&#39;) unless @channel</code>
        </li>
      
        <li class="covered" data-hits="192" data-linenumber="27">
          <span class="hits">192</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid channel(s) format! Should be type of: String, Symbol, or Array of both&#39;) unless valid_channel?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2ed89d156002d4df47b5b8eba8a0f61805033237">
  <div class="header">
    <h3>lib/pubnub/events/publish.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>30</b> relevant lines. 
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Publish</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SingleEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="10">
          <span class="hits">136</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="11">
          <span class="hits">136</span>
          
          <code class="ruby">      @channel = @channel.first</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="12">
          <span class="hits">136</span>
          
          <code class="ruby">      @event = &#39;publish&#39;</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="13">
          <span class="hits">136</span>
          
          <code class="ruby">      @allow_multiple_channels = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="18">
          <span class="hits">136</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      # check message</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="20">
          <span class="hits">136</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Publish requires :message argument&#39;) unless @message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      # check channel/channels</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="23">
          <span class="hits">136</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Publish requires :channel or :channels argument&#39;) unless @channel</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="24">
          <span class="hits">136</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid channel(s) format! Should be type of: String, Symbol, or Array of both&#39;) unless valid_channel?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      &#39;/&#39; + [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">          &#39;publish&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">          @publish_key,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">          @subscribe_key,</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="34">
          <span class="hits">136</span>
          
          <code class="ruby">          if !@auth_key.blank? then @secret_key else &#39;0&#39; end,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">          @channel,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">          &#39;0&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">          format_message(@message)</code>
        </li>
      
        <li class="covered" data-hits="274" data-linenumber="38">
          <span class="hits">274</span>
          
          <code class="ruby">      ].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">    def timetoken(parsed_response)</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="42">
          <span class="hits">136</span>
          
          <code class="ruby">      parsed_response[2] if parsed_response.is_a? Array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    def response_message(parsed_response)</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="46">
          <span class="hits">136</span>
          
          <code class="ruby">      parsed_response[1] if parsed_response.is_a? Array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    def format_envelopes(response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="51">
          <span class="hits">136</span>
          
          <code class="ruby">      parsed_response = Parser.parse_json(response.body) if Parser.valid_json?(response.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="53">
          <span class="hits">136</span>
          
          <code class="ruby">      envelopes = Array.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">        {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">            :message           =&gt; @message,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">            :published_message =&gt; @message,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">            :channel           =&gt; @channel,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">            :response_message  =&gt; response_message(parsed_response),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">            :timetoken         =&gt; timetoken(parsed_response)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">        },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">        app</code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="63">
          <span class="hits">136</span>
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="65">
          <span class="hits">136</span>
          
          <code class="ruby">      envelopes = add_common_data_to_envelopes(envelopes, response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="136" data-linenumber="67">
          <span class="hits">136</span>
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="419b9acf0e41ff3db2ed4ce3c846fac7b81af4f4">
  <div class="header">
    <h3>lib/pubnub/events/revoke.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>28</b> relevant lines. 
      <span class="green"><b>28</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Revoke</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SingleEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::PAM</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="10">
          <span class="hits">66</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="11">
          <span class="hits">66</span>
          
          <code class="ruby">      @event = &#39;grant&#39;</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="12">
          <span class="hits">66</span>
          
          <code class="ruby">      @allow_multiple_channels = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="14">
          <span class="hits">66</span>
          
          <code class="ruby">      @timestamp = current_time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="16">
          <span class="hits">66</span>
          
          <code class="ruby">      @write = options[:write]</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="17">
          <span class="hits">66</span>
          
          <code class="ruby">      @read  = options[:read]</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="18">
          <span class="hits">66</span>
          
          <code class="ruby">      @ttl   = options[:ttl]   || Pubnub::Configuration::DEFAULT_TTL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="22">
          <span class="hits">66</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="24">
          <span class="hits">66</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;publish_key is required by Revoke&#39;) unless @publish_key</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="25">
          <span class="hits">66</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Parameter secret_key is required by Revoke&#39;) if !@secret_key || @secret_key == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="27">
          <span class="hits">66</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;ttl parameter is too big, max value is: 525600&#39;) unless @ttl.to_i &lt;= 525600 || @ttl.nil?</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="28">
          <span class="hits">66</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;ttl parameter is too small, min value is: 1&#39;)  unless @ttl.to_i &gt;= 1 || @ttl.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    def parameters(app, signature = false)</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="34">
          <span class="hits">132</span>
          
          <code class="ruby">      write = 0</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="35">
          <span class="hits">132</span>
          
          <code class="ruby">      read  = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">          :timestamp =&gt; @timestamp,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">          :w         =&gt; write,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">          :r         =&gt; read,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">          :ttl       =&gt; @ttl</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="42">
          <span class="hits">132</span>
          
          <code class="ruby">      }.merge(super(app, signature))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      &#39;/&#39; + [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">          &#39;v1&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          &#39;auth&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">          &#39;grant&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">          &#39;sub-key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">          @subscribe_key</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="52">
          <span class="hits">132</span>
          
          <code class="ruby">      ].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="73251ef4843e500b2ccb9096fea17113b33e9a6c">
  <div class="header">
    <h3>lib/pubnub/events/state.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class State</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SingleEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="9">
          <span class="hits">5</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="11">
          <span class="hits">5</span>
          
          <code class="ruby">      @uuid_looking_for = options[:uuid]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="12">
          <span class="hits">5</span>
          
          <code class="ruby">      @uuid = app.uuid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="16">
          <span class="hits">5</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      # check channel/channels</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="19">
          <span class="hits">5</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;State requires :channel argument&#39;) unless @channel</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="20">
          <span class="hits">5</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Invalid channel format! Should be type of: String or Symbol&#39;) unless @channel.is_a?(String) or @channel.is_a?(Symbol)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      &#39;/&#39; + [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">          &#39;v2&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">          &#39;presence&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">          &#39;sub_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">          @subscribe_key,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">          &#39;channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">          @channel,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">          &#39;uuid&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">          @uuid_looking_for</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="35">
          <span class="hits">10</span>
          
          <code class="ruby">      ].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    def format_envelopes(response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="40">
          <span class="hits">5</span>
          
          <code class="ruby">      parsed_response = Parser.parse_json(response.body) if Parser.valid_json?(response.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="42">
          <span class="hits">5</span>
          
          <code class="ruby">      envelopes = Array.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">        {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">            :channel =&gt; @channel,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">            :payload =&gt; response[&#39;payload&#39;]      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">        },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">        app</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="49">
          <span class="hits">5</span>
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="51">
          <span class="hits">5</span>
          
          <code class="ruby">      envelopes = add_common_data_to_envelopes(envelopes, response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="53">
          <span class="hits">5</span>
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4f3bf9e46c1a156a6a6f300930e392a5e865b797">
  <div class="header">
    <h3>lib/pubnub/events/subscribe.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Subscribe</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SubscribeEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="10">
          <span class="hits">153</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="11">
          <span class="hits">153</span>
          
          <code class="ruby">      @event = &#39;subscribe&#39;</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="12">
          <span class="hits">153</span>
          
          <code class="ruby">      @allow_multiple_channels = true</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="13">
          <span class="hits">153</span>
          
          <code class="ruby">      @state = options[:state]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def fire(app)</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="18">
          <span class="hits">153</span>
          
          <code class="ruby">      app.update_timetoken(0)</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="19">
          <span class="hits">153</span>
          
          <code class="ruby">      add_state(@state, app) if @state</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="20">
          <span class="hits">153</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="24">
          <span class="hits">153</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      # Check channels</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="26">
          <span class="hits">153</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Subscribe requires :channel or :channels argument&#39;) unless @channel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      # Check callback</code>
        </li>
      
        <li class="covered" data-hits="153" data-linenumber="29">
          <span class="hits">153</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Callback parameter is required while using async subscribe&#39;) if !@http_sync &amp;&amp; @callback.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">    def add_state(state, app)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="36">
          <span class="hits">2</span>
          
          <code class="ruby">      state.each do |k,v|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="37">
          <span class="hits">2</span>
          
          <code class="ruby">        app.set_state(v,k,@origin)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d4d6b4af76920a5d9220c9c8bac88bf9e21292e6">
  <div class="header">
    <h3>lib/pubnub/events/time.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>25</b> relevant lines. 
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Time</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SingleEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="9">
          <span class="hits">64</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="10">
          <span class="hits">64</span>
          
          <code class="ruby">      @channel = @channel.first</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="11">
          <span class="hits">64</span>
          
          <code class="ruby">      @event = &#39;time&#39;</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="12">
          <span class="hits">64</span>
          
          <code class="ruby">      @doesnt_require_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="16">
          <span class="hits">64</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      # check callback</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="18">
          <span class="hits">64</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;Callback parameter is required while using async time&#39;) if !@http_sync &amp;&amp; @callback.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(app)</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="24">
          <span class="hits">128</span>
          
          <code class="ruby">      &#39;/time/0&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    def timetoken(parsed_response)</code>
        </li>
      
        <li class="covered" data-hits="192" data-linenumber="28">
          <span class="hits">192</span>
          
          <code class="ruby">      parsed_response.first if parsed_response.is_a? Array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    def format_envelopes(response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="33">
          <span class="hits">64</span>
          
          <code class="ruby">      parsed_response = Parser.parse_json(response.body) if Parser.valid_json?(response.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="35">
          <span class="hits">64</span>
          
          <code class="ruby">      envelopes = Array.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">          {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">              :message           =&gt; timetoken(parsed_response),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">              :response_message  =&gt; timetoken(parsed_response),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">              :timetoken         =&gt; timetoken(parsed_response)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">          },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">          app</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="43">
          <span class="hits">64</span>
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="45">
          <span class="hits">64</span>
          
          <code class="ruby">      envelopes = add_common_data_to_envelopes(envelopes, response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="47">
          <span class="hits">64</span>
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="881e5ae2fb41ed270efa20ef9297471899430596">
  <div class="header">
    <h3>lib/pubnub/events/where_now.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class WhereNow</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Event</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::SingleEvent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Formatter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Pubnub::Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="9">
          <span class="hits">16</span>
          
          <code class="ruby">      @uuid_looking_for = options[:uuid]</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="10">
          <span class="hits">16</span>
          
          <code class="ruby">      @uuid = app.uuid</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="11">
          <span class="hits">16</span>
          
          <code class="ruby">      @event = &#39;where_now&#39;</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="12">
          <span class="hits">16</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="16">
          <span class="hits">16</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      # check uuid</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="19">
          <span class="hits">16</span>
          
          <code class="ruby">      raise ArgumentError.new(:object =&gt; self, :message =&gt; &#39;where_now requires :uuid argument&#39;) unless @uuid_looking_for</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    def path(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      &#39;/&#39; + [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">          &#39;v2&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">          &#39;presence&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">          &#39;sub-key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">          @subscribe_key,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">          &#39;uuid&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">          @uuid_looking_for</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="32">
          <span class="hits">32</span>
          
          <code class="ruby">      ].join(&#39;/&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">    def format_envelopes(response, app, error)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="36">
          <span class="hits">16</span>
          
          <code class="ruby">      parsed_response = Parser.parse_json(response.body) if Parser.valid_json?(response.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="38">
          <span class="hits">16</span>
          
          <code class="ruby">      envelopes = Array.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">          {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">              :message           =&gt; parsed_response,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">              :response_message  =&gt; parsed_response</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">          },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">          app</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="45">
          <span class="hits">16</span>
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="47">
          <span class="hits">16</span>
          
          <code class="ruby">      envelopes = add_common_data_to_envelopes(envelopes, response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="49">
          <span class="hits">16</span>
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="aaa910c8848b2ee3aff95cea6d3c0ea6fd2c81af">
  <div class="header">
    <h3>lib/pubnub/exceptions.rb</h3>
    <h4><span class="green">97.06 %</span> covered</h4>
    <div>
      <b>34</b> relevant lines. 
      <span class="green"><b>33</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Error &lt; StandardError</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :operation, :request, :response, :env, :error, :message, :app, :event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options = {})</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="6">
          <span class="hits">670</span>
          
          <code class="ruby">      if options.is_a? Hash</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="7">
          <span class="hits">670</span>
          
          <code class="ruby">        @event     = options[:event]</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="8">
          <span class="hits">670</span>
          
          <code class="ruby">        @operation = @event</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="9">
          <span class="hits">670</span>
          
          <code class="ruby">        @request   = options[:request]</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="10">
          <span class="hits">670</span>
          
          <code class="ruby">        @env       = options[:env]</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="11">
          <span class="hits">670</span>
          
          <code class="ruby">        @response  = options[:response]</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="12">
          <span class="hits">670</span>
          
          <code class="ruby">        @error     = options[:error]</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="13">
          <span class="hits">670</span>
          
          <code class="ruby">        @message   = options[:message] unless options[:message].nil?</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="14">
          <span class="hits">670</span>
          
          <code class="ruby">        @app       = options[:app]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="17">
          <span class="hits">670</span>
          
          <code class="ruby">      @error = self unless @error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="19">
          <span class="hits">670</span>
          
          <code class="ruby">      log_error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    def log_error</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="25">
          <span class="hits">670</span>
          
          <code class="ruby">      error_message = String.new</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="26">
          <span class="hits">670</span>
          
          <code class="ruby">      error_message &lt;&lt; &quot;OPERATION: #{@operation}\n&quot; if @operation</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="27">
          <span class="hits">670</span>
          
          <code class="ruby">      error_message &lt;&lt; &quot;REQUEST: #{@request}\n&quot;     if @request</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="28">
          <span class="hits">670</span>
          
          <code class="ruby">      error_message &lt;&lt; &quot;ENV: #{@env}\n&quot;             if @env</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="29">
          <span class="hits">670</span>
          
          <code class="ruby">      error_message &lt;&lt; &quot;APP: #{@app}\n&quot;             if @app</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="30">
          <span class="hits">670</span>
          
          <code class="ruby">      error_message &lt;&lt; &quot;RESPONSE: #{@response}\n&quot;   if @response</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="31">
          <span class="hits">670</span>
          
          <code class="ruby">      error_message &lt;&lt; &quot;ERROR TYPE: #{@error.class.to_s}\n&quot;</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="32">
          <span class="hits">670</span>
          
          <code class="ruby">      error_message &lt;&lt; &quot;ERROR MESSAGE: #{@message}\n&quot;</code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="33">
          <span class="hits">670</span>
          
          <code class="ruby">      error_message &lt;&lt; &quot;ERROR BACKTRACE: #{self.backtrace}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="670" data-linenumber="35">
          <span class="hits">670</span>
          
          <code class="ruby">      if $logger.blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">        puts error_message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1340" data-linenumber="38">
          <span class="hits">1340</span>
          
          <code class="ruby">        $logger.error(&#39;Pubnub&#39;){error_message}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  class JSONParseError &lt; Error; end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  class InitializationError &lt; Error; end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  class ArgumentError &lt; Error; end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  class RequestError &lt; Error; end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  class ResponseError &lt; Error; end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4ad20257a561092f5e94677e4e5e6d93ed124326">
  <div class="header">
    <h3>lib/pubnub/formatter.rb</h3>
    <h4><span class="green">92.31 %</span> covered</h4>
    <div>
      <b>26</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Formatter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    # Formats channels as array of channels as strings</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    def format_channels(channels, should_encode = true)</code>
        </li>
      
        <li class="covered" data-hits="2063" data-linenumber="5">
          <span class="hits">2063</span>
          
          <code class="ruby">      channel_array = case channels.class.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">        when &#39;String&#39;</code>
        </li>
      
        <li class="covered" data-hits="1769" data-linenumber="7">
          <span class="hits">1769</span>
          
          <code class="ruby">          channels.split(&#39;,&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">        when &#39;Array&#39;</code>
        </li>
      
        <li class="covered" data-hits="160" data-linenumber="9">
          <span class="hits">160</span>
          
          <code class="ruby">          channels.map { |channel| channel.to_s }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="240" data-linenumber="11">
          <span class="hits">240</span>
          
          <code class="ruby">          [channels.to_s]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3126" data-linenumber="14">
          <span class="hits">3126</span>
          
          <code class="ruby">      channel_array = channel_array.map { |channel| encode_channel(channel) } if should_encode</code>
        </li>
      
        <li class="covered" data-hits="2063" data-linenumber="15">
          <span class="hits">2063</span>
          
          <code class="ruby">      channel_array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    def encode_channel(channel)</code>
        </li>
      
        <li class="covered" data-hits="1064" data-linenumber="19">
          <span class="hits">1064</span>
          
          <code class="ruby">      URI.encode_www_form_component(channel).gsub(&#39;+&#39;, &#39;%20&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    def format_message(message)</code>
        </li>
      
        <li class="covered" data-hits="274" data-linenumber="23">
          <span class="hits">274</span>
          
          <code class="ruby">      if @cipher_key</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="24">
          <span class="hits">132</span>
          
          <code class="ruby">        pc = Pubnub::Crypto.new(@cipher_key)</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="25">
          <span class="hits">132</span>
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="26">
          <span class="hits">132</span>
          
          <code class="ruby">          message = pc.encrypt(message)</code>
        </li>
      
        <li class="covered" data-hits="132" data-linenumber="27">
          <span class="hits">132</span>
          
          <code class="ruby">          URI.escape(message.to_json)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">        rescue =&gt; error</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">          @error_callback.call &#39;bug&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="142" data-linenumber="32">
          <span class="hits">142</span>
          
          <code class="ruby">        URI.encode_www_form_component(message.to_json).gsub(&#39;+&#39;, &#39;%20&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    def params_hash_to_url_params(hash)</code>
        </li>
      
        <li class="covered" data-hits="2294" data-linenumber="37">
          <span class="hits">2294</span>
          
          <code class="ruby">      params = String.new</code>
        </li>
      
        <li class="covered" data-hits="2294" data-linenumber="38">
          <span class="hits">2294</span>
          
          <code class="ruby">      hash.each do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="8606" data-linenumber="39">
          <span class="hits">8606</span>
          
          <code class="ruby">        params &lt;&lt; &quot;#{key}=#{value}&amp;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="2294" data-linenumber="41">
          <span class="hits">2294</span>
          
          <code class="ruby">      params.chop! if params[-1] == &#39;&amp;&#39;</code>
        </li>
      
        <li class="covered" data-hits="2294" data-linenumber="42">
          <span class="hits">2294</span>
          
          <code class="ruby">      params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fdc7b7da368c77afe781a25dc1b427a881227d88">
  <div class="header">
    <h3>lib/pubnub/pam.rb</h3>
    <h4><span class="red">79.41 %</span> covered</h4>
    <div>
      <b>34</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module PAM</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(options, app)</code>
        </li>
      
        <li class="covered" data-hits="199" data-linenumber="4">
          <span class="hits">199</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="199" data-linenumber="5">
          <span class="hits">199</span>
          
          <code class="ruby">      if options[:presence].present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">        @channel = options[:presence].to_s + &#39;-pnpres&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="199" data-linenumber="8">
          <span class="hits">199</span>
          
          <code class="ruby">      @auth_key = options[:auth_key]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    def signature(app)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      channel = @original_channel.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      message = &quot;#{@subscribe_key}\n#{@publish_key}\n#{@event}\n#{variables_for_signature(app)}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      Base64.urlsafe_encode64(OpenSSL::HMAC.digest(OpenSSL::Digest::Digest.new(&#39;sha256&#39;), @secret_key.to_s, message)).strip</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def payload(parsed_response)</code>
        </li>
      
        <li class="covered" data-hits="199" data-linenumber="18">
          <span class="hits">199</span>
          
          <code class="ruby">      parsed_response[&#39;payload&#39;] if parsed_response</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    def message(parsed_response)</code>
        </li>
      
        <li class="covered" data-hits="199" data-linenumber="22">
          <span class="hits">199</span>
          
          <code class="ruby">      parsed_response[&#39;message&#39;] if parsed_response</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def channel(parsed_response)</code>
        </li>
      
        <li class="covered" data-hits="199" data-linenumber="26">
          <span class="hits">199</span>
          
          <code class="ruby">      @channel.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    def parameters(app, signature = false)</code>
        </li>
      
        <li class="covered" data-hits="398" data-linenumber="30">
          <span class="hits">398</span>
          
          <code class="ruby">      params = super(app)</code>
        </li>
      
        <li class="covered" data-hits="398" data-linenumber="31">
          <span class="hits">398</span>
          
          <code class="ruby">      params.merge!({ :timestamp =&gt; @timestamp })</code>
        </li>
      
        <li class="covered" data-hits="398" data-linenumber="32">
          <span class="hits">398</span>
          
          <code class="ruby">      params.merge!({ :channel   =&gt; @channel.first }) unless @channel.first.blank?</code>
        </li>
      
        <li class="covered" data-hits="398" data-linenumber="33">
          <span class="hits">398</span>
          
          <code class="ruby">      params.merge!({ :signature =&gt; signature(app) }) unless signature</code>
        </li>
      
        <li class="covered" data-hits="398" data-linenumber="34">
          <span class="hits">398</span>
          
          <code class="ruby">      params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">    def variables_for_signature(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      parameters(app, true).map{|k,v|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">        &quot;#{k.to_s}=#{CGI.escape(v.to_s).gsub(&#39;+&#39;,&#39;%20&#39;)}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">      }.sort.join(&#39;&amp;&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    def current_time</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">      ::Time.now.to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def format_envelopes(response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="199" data-linenumber="49">
          <span class="hits">199</span>
          
          <code class="ruby">      parsed_response = Parser.parse_json(response.body) if Parser.valid_json?(response.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="199" data-linenumber="51">
          <span class="hits">199</span>
          
          <code class="ruby">      envelopes = Array.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      envelopes &lt;&lt; Envelope.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">          {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">              :payload =&gt; payload(parsed_response),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">              :message =&gt; message(parsed_response),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">              :channel =&gt; channel(parsed_response)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">          },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">          app</code>
        </li>
      
        <li class="covered" data-hits="199" data-linenumber="59">
          <span class="hits">199</span>
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="199" data-linenumber="61">
          <span class="hits">199</span>
          
          <code class="ruby">      envelopes = add_common_data_to_envelopes(envelopes, response, app, error)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="199" data-linenumber="63">
          <span class="hits">199</span>
          
          <code class="ruby">      envelopes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a3be43aae64c488094e7af695e4f0573fa5ec2b5">
  <div class="header">
    <h3>lib/pubnub/parser.rb</h3>
    <h4><span class="yellow">84.62 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Parser</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    # Parses string to JSON</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.parse_json(string)</code>
        </li>
      
        <li class="covered" data-hits="699" data-linenumber="5">
          <span class="hits">699</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="699" data-linenumber="6">
          <span class="hits">699</span>
          
          <code class="ruby">        return JSON.parse(string)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">      rescue JSON::ParserError =&gt; e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">        return Pubnub::Envelope.format_after_json_error(string, e)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.valid_json?(string)</code>
        </li>
      
        <li class="covered" data-hits="4645" data-linenumber="13">
          <span class="hits">4645</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="4645" data-linenumber="14">
          <span class="hits">4645</span>
          
          <code class="ruby">        JSON.parse(string)</code>
        </li>
      
        <li class="covered" data-hits="1614" data-linenumber="15">
          <span class="hits">1614</span>
          
          <code class="ruby">        true</code>
        </li>
      
        <li class="covered" data-hits="3031" data-linenumber="16">
          <span class="hits">3031</span>
          
          <code class="ruby">      rescue JSON::ParserError</code>
        </li>
      
        <li class="covered" data-hits="3031" data-linenumber="17">
          <span class="hits">3031</span>
          
          <code class="ruby">        false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2925973fd39d1e82bf8d130dd830d92e660bf9e0">
  <div class="header">
    <h3>lib/pubnub/uuid.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class UUID</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def generate</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="4">
          <span class="hits">910</span>
          
          <code class="ruby">      ary = Random.new.bytes(16).unpack(&quot;NnnnnN&quot;)</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="5">
          <span class="hits">910</span>
          
          <code class="ruby">      ary[2] = (ary[2] &amp; 0x0fff) | 0x4000</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="6">
          <span class="hits">910</span>
          
          <code class="ruby">      ary[3] = (ary[3] &amp; 0x3fff) | 0x8000</code>
        </li>
      
        <li class="covered" data-hits="910" data-linenumber="7">
          <span class="hits">910</span>
          
          <code class="ruby">      &quot;%08x-%04x-%04x-%04x-%04x%08x&quot; % ary</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b1069e18d1ff841fc0db7f87a554bfa001fa4cb1">
  <div class="header">
    <h3>lib/pubnub/validator.rb</h3>
    <h4><span class="red">46.67 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Pubnub</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Validator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    def valid_channel?(allow_array = true)</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="5">
          <span class="hits">395</span>
          
          <code class="ruby">      valid = true</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="6">
          <span class="hits">395</span>
          
          <code class="ruby">      if @channel.is_a? Array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">        if allow_array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">          @channel.each do |channel|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">            unless channel.is_a?(String) || channel.is_a?(Symbol)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">              valid = false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">              break</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">          valid = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="18">
          <span class="hits">395</span>
          
          <code class="ruby">        if !@channel.is_a?(String) &amp;&amp; !@channel.is_a?(Symbol)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">          valid = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">        elsif @channel.to_s.index(&#39;,&#39;) &amp;&amp; !allow_array</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">          valid = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="25">
          <span class="hits">395</span>
          
          <code class="ruby">      valid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c835454764b49cf4f7d980380ea42b5665462ddf">
  <div class="header">
    <h3>spec/lib/client_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>27</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe Pubnub::Client do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  it &#39;has valid version constant&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    expect(Pubnub::Client::VERSION).to match(/\d+\.\d+\..+/)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;#inititalize&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;requires arguments&#39; do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="10">
          <span class="hits">2</span>
          
          <code class="ruby">      expect{ Pubnub.new() }.to raise_error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;parameter :subscribe_key&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">      it &#39;is required&#39; do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="15">
          <span class="hits">2</span>
          
          <code class="ruby">        expect{ Pubnub.new(:http_sync =&gt; true) }.to raise_error(Pubnub::InitializationError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">      it &#39;must be valid&#39; do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="19">
          <span class="hits">2</span>
          
          <code class="ruby">        expect{ Pubnub.new(:subscribe_key =&gt; 123) }.to raise_error(Pubnub::InitializationError)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="20">
          <span class="hits">2</span>
          
          <code class="ruby">        expect{ Pubnub.new(:subscribe_key =&gt; [] ) }.to raise_error(Pubnub::InitializationError)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="21">
          <span class="hits">2</span>
          
          <code class="ruby">        expect{ Pubnub.new(:subscribe_key =&gt; {} ) }.to raise_error(Pubnub::InitializationError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">        expect{ Pubnub.new(:subscribe_key =&gt; &#39;key&#39;) }.not_to raise_error</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">        expect{ Pubnub.new(:subscribe_key =&gt; :key ) }.not_to raise_error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;parameter :publish_key&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      it &#39;must be valid&#39; do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="30">
          <span class="hits">2</span>
          
          <code class="ruby">        expect{ Pubnub.new(:subscribe_key =&gt; &#39;valid&#39;, :publish_key =&gt; [&#39;invalid&#39;]) }.to raise_error(Pubnub::InitializationError)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="31">
          <span class="hits">2</span>
          
          <code class="ruby">        expect{ Pubnub.new(:subscribe_key =&gt; &#39;valid&#39;, :publish_key =&gt; {&#39;invalid&#39; =&gt; &#39;yeah&#39;}) }.to raise_error(Pubnub::InitializationError)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="32">
          <span class="hits">2</span>
          
          <code class="ruby">        expect{ Pubnub.new(:subscribe_key =&gt; &#39;valid&#39;, :publish_key =&gt; [&#39;invalid&#39;]) }.to raise_error(Pubnub::InitializationError)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="34">
          <span class="hits">2</span>
          
          <code class="ruby">        expect{ Pubnub.new(:subscribe_key =&gt; &#39;valid&#39;, :publish_key =&gt; &#39;key&#39;) }.not_to raise_error</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="35">
          <span class="hits">2</span>
          
          <code class="ruby">        expect{ Pubnub.new(:subscribe_key =&gt; &#39;valid&#39;, :publish_key =&gt; :key ) }.not_to raise_error</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;doesnt start EventMachine reactor&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">      pubnub = Pubnub.new(:subscribe_key =&gt; &#39;key&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">      sleep(0.1)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">      expect(EM.reactor_running?).to eq(false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3e100bb44c1081b191ba952a8f3ad352e0d1b7c1">
  <div class="header">
    <h3>spec/lib/encoder_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>29</b> relevant lines. 
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &#39;Pubnub::Formatter&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="5">
          <span class="hits">14</span>
          
          <code class="ruby">    @formater = (Class.new { include Pubnub::Formatter }).new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;#format_channels&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;should encode&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      it &#39;encodes properly string into array of channels&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">        encoded = @formater.format_channels(&#39;Some Channel with+special+chars=[];!@#$%^&amp;*()&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">        encoded.should eq [&#39;Some%20Channel%20with%2Bspecial%2Bchars%3D%5B%5D%3B%21%40%23%24%25%5E%26*%28%29&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      it &#39;encodes properly array of strings into array of channels&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">        encoded = @formater.format_channels([&#39;Some Channel with+special+chars=[];!@#$%^&amp;*()&#39;, &#39; +++ &#39;, &#39;123&#39;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">        encoded.should eq [&#39;Some%20Channel%20with%2Bspecial%2Bchars%3D%5B%5D%3B%21%40%23%24%25%5E%26*%28%29&#39;, &#39;%20%2B%2B%2B%20&#39;, &#39;123&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">      it &#39;encodes properly csv into array of channels&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">        encoded = @formater.format_channels(&#39;Some Channel with+special+chars=[];!@#$%^&amp;*(), +++ ,123&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">        encoded.should eq [&#39;Some%20Channel%20with%2Bspecial%2Bchars%3D%5B%5D%3B%21%40%23%24%25%5E%26*%28%29&#39;, &#39;%20%2B%2B%2B%20&#39;, &#39;123&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;should not encode&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">      it &#39;formats properly string into array of channels&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">        encoded = @formater.format_channels(&#39;Some Channel with+special+chars=[];!@#$%^&amp;*()&#39;, false)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">        encoded.should eq [&#39;Some Channel with+special+chars=[];!@#$%^&amp;*()&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">      it &#39;formats properly array of strings into array of channels&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">        encoded = @formater.format_channels([&#39;Some Channel with+special+chars=[];!@#$%^&amp;*()&#39;, &#39; +++ &#39;, &#39;123&#39;], false)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">        encoded.should eq [&#39;Some Channel with+special+chars=[];!@#$%^&amp;*()&#39;, &#39; +++ &#39;, &#39;123&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      it &#39;formats properly csv into array of channels&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">        encoded = @formater.format_channels(&#39;Some Channel with+special+chars=[];!@#$%^&amp;*(), +++ ,123&#39;, false)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">        encoded.should eq [&#39;Some Channel with+special+chars=[];!@#$%^&amp;*()&#39;, &#39; +++ &#39;, &#39;123&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;#encode_channel&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;encodes channel&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      encoded = @formater.encode_channel(&#39;Some Channel with+special+chars=[];!@#$%^&amp;*()&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">      encoded.should eq &#39;Some%20Channel%20with%2Bspecial%2Bchars%3D%5B%5D%3B%21%40%23%24%25%5E%26*%28%29&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="03f96d06b27e7bd769fdcbd4a33f5516d091bc36">
  <div class="header">
    <h3>spec/lib/eof_error_spec.rb</h3>
    <h4><span class="yellow">87.1 %</span> covered</h4>
    <div>
      <b>31</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &#39;quick eof error test&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    @pn = nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 1, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    Pubnub::Subscribe.any_instance.stub(:send_request){</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">      Pubnub::Subscribe.any_instance.unstub(:send_request)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      raise EOFError</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  it &#39;should not break client&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    VCR.use_cassette(&#39;eof_subscribe&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.subscribe(:channel =&gt; &#39;ping_3&#39;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">      eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="41">
          <span class="hits">7</span>
          
          <code class="ruby">        @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">        @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">        @response_output.read.should eq &#39;[[&quot;ping_3.php says 1403984741&quot;],&quot;14039847413557067&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e8568a38008be0fb0972fe9972e81d0e671c285c">
  <div class="header">
    <h3>spec/lib/formatting_envelope_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>129</b> relevant lines. 
      <span class="green"><b>129</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;Pubnub::Envelope&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;after subscribe&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;without cipher key&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="8">
          <span class="hits">11</span>
          
          <code class="ruby">        sleep(0.1)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="9">
          <span class="hits">11</span>
          
          <code class="ruby">        @pn = Pubnub.new(:subscribe_key =&gt; :demo, :publish_key =&gt; :demo)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;on one channel&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting string&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-without-cipherkey-one-channel-string&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting integer&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-without-cipherkey-one-channel-integer&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting array&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-without-cipherkey-one-channel-array&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting hash&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes hash&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-without-cipherkey-one-channel-hash&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting mix of everything&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-without-cipherkey-one-channel-mix&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes.size.should eq 4</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;on many channels&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting string&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-without-cipherkey-many-channels-string&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting integer&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-without-cipherkey-many-channels-integer&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting array&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-without-cipherkey-many-channels-array&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting hash&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes hash&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-without-cipherkey-many-channels-hash&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting mix of everything&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-without-cipherkey-many-channels-mix&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting mix of everything from both channels&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-without-cipherkey-many-channels-multi-mix&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;with cipher key&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="156">
          <span class="hits">1</span>
          
          <code class="ruby">      before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="157">
          <span class="hits">11</span>
          
          <code class="ruby">        @pn = Pubnub.new(:subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :cipher_key =&gt; &#39;secret&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;on one channel&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting string&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-cipherkey-one-channel-string&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting integer&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-cipherkey-one-channel-integer&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting array&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-cipherkey-one-channel-array&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting hash&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes hash&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-cipherkey-one-channel-hash&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting mix of everything&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-cipherkey-one-channel-mix&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; :test_channel_one, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;on many channels&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting string&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-cipherkey-many-channels-string&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting integer&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-cipherkey-many-channels-integer&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting array&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-cipherkey-many-channels-array&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting hash&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes hash&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-cipherkey-many-channels-hash&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="276">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting mix of everything&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="279">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="280">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-cipherkey-many-channels-mix&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="281">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;after getting mix of everything from both channels&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">          it &#39;formats envelopes properly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">            VCR.use_cassette(&quot;formatting-envelope-subscribe-cipherkey-many-channels-multi-mix&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">              @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="295">
          <span class="hits">1</span>
          
          <code class="ruby">              envelopes = @pn.subscribe(:channel =&gt; [:test_channel_one, :test_channel_two], :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby">              #envelopes.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3d2bd72e18f7833198503bd8482bd354bd09e27c">
  <div class="header">
    <h3>spec/lib/heartbeat_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>62</b> relevant lines. 
      <span class="green"><b>62</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &#39;hearbeat&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  it &#39;default should be nil&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    @pn = Pubnub.new(:subscribe_key =&gt; :test)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    @pn.env[:heartbeat].should eq nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  it &#39;is present in subscribe request when set, also fires leave after sync subscribe&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    @pn = Pubnub.new(:subscribe_key =&gt; &#39;demo-36&#39;, :heartbeat =&gt; 100)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    VCR.use_cassette(&quot;heartbeated-subscribe&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">      enve = @pn.subscribe(:channel =&gt; :ruby_test, :http_sync =&gt; true) # request would file if heartbeat would not be present</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      enve.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  it &#39;isn\&#39;t present in subscribe request when not set&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    @pn = Pubnub.new(:subscribe_key =&gt; &#39;demo-36&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    VCR.use_cassette(&quot;non-heartbeated-subscribe&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      enve = @pn.subscribe(:channel =&gt; :ruby_test, :http_sync =&gt; true) # request would file if heartbeat would be present</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">      enve.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  it &#39;is called every heartbeat/2 - 1 seconds&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    @pn = Pubnub.new(:subscribe_key =&gt; &#39;demo-36&#39;, :heartbeat =&gt; &#39;12&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    VCR.use_cassette(&quot;heartbeat-test&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.subscribe(:channel =&gt; &#39;rubyheartbeatdemo&#39;){|e| }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">      eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.env[:heartbeat].to_i.should      eq 12</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.env[:respirator].interval.should eq 5</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  it &#39;calls error_callback if get\&#39;s non-200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    @error = false</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    error_callback = lambda do |error|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">      @error = true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      EM.stop</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    @pn = Pubnub.new(:subscribe_key =&gt; &#39;demo-36&#39;, :heartbeat =&gt; &#39;4&#39;, :error_callback =&gt; error_callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">    VCR.use_cassette(&quot;heartbeat-non200&quot;, :record =&gt; :new_episodes) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.subscribe(:channel =&gt; &#39;rubyheartbeatdemo&#39;){|e| }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">      eventually do</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="53">
          <span class="hits">12</span>
          
          <code class="ruby">        @error.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;is settable&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">    before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="60">
          <span class="hits">3</span>
          
          <code class="ruby">      @pn = Pubnub.new(:subscribe_key =&gt; :test)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;at init time&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn = Pubnub.new(:subscribe_key =&gt; :test, :heartbeat =&gt; 100)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.env[:heartbeat].should eq 100</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;via heartbeat=&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.heartbeat = 100</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.env[:heartbeat].should eq 100</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;via set_heartbeat(value)&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.set_heartbeat 100</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.env[:heartbeat].should eq 100</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;is updateable&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">    before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="81">
          <span class="hits">2</span>
          
          <code class="ruby">      @pn = Pubnub.new(:subscribe_key =&gt; :test)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="82">
          <span class="hits">2</span>
          
          <code class="ruby">      @pn.heartbeat = 100</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;via heartbeat=&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.heartbeat = 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.env[:heartbeat].should eq 200</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;via set_heartbeat(value)&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.set_heartbeat 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.env[:heartbeat].should eq 200</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;is gettable&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">    before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="98">
          <span class="hits">2</span>
          
          <code class="ruby">      @pn = Pubnub.new(:subscribe_key =&gt; :test)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="99">
          <span class="hits">2</span>
          
          <code class="ruby">      @pn.heartbeat = 100</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;via get_heartbeat&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.get_heartbeat.should eq 100</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;via .env&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.env[:heartbeat].should eq 100</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="30b353b666ca62e18db2f68e779ecd7449a562c1">
  <div class="header">
    <h3>spec/lib/integration/audit_dpc_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>358</b> relevant lines. 
      <span class="green"><b>358</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#audit&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:disable_persistent_connection =&gt; true, :max_retries =&gt; 0, :subscribe_key =&gt; &#39;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&#39;, :publish_key =&gt; &#39;pub-c-15d6fd3c-05de-4abc-8eba-6595a441959d&#39;, :secret_key =&gt; &#39;sec-c-ZWYwMGJiZTYtMTQwMC00NDQ5LWI0NmEtMzZiM2M5NThlOTJh&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;f0ac67ef-912f-4797-be67-a59745107306&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="30">
          <span class="hits">32</span>
          
          <code class="ruby">    Pubnub::Audit.any_instance.stub(:current_time).and_return 1234567890</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="31">
          <span class="hits">32</span>
          
          <code class="ruby">    Pubnub::Audit.any_instance.stub(:signature).and_return &#39;kdDh/sFC3rSR%2Bt5AEymIc57d1velIr562V7usa5M4k0=&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="35">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="58">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="88">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="120">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="150">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="184">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="202">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="214">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="216">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="218">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="234">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="246">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="248">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="249">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="250">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="254">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="264">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="276">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="279">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="280">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="290">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="295">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="301">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="313">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="315">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="316">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="317">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="320">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="321">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="325">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="331">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="332">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="334">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="335">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="343">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="345">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="346">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="347">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="351">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="364">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="367">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="373">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="375">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="377">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="378">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="379">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="392">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="393">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="394">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="395">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="396">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="397">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="398">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="403">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="405">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="407">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="408">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="409">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="415">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="416">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="421">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="427">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="430">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="431">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="432">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="434">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="437">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="439">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="441">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="442">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="443">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="446">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="448">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="454">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="457">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="458">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="459">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="460">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="461">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="462">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="467">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="469">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="471">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="472">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="473">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="477">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="479">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="485">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="488">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="489">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="490">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="492">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="493">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="494">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="498">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="499">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="501">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="503">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="504">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="505">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="508">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="509">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="510">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="513">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="516">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="519">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="520">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="521">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="522">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="523">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="524">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="529">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="531">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="533">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="534">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="535">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="541">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="542">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="543">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="544">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="75f2a11878c4f772fc828480099e9ed3e766a7f0">
  <div class="header">
    <h3>spec/lib/integration/audit_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>358</b> relevant lines. 
      <span class="green"><b>358</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#audit&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; &#39;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&#39;, :publish_key =&gt; &#39;pub-c-15d6fd3c-05de-4abc-8eba-6595a441959d&#39;, :secret_key =&gt; &#39;sec-c-ZWYwMGJiZTYtMTQwMC00NDQ5LWI0NmEtMzZiM2M5NThlOTJh&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;f0ac67ef-912f-4797-be67-a59745107306&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="30">
          <span class="hits">32</span>
          
          <code class="ruby">    Pubnub::Audit.any_instance.stub(:current_time).and_return 1234567890</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="31">
          <span class="hits">32</span>
          
          <code class="ruby">    Pubnub::Audit.any_instance.stub(:signature).and_return &#39;kdDh/sFC3rSR%2Bt5AEymIc57d1velIr562V7usa5M4k0=&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="35">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="58">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="88">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="120">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="150">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="184">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="202">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="214">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="216">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="218">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="234">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="246">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="248">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="249">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="250">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="254">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="264">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="276">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="279">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="280">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="290">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="295">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="301">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="313">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="315">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="316">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="317">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="320">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="321">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="325">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="331">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="332">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="334">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="335">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="343">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="345">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="346">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="347">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="351">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="364">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="367">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="373">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="375">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="377">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="378">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="379">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="392">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="393">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="394">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="395">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="396">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="397">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="398">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="403">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="405">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="407">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="408">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="409">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="415">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="416">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="421">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="427">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="430">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="431">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="432">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="434">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="437">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="439">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="441">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="442">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="443">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="446">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="448">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="454">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="457">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="458">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="459">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="460">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="461">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="462">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="467">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="469">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="471">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="472">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="473">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="477">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="479">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="485">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="488">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="489">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="490">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="492">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="493">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="494">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="498">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="499">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="501">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="503">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="504">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="505">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="508">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="509">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="510">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="513">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="516">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="519">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="520">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="521">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="522">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="523">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="524">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;audit-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.audit(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="529">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="531">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="533">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="534">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="535">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="541">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="542">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="543">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="544">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="33f6f5e59455dd6c2ee82b8cd7d6c8c0f7acc931">
  <div class="header">
    <h3>spec/lib/integration/global_here_now_dpc_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>356</b> relevant lines. 
      <span class="green"><b>356</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#here_now&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:disable_persistent_connection =&gt; true, :max_retries =&gt; 0, :subscribe_key =&gt; &#39;demo-36&#39;, :publish_key =&gt; &#39;demo-36&#39;, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="32">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="85">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="117">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="147">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="181">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="211">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="243">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="273">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="287">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="310">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="340">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="370">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="372">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="387">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="392">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="400">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="402">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="424">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="436">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="451">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="464">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="466">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="478">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="483">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="485">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="486">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="488">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="491">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="496">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="498">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="513">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="526">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="528">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="541">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c8c564cfc80c64e94676751432054d970408d33b">
  <div class="header">
    <h3>spec/lib/integration/global_here_now_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>356</b> relevant lines. 
      <span class="green"><b>356</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#here_now&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; &#39;demo-36&#39;, :publish_key =&gt; &#39;demo-36&#39;, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="32">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="85">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="117">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="147">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="181">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="211">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="243">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="273">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="287">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="310">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="340">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="370">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="372">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="387">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="392">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="400">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="402">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="424">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="436">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;service&quot;=&gt;&quot;Presence&quot;, &quot;uuids&quot;=&gt;[], &quot;occupancy&quot;=&gt;0}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="451">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="464">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="466">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="478">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="483">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="485">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="486">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="488">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="491">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="496">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="498">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="513">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now_global-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="526">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="528">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;service&quot;: &quot;Presence&quot;, &quot;uuids&quot;: [], &quot;occupancy&quot;: 0&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="541">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7f6efcba980aa35438161a33a846143df90bfedd">
  <div class="header">
    <h3>spec/lib/integration/grant_dpc_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>366</b> relevant lines. 
      <span class="green"><b>366</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#grant&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="6">
          <span class="hits">33</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="7">
          <span class="hits">33</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="8">
          <span class="hits">33</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="10">
          <span class="hits">33</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="11">
          <span class="hits">33</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="13">
          <span class="hits">33</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="14">
          <span class="hits">9</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="15">
          <span class="hits">9</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="16">
          <span class="hits">9</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="17">
          <span class="hits">9</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="20">
          <span class="hits">33</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="27">
          <span class="hits">33</span>
          
          <code class="ruby">    @pn = Pubnub.new(:disable_persistent_connection =&gt; true, :max_retries =&gt; 0, :subscribe_key =&gt; &#39;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&#39;, :publish_key =&gt; &#39;pub-c-15d6fd3c-05de-4abc-8eba-6595a441959d&#39;, :secret_key =&gt; &#39;sec-c-ZWYwMGJiZTYtMTQwMC00NDQ5LWI0NmEtMzZiM2M5NThlOTJh&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="28">
          <span class="hits">33</span>
          
          <code class="ruby">    @pn.uuid = &#39;f0ac67ef-912f-4797-be67-a59745107306&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="30">
          <span class="hits">33</span>
          
          <code class="ruby">    Pubnub::Grant.any_instance.stub(:current_time).and_return 1234567890</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="31">
          <span class="hits">33</span>
          
          <code class="ruby">    Pubnub::Grant.any_instance.stub(:signature).and_return &#39;kdDh/sFC3rSR%2Bt5AEymIc57d1velIr562V7usa5M4k0=&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="35">
          <span class="hits">18</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    it &quot;Generates valid url for application level&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      VCR.use_cassette(&quot;grant-application-level&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.grant(:http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">        @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">        @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">        @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;service&quot;:&quot;Access Manager&quot;,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;r&quot;:1,&quot;ttl&quot;:1440,&quot;w&quot;:1,&quot;level&quot;:&quot;subkey&quot;}}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">        @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">        @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="69">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="99">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="131">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="156">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="158">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="161">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="195">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="225">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="251">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="257">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="281">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="282">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="287">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="301">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="318">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="319">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="324">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="325">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="348">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="349">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="350">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="354">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="381">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="386">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="401">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="410">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="411">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="412">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="416">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="426">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="434">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="435">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="444">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="445">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="448">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="450">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="474">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="475">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="480">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="487">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="497">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="498">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="506">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="510">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="512">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="513">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="517">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="527">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="536">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="537">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="538">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="539">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="541">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="542">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="543">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="544">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="545">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="546">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="547">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="548">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="550">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="551">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="552">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="553">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="554">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="555">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="58f396307419cb95d93a225a21d01c9c5591ec06">
  <div class="header">
    <h3>spec/lib/integration/grant_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>366</b> relevant lines. 
      <span class="green"><b>366</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#grant&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="6">
          <span class="hits">33</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="7">
          <span class="hits">33</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="8">
          <span class="hits">33</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="10">
          <span class="hits">33</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="11">
          <span class="hits">33</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="13">
          <span class="hits">33</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="14">
          <span class="hits">9</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="15">
          <span class="hits">9</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="16">
          <span class="hits">9</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="17">
          <span class="hits">9</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="20">
          <span class="hits">33</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="27">
          <span class="hits">33</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; &#39;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&#39;, :publish_key =&gt; &#39;pub-c-15d6fd3c-05de-4abc-8eba-6595a441959d&#39;, :secret_key =&gt; &#39;sec-c-ZWYwMGJiZTYtMTQwMC00NDQ5LWI0NmEtMzZiM2M5NThlOTJh&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="28">
          <span class="hits">33</span>
          
          <code class="ruby">    @pn.uuid = &#39;f0ac67ef-912f-4797-be67-a59745107306&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="30">
          <span class="hits">33</span>
          
          <code class="ruby">    Pubnub::Grant.any_instance.stub(:current_time).and_return 1234567890</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="31">
          <span class="hits">33</span>
          
          <code class="ruby">    Pubnub::Grant.any_instance.stub(:signature).and_return &#39;kdDh/sFC3rSR%2Bt5AEymIc57d1velIr562V7usa5M4k0=&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="35">
          <span class="hits">18</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    it &quot;Generates valid url for application level&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      VCR.use_cassette(&quot;grant-application-level&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.grant(:http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">        @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">        @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">        @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;service&quot;:&quot;Access Manager&quot;,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;r&quot;:1,&quot;ttl&quot;:1440,&quot;w&quot;:1,&quot;level&quot;:&quot;subkey&quot;}}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">        @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">        @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="69">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="99">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="131">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="156">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="158">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="161">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="195">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="225">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="251">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="257">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="281">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="282">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="287">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="301">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="318">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="319">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="324">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="325">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="348">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="349">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="350">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="354">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="381">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="386">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="401">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="410">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="411">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="412">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="416">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="426">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="434">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="435">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="444">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="445">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="448">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="450">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="474">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="475">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="480">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:1,&quot;w&quot;:1}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:3600,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="487">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="497">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="498">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="506">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="510">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="512">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="513">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="517">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="527">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="536">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="537">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="538">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;grant-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="539">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.grant(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="541">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="542">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="543">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="544">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="545">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="546">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="547">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="548">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="550">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="551">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="552">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="553">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="554">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="555">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1915c660bd6afb277695fedb350d7d6fdf34a1ba">
  <div class="header">
    <h3>spec/lib/integration/here_now_dpc_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>357</b> relevant lines. 
      <span class="green"><b>357</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#here_now&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:disable_persistent_connection =&gt; true, :max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="32">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="85">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="117">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="147">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="181">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="211">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="243">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="273">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="287">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="310">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="340">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="367">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="372">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="374">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="377">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="378">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="389">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="392">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="393">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="394">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="396">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="397">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="402">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="404">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="407">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="408">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="415">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="421">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="424">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="427">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="430">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="431">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="434">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="436">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="438">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="441">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="442">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="446">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="453">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="457">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="458">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="460">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="461">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="466">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="468">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="471">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="472">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="477">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="486">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="488">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="489">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="490">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="491">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="492">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="493">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="498">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="500">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="503">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="504">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="508">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="509">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="513">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="515">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="519">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="520">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="522">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="523">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="528">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="530">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="533">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="534">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="541">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="542">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="543">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5b652e99bae759c7945ae1ec5438ddee4f6cd2fc">
  <div class="header">
    <h3>spec/lib/integration/here_now_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>357</b> relevant lines. 
      <span class="green"><b>357</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#here_now&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="32">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="85">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="117">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="147">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="181">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="211">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="243">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="273">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="287">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="310">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="340">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="367">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="372">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="374">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="377">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="378">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="389">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="392">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="393">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="394">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="396">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="397">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="402">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="404">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="407">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="408">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="415">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="421">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="424">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="427">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="430">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="431">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="434">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="436">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="438">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="441">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="442">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;uuids&quot;=&gt;[&quot;rubytests&quot;], &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="446">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="453">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="457">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="458">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="460">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="461">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="466">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="468">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="471">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="472">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="477">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="486">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="488">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="489">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="490">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="491">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="492">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="493">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="498">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="500">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="503">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="504">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="508">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="509">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="513">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="515">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="519">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="520">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="522">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="523">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;here_now-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.here_now(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="528">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="530">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;uuids&quot;:[&quot;rubytests&quot;],&quot;occupancy&quot;:1&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="533">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="534">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="541">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="542">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="543">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="505328d7f2135e95366a2466b48b82c5bd3c1aa5">
  <div class="header">
    <h3>spec/lib/integration/history_dpc_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>356</b> relevant lines. 
      <span class="green"><b>356</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#history&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="14">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="15">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="16">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="17">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:disable_persistent_connection =&gt; true, :max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="32">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="85">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="117">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="147">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="181">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="211">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="243">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="273">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="287">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="310">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="340">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="370">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="372">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="387">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="392">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="400">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="402">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="424">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="436">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="451">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="464">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="466">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="478">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="483">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="485">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="486">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="488">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="491">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="496">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="498">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="513">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="526">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="528">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="541">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="614c23a83e5636048d2271242ad0e3e248f82899">
  <div class="header">
    <h3>spec/lib/integration/history_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>356</b> relevant lines. 
      <span class="green"><b>356</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#history&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="14">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="15">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="16">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="17">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="32">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="55">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="85">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="117">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="147">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="181">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="211">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="243">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="273">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="287">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="310">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="340">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="370">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="372">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="387">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="392">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="400">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="402">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="424">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="436">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq (&#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;*3)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;howdy&quot;}{&quot;text&quot;=&gt;&quot;hello&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="451">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="464">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="466">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;howdy&quot;},{&quot;text&quot;:&quot;hello&quot;}],13904298660188334,13904300138214858]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="478">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="483">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="485">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="486">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="488">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="491">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="496">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="498">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="513">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;history-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.history(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="526">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="528">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="541">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="32408f0c7d6279eacf8eeefc6c191f28ba020848">
  <div class="header">
    <h3>spec/lib/integration/leave_dpc_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>356</b> relevant lines. 
      <span class="green"><b>356</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#leave&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:disable_persistent_connection =&gt; true, :max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="31">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="54">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="84">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="116">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="146">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="158">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="180">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="210">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="242">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="272">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="285">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="286">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="287">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="295">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="309">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="314">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="319">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="325">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="337">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="339">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="344">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="350">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="369">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="371">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="381">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="386">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="395">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="399">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="401">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="406">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="420">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="421">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="424">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="426">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="433">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="434">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="435">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="440">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="445">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="450">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="459">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="463">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="465">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="470">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="478">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="482">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="485">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="486">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="495">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="497">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="498">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="502">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="512">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="513">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="521">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="525">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="527">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="532">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="cdac4d0f6743b07358c382299f2ea0e751f9f880">
  <div class="header">
    <h3>spec/lib/integration/leave_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>356</b> relevant lines. 
      <span class="green"><b>356</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#leave&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="31">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="54">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="84">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="116">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="146">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="158">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="180">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="210">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="242">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="272">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="285">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="286">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="287">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="295">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="309">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="314">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="319">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="325">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="337">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="339">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="344">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="350">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="369">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="371">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="381">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="386">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="395">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="399">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="401">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="406">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="420">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="421">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="424">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="426">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="433">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="434">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="435">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="440">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="445">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="450">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="459">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="463">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="465">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leave&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="470">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="478">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="482">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="485">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="486">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="495">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="497">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="498">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="502">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="512">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="513">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="521">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;leave-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.leave(:force =&gt; true, :ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="525">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="527">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;action&quot;: &quot;leav&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="532">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="537867f56221c49032affde57e54777dc4bbf7c9">
  <div class="header">
    <h3>spec/lib/integration/multiplexed_subscribe_flow_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &#39;multiplexed subscribe flow&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  it &#39;works as decribed&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    VCR.use_cassette(&#39;new_ones/multiplexed_subscribe&#39;, :record =&gt; :new_episodes) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn = Pubnub.new(:subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :uuid =&gt; &#39;rubytest&#39;, :origin =&gt; &#39;pubsub.pubnub.com&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.subscribe(:channel =&gt; &#39;rubya&#39;){ |e| puts e.channel; puts e.msg }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">      # 1 subs on 1 connection</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.env[:subscriptions].size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.env[:subscriptions][&#39;pubsub.pubnub.com&#39;].get_channels.size.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.subscribe(:channel =&gt; &#39;rubya-pnpres&#39;){ |e| puts e.channel; puts e.msg }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      # 2 subs on 1 connection</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">      eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.env[:subscriptions].size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.env[:subscriptions][&#39;pubsub.pubnub.com&#39;].get_channels.size.should eq 2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.subscribe(:channel =&gt; &#39;rubyb&#39;){ |e| puts e.channel; puts e.msg }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      # 3 subs on 1 connection</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.env[:subscriptions].size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.env[:subscriptions][&#39;pubsub.pubnub.com&#39;].get_channels.size.should eq 3</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.leave(:channel =&gt; &#39;rubyb&#39;){ |e| puts e.channel; puts e.msg }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      # 2 subs on 1 connection</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">      eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.env[:subscriptions].size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.env[:subscriptions][&#39;pubsub.pubnub.com&#39;].get_channels.size.should eq 2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">      @pn.leave(:channel =&gt; &#39;rubya,rubya-pnpres&#39;){ |e| puts e.channel; puts e.msg }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      # 0 subs on 0 connections</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">      eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.env[:subscriptions].size.should eq 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c68d8cfa3c568c75e2cfad181d52564ad53316d5">
  <div class="header">
    <h3>spec/lib/integration/presence_dpc_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>372</b> relevant lines. 
      <span class="green"><b>372</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#presence&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="14">
          <span class="hits">16</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="15">
          <span class="hits">16</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="16">
          <span class="hits">16</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="17">
          <span class="hits">16</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:disable_persistent_connection =&gt; true, :max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="32">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="56">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="87">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="120">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="151">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="186">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="216">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="217">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="218">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="234">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="249">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="250">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="251">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="264">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="280">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="281">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="282">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="285">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="295">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="301">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="315">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="316">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="318">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="319">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="331">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="332">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="335">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="343">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="345">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="346">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="347">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="349">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="350">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="364">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="374">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="377">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="378">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="379">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="383">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="388">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="389">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="393">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="394">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="395">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="399">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="405">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="406">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="408">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="409">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="410">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="411">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="414">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="419">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="420">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="427">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="440">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="443">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="444">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="445">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="449">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="454">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="459">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="474">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="475">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="480">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="487">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="498">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="503">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="511">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="513">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="522">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="529">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="533">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="534">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="538">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="539">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="540">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="541">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="542">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="543">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="544">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="545">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="546">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="547">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="548">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="550">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="551">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="552">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="553">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="554">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="555">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="556">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="557">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3b5783c9d0b73e9f37b87b3f81702e02d40d2ecc">
  <div class="header">
    <h3>spec/lib/integration/presence_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>372</b> relevant lines. 
      <span class="green"><b>372</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#presence&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="14">
          <span class="hits">16</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="15">
          <span class="hits">16</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="16">
          <span class="hits">16</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="17">
          <span class="hits">16</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="21">
          <span class="hits">39</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="22">
          <span class="hits">39</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="32">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="56">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="87">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="120">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="151">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="186">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="216">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="217">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="218">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="234">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="249">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="250">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="251">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="264">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="280">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="281">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="282">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="285">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="295">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="301">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="315">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="316">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="318">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="319">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="331">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="332">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="335">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="343">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="345">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="346">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="347">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="349">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="350">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="364">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="374">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="377">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="378">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="379">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="383">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="388">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="389">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="393">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="394">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="395">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="399">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="405">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="406">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="408">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="409">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="410">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="411">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="414">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="419">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="420">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="427">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="440">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="443">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="444">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="445">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="449">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;][[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;leave&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;1}{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1390430008, &quot;uuid&quot;=&gt;&quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;=&gt;2}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="454">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="459">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="474">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="475">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="480">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 1},{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1390430008, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;, &quot;occupancy&quot;: 2}],&quot;13904300089348992&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="487">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="498">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="503">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="511">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="513">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="522">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="529">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="533">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="534">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="538">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="539">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="540">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;presence-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="541">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="542">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="543">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="544">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="545">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="546">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;leave&quot;, &quot;timestamp&quot;: 1390430067, &quot;uuid&quot;: &quot;3bad4360-2b9f-470f-aaf7-dac04454b1fb&quot;,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="547">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="548">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="550">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="551">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="552">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="553">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="554">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="555">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="556">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="557">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f3e490ff876d201c77b6b9e07ffb3fb9ad34cf97">
  <div class="header">
    <h3>spec/lib/integration/publish_dpc_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>893</b> relevant lines. 
      <span class="green"><b>893</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &#39;#publish&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="5">
          <span class="hits">66</span>
          
          <code class="ruby">    @envelopes = Array.new</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="6">
          <span class="hits">66</span>
          
          <code class="ruby">    @error_envelopes = Array.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="8">
          <span class="hits">66</span>
          
          <code class="ruby">    @callback = lambda do |envelope|</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="9">
          <span class="hits">18</span>
          
          <code class="ruby">      @envelopes &lt;&lt; envelope</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="12">
          <span class="hits">66</span>
          
          <code class="ruby">    @error_callback = lambda do |envelope|</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="13">
          <span class="hits">48</span>
          
          <code class="ruby">      @error_envelopes &lt;&lt; envelope</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;uses http&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;with auth_key provided&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;without encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="22">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">              :auth_key =&gt; :demoish_authkey,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">              :disable_persistent_connection =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="32">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="48">
          <span class="hits">3</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="95">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="96">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="148">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="149">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="199">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="200">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="202">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;with encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="243">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">              :auth_key =&gt; :demoish_authkey,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">              :cipher_key =&gt; &#39;secret&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">              :disable_persistent_connection =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="254">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="270">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="276">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="282">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="295">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="314">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="316">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="317">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="318">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="319">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="331">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="332">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="334">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="337">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="340">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="345">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="346">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="347">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="348">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="349">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="351">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="354">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="367">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="370">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="371">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="377">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="387">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="389">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="395">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="403">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="404">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="405">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="406">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="409">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="410">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="411">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="412">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="415">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="416">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="417">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="418">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="419">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="421">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="422">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="424">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="427">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="430">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="431">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="432">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="433">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="438">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="440">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="454">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="460">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="461">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="462">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;without auth_key provided&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;without encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="467">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="468">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="469">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="470">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">              :disable_persistent_connection =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="476">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="477">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="484">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="485">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="487">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="492">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="498">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="499">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="500">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="501">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="502">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="504">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="505">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="506">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="509">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="510">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="511">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="512">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="513">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="514">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="519">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="520">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="522">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="523">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="524">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="525">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="526">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="531">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="538">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="539">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="540">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="541">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="542">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="543">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="544">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="545">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="546">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="547">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="548">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="550">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="551">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="552">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="553">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="554">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="555">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="556">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="557">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="558">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="559">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="560">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="561">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="562">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="563">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="564">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="565">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="566">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="567">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="568">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="569">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="570">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="571">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="572">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="573">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="574">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="575">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="576">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="577">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="578">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="579">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="580">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="581">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="582">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="583">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="584">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="585">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="586">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="587">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="588">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="589">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="590">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="591">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="592">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="593">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="594">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="595">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="596">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="597">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="598">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="599">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="600">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="601">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="602">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="603">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="604">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="605">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="606">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="607">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="608">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="609">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="610">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="611">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="612">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="613">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="614">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="615">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="616">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="617">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="618">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="619">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="620">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="621">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="622">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="623">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="624">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="625">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="626">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="627">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="628">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="629">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="630">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="631">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="632">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="633">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="634">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="635">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="636">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="637">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="638">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="639">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="640">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="641">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="642">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="643">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="644">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="645">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="646">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="647">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="648">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="649">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="650">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="651">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="652">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="653">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="654">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="655">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="656">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="657">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="658">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="659">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="660">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="661">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="662">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="663">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="664">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="665">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="666">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="667">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="668">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="669">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="670">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="671">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="672">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="673">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="674">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="675">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="676">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="677">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="678">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="679">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="680">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="681">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="682">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="683">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="684">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;with encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="685">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="686">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="687">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="688">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="689">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="690">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="691">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="692">
          
          
          <code class="ruby">              :cipher_key =&gt; &#39;secret&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="693">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="694">
          
          
          <code class="ruby">              :disable_persistent_connection =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="695">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="696">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="697">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="698">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="699">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="700">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="701">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="702">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="703">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="704">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="705">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="706">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="707">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="708">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="709">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="710">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="711">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="712">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="713">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="714">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="715">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="716">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="717">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="718">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="719">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="720">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="721">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="722">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="723">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="724">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="725">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="726">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="727">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="728">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="729">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="730">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="731">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="732">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="733">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="734">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="735">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="736">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="737">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="738">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="739">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="740">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="741">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="742">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="743">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="744">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="745">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="746">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="747">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="748">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="749">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="750">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="751">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="752">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="753">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="754">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="755">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="756">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="757">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="758">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="759">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="760">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="761">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="762">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="763">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="764">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="765">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="766">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="767">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="768">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="769">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="770">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="771">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="772">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="773">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="774">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="775">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="776">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="777">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="778">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="779">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="780">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="781">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="782">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="783">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="784">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="785">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="786">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="787">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="788">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="789">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="790">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="791">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="792">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="793">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="794">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="795">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="796">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="797">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="798">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="799">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="800">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="801">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="802">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="803">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="804">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="805">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="806">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="807">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="808">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="809">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="810">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="811">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="812">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="813">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="814">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="815">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="816">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="817">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="818">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="819">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="820">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="821">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="822">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="823">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="824">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="825">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="826">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="827">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="828">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="829">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="830">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="831">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="832">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="833">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="834">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="835">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="836">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="837">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="838">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="839">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="840">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="841">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="842">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="843">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="844">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="845">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="846">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="847">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="848">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="849">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="850">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="851">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="852">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="853">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="854">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="855">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="856">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="857">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="858">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="859">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="860">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="861">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="862">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="863">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="864">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="865">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="866">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="867">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="868">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="869">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="870">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="871">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="872">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="873">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="874">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="875">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="876">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="877">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="878">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="879">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="880">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="881">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="882">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="883">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="884">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="885">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="886">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="887">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="888">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="889">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="890">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="891">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="892">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="893">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="894">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="895">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="896">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="897">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="898">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="899">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="900">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="901">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="902">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="903">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="904">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="905">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="906">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="907">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;uses https&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="908">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;with auth_key provided&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="909">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;without encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="910">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="911">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="912">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="913">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="914">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="915">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="916">
          
          
          <code class="ruby">              :auth_key =&gt; :demoish_authkey,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="917">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="918">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="919">
          
          
          <code class="ruby">              :ssl =&gt; true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="920">
          
          
          <code class="ruby">              :disable_persistent_connection =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="921">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="922">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="923">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="924">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="925">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="926">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="927">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="928">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="929">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="930">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="931">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="932">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="933">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="934">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="935">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="936">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="937">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="938">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="939">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="940">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="941">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="942">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="943">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="944">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="945">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="946">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="947">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="948">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="949">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="950">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="951">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="952">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="953">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="954">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="955">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="956">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="957">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="958">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="959">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="960">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="961">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="962">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="963">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="964">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="965">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="966">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="967">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="968">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="969">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="970">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="971">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="972">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="973">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="974">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="975">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="976">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="977">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="978">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="979">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="980">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="981">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="982">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="983">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="984">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="985">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="986">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="987">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="988">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="989">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="990">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="991">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="992">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="993">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="994">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="995">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="996">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="997">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="998">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="999">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1000">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1001">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1002">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1003">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1004">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1005">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1006">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1007">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1008">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1009">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1010">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1011">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1012">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1013">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1014">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1015">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1016">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1017">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1018">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1019">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1020">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1021">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1022">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1023">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1024">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1025">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1026">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1027">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1028">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1029">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1030">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1031">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1032">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1033">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1034">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1035">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1036">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1037">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1038">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1039">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1040">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1041">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1042">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1043">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1044">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1045">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1046">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1047">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1048">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1049">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1050">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1051">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1052">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1053">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1054">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1055">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1056">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1057">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1058">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1059">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1060">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1061">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1062">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1063">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1064">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1065">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1066">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1067">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1068">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1069">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1070">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1071">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1072">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1073">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1074">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1075">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1076">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1077">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1078">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1079">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1080">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1081">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1082">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1083">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1084">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1085">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1086">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1087">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1088">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1089">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1090">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1091">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1092">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1093">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1094">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1095">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1096">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1097">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1098">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1099">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1100">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1101">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1102">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1104">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1105">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1106">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1107">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1108">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1109">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1110">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1111">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1112">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1113">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1115">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1116">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1117">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1118">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1119">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1122">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1124">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1125">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1126">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1127">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1128">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1129">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1130">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1131">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;with encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1133">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="1134">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1135">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1136">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1137">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1138">
          
          
          <code class="ruby">              :auth_key =&gt; :demoish_authkey,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1139">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1140">
          
          
          <code class="ruby">              :cipher_key =&gt; &#39;secret&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1141">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1142">
          
          
          <code class="ruby">              :ssl =&gt; true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1143">
          
          
          <code class="ruby">              :disable_persistent_connection =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1144">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="1146">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1147">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1149">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1150">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1151">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1152">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1153">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1154">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1155">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1156">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1157">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1158">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1159">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1161">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1162">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1163">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1164">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1165">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1166">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1167">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1168">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1169">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1170">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1171">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1172">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1173">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1174">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1175">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1176">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1177">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1178">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1179">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1180">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1181">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1182">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1183">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1185">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1186">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1187">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1188">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1189">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1190">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1191">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1192">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1193">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1194">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1195">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1196">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1197">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1198">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1199">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1200">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1201">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1202">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1203">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1204">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1205">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1206">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1207">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1208">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1209">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1210">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1211">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1212">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1213">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1214">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1215">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1216">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1217">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1218">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1219">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1220">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1221">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1222">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1223">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1224">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1225">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1226">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1227">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1228">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1229">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1230">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1231">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1232">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1233">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1234">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1235">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1236">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1237">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1238">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1239">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1240">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1241">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1242">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1243">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1244">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1245">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1246">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1247">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1248">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1249">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1250">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1251">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1252">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1253">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1254">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1255">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1256">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1257">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1258">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1259">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1260">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1261">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1262">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1263">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1264">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1265">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1266">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1267">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1268">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1269">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1270">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1272">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1273">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1274">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1275">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1276">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1277">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1278">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1279">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1280">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1281">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1282">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1283">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1284">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1285">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1286">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1287">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1288">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1289">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1290">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1291">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1292">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1293">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1294">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1295">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1296">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1297">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1298">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1299">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1300">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1301">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1302">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1303">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1304">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1305">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1306">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1307">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1308">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1309">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1310">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1311">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1312">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1313">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1314">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1315">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1316">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1317">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1318">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1319">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1320">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1321">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1322">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1323">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1324">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1325">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1326">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1327">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1328">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1329">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1330">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1331">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1332">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1333">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1334">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1335">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1336">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1337">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1338">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1339">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1340">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1341">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1345">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1346">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1347">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1348">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1349">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1350">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1351">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1352">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1353">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1354">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1355">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;without auth_key provided&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1356">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;without encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1357">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1358">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="1359">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1360">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1361">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1362">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1363">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1364">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1365">
          
          
          <code class="ruby">              :ssl =&gt; true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1366">
          
          
          <code class="ruby">              :disable_persistent_connection =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1367">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1368">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="1369">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1370">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1371">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1372">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1373">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1374">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1375">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1376">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1377">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1378">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1379">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1380">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1381">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1382">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1383">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1384">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1385">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1386">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1387">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1388">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1389">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1390">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1391">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1392">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1393">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1394">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1395">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1396">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1397">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1398">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1399">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1400">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1401">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1402">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1403">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1404">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1405">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1406">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1407">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1408">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1409">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1410">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1411">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1412">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1413">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1414">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1415">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1416">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1417">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1418">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1419">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1420">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1421">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1422">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1423">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1424">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1425">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1426">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1427">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1428">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1429">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1430">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1431">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1432">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1433">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1434">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1435">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1436">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1437">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1438">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1439">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1440">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1441">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1442">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1443">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1444">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1445">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1446">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1447">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1448">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1449">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1450">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1451">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1452">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1453">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1454">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1455">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1456">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1457">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1458">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1459">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1460">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1461">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1462">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1463">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1464">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1465">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1466">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1467">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1468">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1469">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1470">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1471">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1472">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1473">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1474">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1475">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1476">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1477">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1478">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1479">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1480">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1481">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1482">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1483">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1484">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1485">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1486">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1487">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1488">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1489">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1490">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1491">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1492">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1493">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1494">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1495">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1496">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1497">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1498">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1499">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1500">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1501">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1502">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1503">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1504">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1505">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1506">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1507">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1508">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1509">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1510">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1511">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1512">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1513">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1514">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1515">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1516">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1517">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1518">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1519">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1520">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1521">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1522">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1523">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1524">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1525">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1526">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1527">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1528">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1529">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1530">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1531">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1532">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1533">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1534">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1535">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1536">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1537">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1538">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1539">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1540">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1541">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1542">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1543">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1544">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1545">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1546">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1547">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1548">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1549">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1550">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1551">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1552">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1553">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1554">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1555">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1556">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1557">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1558">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1559">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1560">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1561">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1562">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1563">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1564">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1565">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1566">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1567">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1568">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1569">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1570">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1571">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1572">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1573">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1574">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1575">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1576">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1577">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;with encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1578">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1579">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="1580">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1581">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1582">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1583">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1584">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1585">
          
          
          <code class="ruby">              :cipher_key =&gt; &#39;secret&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1586">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1587">
          
          
          <code class="ruby">              :ssl =&gt; true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1588">
          
          
          <code class="ruby">              :disable_persistent_connection =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1589">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1590">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="1591">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1592">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1593">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1594">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1595">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1596">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1597">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1598">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1599">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1600">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1601">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1602">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1603">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1604">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1605">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1606">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1607">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1608">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1609">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1610">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1611">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1612">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1613">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1614">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1615">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1616">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1617">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1618">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1619">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1620">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1621">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1622">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1623">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1624">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1625">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1626">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1627">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1628">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1629">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1630">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1631">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1632">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1633">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1634">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1635">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1636">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1637">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1638">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1639">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1640">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1641">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1642">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1643">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1644">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1645">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1646">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1647">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1648">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1649">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1650">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1651">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1652">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1653">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1654">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1655">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1656">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1657">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1658">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1659">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1660">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1661">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1662">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1663">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1664">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1665">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1666">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1667">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1668">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1669">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1670">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1671">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1672">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1673">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1674">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1675">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1676">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1677">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1678">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1679">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1680">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1681">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1682">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1683">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1684">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1685">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1686">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1687">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1688">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1689">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1690">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1691">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1692">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1693">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1694">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1695">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1696">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1697">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1698">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1699">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1700">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1701">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1702">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1703">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1704">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1705">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1706">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1707">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1708">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1709">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1710">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1711">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1712">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1713">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1714">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1715">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1716">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1717">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1718">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1719">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1720">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1721">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1722">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1723">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1724">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1725">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1726">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1727">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1728">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1729">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1730">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1731">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1732">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1733">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1734">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1735">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1736">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1737">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1738">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1739">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1740">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1741">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1742">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1743">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1744">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1745">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1746">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1747">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1748">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1749">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1750">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1751">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1752">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1753">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1754">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1755">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1756">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1757">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1758">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1759">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1760">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1761">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1762">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1763">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1764">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1765">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1766">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1767">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1768">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1769">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1770">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1771">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1772">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1773">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1774">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1775">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1776">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1777">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1778">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1779">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1780">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1781">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1782">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1783">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1784">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1785">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1786">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1787">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1788">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1789">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1790">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1791">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1792">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1793">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1794">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1795">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1796">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1797">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1798">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1799">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1800">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1801">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;when gets message as&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1802">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;array of hashes&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1803">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;and its plain&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1804">
          <span class="hits">1</span>
          
          <code class="ruby">        it &#39;publishes it correctly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1805">
          <span class="hits">1</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1806">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1807">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1808">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1809">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1810">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1811">
          
          
          <code class="ruby">              :disable_persistent_connection =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1812">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1813">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1814">
          <span class="hits">1</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1815">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1816">
          <span class="hits">1</span>
          
          <code class="ruby">          msg = [{:a =&gt; 1}, {:b =&gt; 2}, :c =&gt; [1,2,3]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1817">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1818">
          <span class="hits">1</span>
          
          <code class="ruby">          VCR.use_cassette(&#39;new_ones/publish/publish-plain-array-of-hashes&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1819">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1820">
          <span class="hits">1</span>
          
          <code class="ruby">            @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1821">
          
          
          <code class="ruby">                :message =&gt; msg,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1822">
          
          
          <code class="ruby">                :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1823">
          
          
          <code class="ruby">                :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1824">
          
          
          <code class="ruby">            )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1825">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1826">
          <span class="hits">1</span>
          
          <code class="ruby">            eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1827">
          <span class="hits">2</span>
          
          <code class="ruby">              @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1828">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1829">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1830">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1831">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.message.should eq(msg)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1832">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1833">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1834">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1835">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1836">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1837">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1838">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1839">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;and its encrypted&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1840">
          <span class="hits">1</span>
          
          <code class="ruby">        it &#39;publishes it correctly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1841">
          <span class="hits">1</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1842">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1843">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1844">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1845">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1846">
          
          
          <code class="ruby">              :cipher_key =&gt; &#39;secret&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1847">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1848">
          
          
          <code class="ruby">              :ssl =&gt; true,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1849">
          
          
          <code class="ruby">              :disable_persistent_connection =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1850">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1851">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1852">
          <span class="hits">1</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1853">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1854">
          <span class="hits">1</span>
          
          <code class="ruby">          msg = [{:a =&gt; 1}, {:b =&gt; 2}, :c =&gt; [1,2,3]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1855">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1856">
          <span class="hits">1</span>
          
          <code class="ruby">          VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-array-of-hashes&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1857">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1858">
          <span class="hits">1</span>
          
          <code class="ruby">            @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1859">
          
          
          <code class="ruby">                :message =&gt; msg,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1860">
          
          
          <code class="ruby">                :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1861">
          
          
          <code class="ruby">                :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1862">
          
          
          <code class="ruby">            )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1863">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1864">
          <span class="hits">1</span>
          
          <code class="ruby">            eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1865">
          <span class="hits">2</span>
          
          <code class="ruby">              @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1866">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1867">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1868">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1869">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.message.should eq(msg)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1870">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1871">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1872">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1873">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1874">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1875">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1876">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1877">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3f5a0fd37df2654aa13673c3f9fd7495ce90c987">
  <div class="header">
    <h3>spec/lib/integration/publish_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>896</b> relevant lines. 
      <span class="green"><b>896</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &#39;#publish&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="6">
          <span class="hits">66</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="7">
          <span class="hits">66</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="8">
          <span class="hits">66</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="10">
          <span class="hits">66</span>
          
          <code class="ruby">    @envelopes = Array.new</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="11">
          <span class="hits">66</span>
          
          <code class="ruby">    @error_envelopes = Array.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="13">
          <span class="hits">66</span>
          
          <code class="ruby">    @callback = lambda do |envelope|</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="14">
          <span class="hits">18</span>
          
          <code class="ruby">      @envelopes &lt;&lt; envelope</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="17">
          <span class="hits">66</span>
          
          <code class="ruby">    @error_callback = lambda do |envelope|</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="18">
          <span class="hits">48</span>
          
          <code class="ruby">      @error_envelopes &lt;&lt; envelope</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;uses http&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;with auth_key provided&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;without encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="27">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">              :auth_key =&gt; :demoish_authkey,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="36">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="52">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="99">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="100">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="152">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="153">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="156">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="158">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="202">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="203">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="204">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="218">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="234">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;with encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="247">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">              :auth_key =&gt; :demoish_authkey,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby">              :cipher_key =&gt; &#39;secret&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="254">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="257">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="264">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="273">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="285">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="287">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="301">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="314">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="319">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="320">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="321">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="325">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="337">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="340">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="343">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="344">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="345">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="346">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="347">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="348">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="349">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="350">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="354">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="364">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="367">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="369">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="370">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="373">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="374">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="377">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="378">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="379">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="382">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="383">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="385">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="386">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="396">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="397">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="406">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="412">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="416">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="418">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="419">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="420">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="424">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="425">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="427">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="432">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="433">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="435">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="436">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="437">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="442">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="446">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="448">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="460">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="461">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="462">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="463">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="464">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;without auth_key provided&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;without encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="468">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="470">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="477">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="478">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="479">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="480">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="485">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="491">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="492">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="494">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="498">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="500">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="501">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="502">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="506">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="509">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="511">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="512">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="513">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="514">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="515">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="516">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="519">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="520">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="521">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="523">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="524">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="525">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="526">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="527">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="528">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="534">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="540">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="541">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="542">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="543">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="544">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="545">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="546">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="547">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="548">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="550">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="551">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="552">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="553">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="554">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="555">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="556">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="557">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="558">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="559">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="560">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="561">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="562">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="563">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="564">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="565">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="566">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="567">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="568">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="569">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="570">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="571">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="572">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="573">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="574">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="575">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="576">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="577">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="578">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="579">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="580">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="581">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="582">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="583">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="584">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="585">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="586">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="587">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="588">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="589">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="590">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="591">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="592">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="593">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="594">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="595">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="596">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="597">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="598">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="599">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="600">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="601">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="602">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="603">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="604">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="605">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="606">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="607">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="608">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="609">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="610">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="611">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="612">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="613">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="614">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="615">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="616">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="617">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="618">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="619">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="620">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="621">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="622">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="623">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="624">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="625">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="626">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="627">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="628">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="629">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="630">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="631">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="632">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="633">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="634">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="635">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="636">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="637">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="638">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="639">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="640">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="641">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="642">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="643">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="644">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="645">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="646">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="647">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="648">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="649">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="650">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="651">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="652">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="653">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="654">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="655">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="656">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="657">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="658">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="659">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="660">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="661">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-http-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="662">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="663">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="664">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="665">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="666">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="667">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="668">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="669">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="670">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="671">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="672">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="673">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="674">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="675">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="676">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="677">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="678">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="679">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="680">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="681">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="682">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="683">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="684">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="685">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="686">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;with encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="687">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="688">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="689">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="690">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="691">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="692">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="693">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="694">
          
          
          <code class="ruby">              :cipher_key =&gt; &#39;secret&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="695">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="696">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="697">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="698">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="699">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="700">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="701">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="702">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="703">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="704">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="705">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="706">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="707">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="708">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="709">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="710">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="711">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="712">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="713">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="714">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="715">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="716">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="717">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="718">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="719">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="720">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="721">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="722">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="723">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="724">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="725">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="726">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="727">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="728">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="729">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="730">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="731">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="732">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="733">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="734">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="735">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="736">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="737">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="738">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="739">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="740">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="741">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="742">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="743">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="744">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="745">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="746">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="747">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="748">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="749">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="750">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="751">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="752">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="753">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="754">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="755">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="756">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="757">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="758">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="759">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="760">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="761">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="762">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="763">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="764">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="765">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="766">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="767">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="768">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="769">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="770">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="771">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="772">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="773">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="774">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="775">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="776">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="777">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="778">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="779">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="780">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="781">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="782">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="783">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="784">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="785">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="786">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="787">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="788">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="789">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="790">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="791">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="792">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="793">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="794">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="795">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="796">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="797">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="798">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="799">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="800">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="801">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="802">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="803">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="804">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="805">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="806">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="807">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="808">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="809">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="810">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="811">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="812">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="813">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="814">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="815">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="816">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="817">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="818">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="819">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="820">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="821">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="822">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="823">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="824">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="825">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="826">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="827">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="828">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="829">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="830">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="831">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="832">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="833">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="834">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="835">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="836">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="837">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="838">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="839">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="840">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="841">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="842">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="843">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="844">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="845">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="846">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="847">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="848">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="849">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="850">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="851">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="852">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="853">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="854">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="855">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="856">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="857">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="858">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="859">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="860">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="861">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="862">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="863">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="864">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="865">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="866">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="867">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="868">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="869">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="870">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="871">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="872">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="873">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="874">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="875">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="876">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="877">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="878">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="879">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="880">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="881">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-http-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="882">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="883">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="884">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="885">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="886">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="887">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="888">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="889">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="890">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="891">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="892">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="893">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="894">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="895">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="896">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="897">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="898">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="899">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="900">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="901">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="902">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="903">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="904">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="905">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="906">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="907">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="908">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;uses https&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="909">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;with auth_key provided&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="910">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;without encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="911">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="912">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="913">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="914">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="915">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="916">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="917">
          
          
          <code class="ruby">              :auth_key =&gt; :demoish_authkey,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="918">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="919">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="920">
          
          
          <code class="ruby">              :ssl =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="921">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="922">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="923">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="924">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="925">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="926">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="927">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="928">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="929">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="930">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="931">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="932">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="933">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="934">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="935">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="936">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="937">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="938">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="939">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="940">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="941">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="942">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="943">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="944">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="945">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="946">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="947">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="948">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="949">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="950">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="951">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="952">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="953">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="954">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="955">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="956">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="957">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="958">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="959">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="960">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="961">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="962">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="963">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="964">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="965">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="966">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="967">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="968">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="969">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="970">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="971">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="972">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="973">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="974">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="975">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="976">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="977">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="978">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="979">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="980">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="981">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="982">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="983">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="984">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="985">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="986">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="987">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="988">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="989">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="990">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="991">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="992">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="993">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="994">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="995">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="996">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="997">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="998">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="999">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1000">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1001">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1002">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1003">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1004">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1005">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1006">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1007">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1008">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1009">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1010">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1011">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1012">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1013">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1014">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1015">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1016">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1017">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1018">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1019">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1020">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1021">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1022">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1023">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1024">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1025">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1026">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1027">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1028">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1029">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1030">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1031">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1032">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1033">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1034">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1035">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1036">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1037">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1038">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1039">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1040">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1041">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1042">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1043">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1044">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1045">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1046">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1047">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1048">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1049">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1050">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1051">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1052">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1053">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1054">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1055">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1056">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1057">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1058">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1059">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1060">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1061">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1062">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1063">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1064">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1065">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1066">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1067">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1068">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1069">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1070">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1071">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1072">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1073">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1074">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1075">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1076">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1077">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1078">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1079">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1080">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1081">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1082">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1083">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1084">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1085">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1086">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1087">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1088">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1089">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1090">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1091">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1092">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1093">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1094">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1095">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1096">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1097">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1098">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1099">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1100">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1101">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1102">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1104">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1105">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1106">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1107">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1108">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1109">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1110">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1111">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1112">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1113">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1115">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1116">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1117">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1118">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1119">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1122">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1124">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1125">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1126">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1127">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1128">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1129">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1130">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1131">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;with encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1133">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="1134">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1135">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1136">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1137">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1138">
          
          
          <code class="ruby">              :auth_key =&gt; :demoish_authkey,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1139">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1140">
          
          
          <code class="ruby">              :cipher_key =&gt; &#39;secret&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1141">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1142">
          
          
          <code class="ruby">              :ssl =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1143">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="1145">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1146">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1148">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1149">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1150">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1151">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1152">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1153">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1154">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1155">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1156">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1157">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1158">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1160">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1161">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1162">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1163">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1164">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1165">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1166">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1167">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1168">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1169">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1170">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1171">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1172">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1173">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1174">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1175">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1176">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1177">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1178">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1179">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1180">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1181">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1182">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1183">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1185">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1186">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1187">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1188">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1189">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1190">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1191">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1192">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1193">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1194">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1195">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1196">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1197">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1198">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1199">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1200">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1201">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1202">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1203">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1204">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1205">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1206">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1207">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1208">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1209">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1210">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1211">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1212">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1213">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1214">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1215">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1216">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1217">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1218">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1219">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1220">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1221">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1222">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1223">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1224">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1225">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1226">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1227">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1228">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1229">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1230">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1231">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1232">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1233">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1234">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1235">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1236">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1237">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1238">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1239">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1240">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1242">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1243">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1244">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1245">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1246">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1247">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1248">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1249">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1250">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1251">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1252">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1253">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1254">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1255">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1256">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1257">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1258">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1259">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1260">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1261">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1262">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1263">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1264">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1265">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1266">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1267">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1268">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1269">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1270">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1271">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1272">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1273">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1274">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1275">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1276">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1277">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1278">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1279">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1280">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1281">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1282">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1283">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1284">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1285">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1286">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1287">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1288">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1289">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1290">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1291">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1292">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1293">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1294">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1295">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1296">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1297">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1298">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1299">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1300">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1301">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1302">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1303">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1304">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1305">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1306">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1307">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1308">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1309">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1310">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1311">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1312">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1313">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1314">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1315">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1316">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1317">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1318">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1319">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1320">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1321">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1322">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1323">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1324">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1325">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1326">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1327">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1328">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-auth_key-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1329">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1330">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1331">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1332">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1333">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1334">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1335">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1336">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1337">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1338">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1339">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1340">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1341">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1345">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1346">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1347">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1348">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1349">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1350">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1351">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1352">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1353">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1354">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;without auth_key provided&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1355">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;without encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1356">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1357">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="1358">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1359">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1360">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1361">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1362">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1363">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1364">
          
          
          <code class="ruby">              :ssl =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1365">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1366">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="1367">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1368">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1369">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1370">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1371">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1372">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1373">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1374">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1375">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1376">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1377">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1378">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1379">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1380">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1381">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1382">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1383">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1384">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1385">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1386">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1387">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1388">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1389">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1390">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1391">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1392">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1393">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1394">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1395">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1396">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1397">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1398">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1399">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1400">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1401">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1402">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1403">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1404">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1405">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1407">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1408">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1409">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1410">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1411">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1412">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1413">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1414">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1415">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1416">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1417">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1418">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1419">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1420">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1421">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1422">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1423">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1424">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1425">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1426">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1427">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1428">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1429">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1430">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1431">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1432">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1433">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1434">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1435">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1436">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1437">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1438">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1439">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1440">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1441">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1442">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1443">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1444">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1445">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1446">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1447">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1448">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1449">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1450">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1451">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1452">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1453">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1454">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1455">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1456">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1457">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1458">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1459">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1460">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1461">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1462">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1463">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1464">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1465">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1466">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1467">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1468">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1469">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1470">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1471">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1472">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1473">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1474">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1475">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1476">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1477">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1478">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1479">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1480">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1481">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1482">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1483">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1484">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1485">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1486">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1487">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1488">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1489">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1490">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1491">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1492">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1493">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1494">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1495">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1496">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1497">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1498">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1499">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1500">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1501">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1502">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1503">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1504">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1505">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1506">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1507">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1508">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1509">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1510">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1511">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1512">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1513">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1514">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1515">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1516">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1517">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1518">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1519">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1520">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1521">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1522">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1523">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1524">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1525">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1526">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1527">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1528">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1529">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1530">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1531">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1532">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1533">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1534">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1535">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1536">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1537">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1538">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1539">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1540">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1541">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1542">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1543">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1544">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1545">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1546">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1547">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1548">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1549">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1550">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-https-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1551">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1552">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1553">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1554">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1555">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1556">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1557">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1558">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1559">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1560">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1561">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1562">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13936818988607190&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1563">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1564">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1565">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1566">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1567">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1568">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1569">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1570">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1571">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1572">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1573">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1574">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1575">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;with encrypting message&#39; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1576">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1577">
          <span class="hits">1</span>
          
          <code class="ruby">        before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="1578">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1579">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1580">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1581">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1582">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1583">
          
          
          <code class="ruby">              :cipher_key =&gt; &#39;secret&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1584">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1585">
          
          
          <code class="ruby">              :ssl =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1586">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1587">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="1588">
          <span class="hits">8</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1589">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1590">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1591">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1592">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1593">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1594">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1595">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1596">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1597">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1598">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1599">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1600">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1601">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1602">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1603">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1604">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1605">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1606">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1607">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1608">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1609">
          <span class="hits">1</span>
          
          <code class="ruby">                    @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1610">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1611">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1612">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1613">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1614">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1615">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1616">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1617">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;publishes valid message&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1618">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1619">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1620">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1621">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1622">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1623">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1624">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1625">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1626">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1627">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1628">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1629">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1630">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1631">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.message.should eq({:text =&gt; &#39;sometext&#39;})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1632">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1633">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1634">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1635">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1636">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1637">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1638">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1639">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1640">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1641">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1642">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1643">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1644">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1645">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1646">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1647">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1648">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1649">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1650">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="1651">
          <span class="hits">3</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="1652">
          <span class="hits">3</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1653">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1654">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1655">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1656">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1657">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1658">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1659">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1660">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1661">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1662">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1663">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1664">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1665">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1666">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1667">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1668">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1669">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1670">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1671">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1672">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1673">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1674">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1675">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1676">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1677">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1678">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1679">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1680">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1681">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1682">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1683">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1684">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1685">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1686">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1687">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1688">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1689">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1690">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1691">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1692">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with valid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1693">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1694">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1695">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1696">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1697">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1698">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1699">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1700">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1701">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1702">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1703">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1704">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1705">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1706">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1707">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1708">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1709">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1710">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1711">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1712">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1713">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1714">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1715">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1716">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1717">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1718">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1719">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1720">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-non200-valid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1721">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1722">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1723">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1724">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1725">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1726">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1727">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1728">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1729">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1730">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1731">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1732">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1733">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1734">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1735">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Non 2xx server response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1736">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1737">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1738">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1739">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1740">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1741">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1742">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1743">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;with invalid json&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1744">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its asynchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1745">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1746">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1747">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1748">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1749">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1750">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1751">
          
          
          <code class="ruby">                      :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1752">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1753">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1754">
          <span class="hits">1</span>
          
          <code class="ruby">                  eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1755">
          <span class="hits">2</span>
          
          <code class="ruby">                    @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1756">
          <span class="hits">2</span>
          
          <code class="ruby">                    @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1757">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1758">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1759">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1760">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1761">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1762">
          <span class="hits">1</span>
          
          <code class="ruby">                    @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1763">
          
          
          <code class="ruby">                  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1764">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1765">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1766">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1767">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1768">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1769">
          <span class="hits">1</span>
          
          <code class="ruby">            context &#39;its synchronous&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1770">
          <span class="hits">1</span>
          
          <code class="ruby">              it &#39;handles invalid json and non200 response gracefully&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1771">
          <span class="hits">1</span>
          
          <code class="ruby">                VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-https-non200-invalid&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1772">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1773">
          <span class="hits">1</span>
          
          <code class="ruby">                  @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1774">
          
          
          <code class="ruby">                      :message =&gt; {:text =&gt; &#39;sometext&#39;},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1775">
          
          
          <code class="ruby">                      :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1776">
          
          
          <code class="ruby">                      :callback =&gt; @callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1777">
          
          
          <code class="ruby">                      :http_sync =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1778">
          
          
          <code class="ruby">                  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1779">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1780">
          <span class="hits">1</span>
          
          <code class="ruby">                  @envelopes.size.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1781">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1782">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response_message.should eq nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1783">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.response.should eq(&#39;[1,&quot;Sent&quot;,&quot;13937904716672898&quot;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1784">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.status.should eq 500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1785">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.channel.should eq(&#39;ruby_demo_channel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1786">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.message.should eq(&#39;[0,&quot;Invalid JSON in response.&quot;]&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1787">
          <span class="hits">1</span>
          
          <code class="ruby">                  @error_envelopes.first.timetoken.blank?.should eq true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1788">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1789">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1790">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1791">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1792">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1793">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1794">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1795">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1796">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1797">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1798">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;when gets message as&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1799">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;array of hashes&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1800">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;and its plain&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1801">
          <span class="hits">1</span>
          
          <code class="ruby">        it &#39;publishes it correctly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1802">
          <span class="hits">1</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1803">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1804">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1805">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1806">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1807">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1808">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1809">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1810">
          <span class="hits">1</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1811">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1812">
          <span class="hits">1</span>
          
          <code class="ruby">          msg = [{:a =&gt; 1}, {:b =&gt; 2}, :c =&gt; [1,2,3]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1813">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1814">
          <span class="hits">1</span>
          
          <code class="ruby">          VCR.use_cassette(&#39;new_ones/publish/publish-plain-array-of-hashes&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1815">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1816">
          <span class="hits">1</span>
          
          <code class="ruby">            @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1817">
          
          
          <code class="ruby">                :message =&gt; msg,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1818">
          
          
          <code class="ruby">                :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1819">
          
          
          <code class="ruby">                :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1820">
          
          
          <code class="ruby">            )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1821">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1822">
          <span class="hits">1</span>
          
          <code class="ruby">            eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1823">
          <span class="hits">2</span>
          
          <code class="ruby">              @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1824">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1825">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1826">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1827">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.message.should eq(msg)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1828">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1829">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1830">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1831">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1832">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1833">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1834">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1835">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;and its encrypted&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1836">
          <span class="hits">1</span>
          
          <code class="ruby">        it &#39;publishes it correctly&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1837">
          <span class="hits">1</span>
          
          <code class="ruby">          @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1838">
          
          
          <code class="ruby">              :max_retries =&gt; 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1839">
          
          
          <code class="ruby">              :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1840">
          
          
          <code class="ruby">              :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1841">
          
          
          <code class="ruby">              :secret_key =&gt; &#39;some_secret_key&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1842">
          
          
          <code class="ruby">              :cipher_key =&gt; &#39;secret&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1843">
          
          
          <code class="ruby">              :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1844">
          
          
          <code class="ruby">              :ssl =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1845">
          
          
          <code class="ruby">          )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1846">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1847">
          <span class="hits">1</span>
          
          <code class="ruby">          @pubnub.uuid = &#39;tester&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1848">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1849">
          <span class="hits">1</span>
          
          <code class="ruby">          msg = [{:a =&gt; 1}, {:b =&gt; 2}, :c =&gt; [1,2,3]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1850">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1851">
          <span class="hits">1</span>
          
          <code class="ruby">          VCR.use_cassette(&#39;new_ones/publish/publish-encrypted-array-of-hashes&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1852">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1853">
          <span class="hits">1</span>
          
          <code class="ruby">            @pubnub.publish(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1854">
          
          
          <code class="ruby">                :message =&gt; msg,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1855">
          
          
          <code class="ruby">                :channel =&gt; &#39;ruby_demo_channel&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1856">
          
          
          <code class="ruby">                :callback =&gt; @callback</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1857">
          
          
          <code class="ruby">            )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1858">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1859">
          <span class="hits">1</span>
          
          <code class="ruby">            eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="1860">
          <span class="hits">2</span>
          
          <code class="ruby">              @envelopes.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1861">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.response_message.should eq &#39;Sent&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1862">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.status.should eq 200</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1863">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.channel.should eq &#39;ruby_demo_channel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1864">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.message.should eq(msg)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="1865">
          <span class="hits">1</span>
          
          <code class="ruby">              @envelopes.first.timetoken.blank?.should eq false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1866">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1867">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1868">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1869">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1870">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1871">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="1872">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0321104742faaa74db6d19916349f7c15213c30b">
  <div class="header">
    <h3>spec/lib/integration/revoke_dpc_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>366</b> relevant lines. 
      <span class="green"><b>366</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#revoke&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="6">
          <span class="hits">33</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="7">
          <span class="hits">33</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="8">
          <span class="hits">33</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="10">
          <span class="hits">33</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="11">
          <span class="hits">33</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="13">
          <span class="hits">33</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="14">
          <span class="hits">9</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="15">
          <span class="hits">9</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="16">
          <span class="hits">9</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="17">
          <span class="hits">9</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="20">
          <span class="hits">33</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="27">
          <span class="hits">33</span>
          
          <code class="ruby">    @pn = Pubnub.new(:disable_persistent_connection =&gt; true, :max_retries =&gt; 0, :subscribe_key =&gt; &#39;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&#39;, :publish_key =&gt; &#39;pub-c-15d6fd3c-05de-4abc-8eba-6595a441959d&#39;, :secret_key =&gt; &#39;sec-c-ZWYwMGJiZTYtMTQwMC00NDQ5LWI0NmEtMzZiM2M5NThlOTJh&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="28">
          <span class="hits">33</span>
          
          <code class="ruby">    @pn.uuid = &#39;f0ac67ef-912f-4797-be67-a59745107306&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="30">
          <span class="hits">33</span>
          
          <code class="ruby">    Pubnub::Revoke.any_instance.stub(:current_time).and_return 1234567890</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="31">
          <span class="hits">33</span>
          
          <code class="ruby">    Pubnub::Revoke.any_instance.stub(:signature).and_return &#39;kdDh/sFC3rSR%2Bt5AEymIc57d1velIr562V7usa5M4k0=&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="35">
          <span class="hits">18</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    it &quot;Generates valid url for application level&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      VCR.use_cassette(&quot;revoke-application-level&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.revoke(:http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">        @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">        @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">        @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;service&quot;:&quot;Access Manager&quot;,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;r&quot;:0,&quot;ttl&quot;:1440,&quot;w&quot;:0,&quot;level&quot;:&quot;subkey&quot;}}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">        @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">        @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="69">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="99">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="131">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="156">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="158">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="161">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="195">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="225">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="251">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="257">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="281">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="282">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="287">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="301">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="318">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="319">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="324">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="325">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="348">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="349">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="350">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="354">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="381">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="386">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="401">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="410">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="411">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="412">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="416">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="426">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="434">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="435">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="444">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="445">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="448">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="450">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="474">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="475">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="480">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="487">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="497">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="498">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="506">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="510">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="512">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="513">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="517">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="527">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="536">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="537">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="538">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="539">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="541">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="542">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="543">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="544">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="545">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="546">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="547">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="548">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="550">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="551">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="552">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="553">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="554">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="555">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="64398207eae71bc2bbb52b8695ea8002e9884cd9">
  <div class="header">
    <h3>spec/lib/integration/revoke_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>366</b> relevant lines. 
      <span class="green"><b>366</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#revoke&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="6">
          <span class="hits">33</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="7">
          <span class="hits">33</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="8">
          <span class="hits">33</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="10">
          <span class="hits">33</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="11">
          <span class="hits">33</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="13">
          <span class="hits">33</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="14">
          <span class="hits">9</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="15">
          <span class="hits">9</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="16">
          <span class="hits">9</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="17">
          <span class="hits">9</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="20">
          <span class="hits">33</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="27">
          <span class="hits">33</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; &#39;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&#39;, :publish_key =&gt; &#39;pub-c-15d6fd3c-05de-4abc-8eba-6595a441959d&#39;, :secret_key =&gt; &#39;sec-c-ZWYwMGJiZTYtMTQwMC00NDQ5LWI0NmEtMzZiM2M5NThlOTJh&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="28">
          <span class="hits">33</span>
          
          <code class="ruby">    @pn.uuid = &#39;f0ac67ef-912f-4797-be67-a59745107306&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="30">
          <span class="hits">33</span>
          
          <code class="ruby">    Pubnub::Revoke.any_instance.stub(:current_time).and_return 1234567890</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="31">
          <span class="hits">33</span>
          
          <code class="ruby">    Pubnub::Revoke.any_instance.stub(:signature).and_return &#39;kdDh/sFC3rSR%2Bt5AEymIc57d1velIr562V7usa5M4k0=&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="35">
          <span class="hits">18</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    it &quot;Generates valid url for application level&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      VCR.use_cassette(&quot;revoke-application-level&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.revoke(:http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">        @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">        @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">        @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;service&quot;:&quot;Access Manager&quot;,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;r&quot;:0,&quot;ttl&quot;:1440,&quot;w&quot;:0,&quot;level&quot;:&quot;subkey&quot;}}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">        @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">        @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="69">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="99">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="131">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="156">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="158">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="161">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="195">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="225">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="251">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="257">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="273">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="281">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="282">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="287">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="301">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="318">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="319">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="324">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="325">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="348">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="349">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="350">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="352">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="354">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="357">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="381">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="386">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="401">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="410">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="411">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="412">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="414">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="416">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="426">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="434">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="435">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="444">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="445">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="448">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="450">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;Success&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="474">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="475">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="480">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&quot;message&quot;:&quot;Success&quot;,&quot;payload&quot;:{&quot;auths&quot;:{&quot;authkey&quot;:{&quot;r&quot;:0,&quot;w&quot;:0}},&quot;subscribe_key&quot;:&quot;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&quot;,&quot;ttl&quot;:1,&quot;channel&quot;:&quot;demo&quot;,&quot;level&quot;:&quot;user&quot;},&quot;service&quot;:&quot;Access Manager&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="487">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="497">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="498">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="506">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="510">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="512">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="513">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="517">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="527">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="536">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="537">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="538">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;revoke-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="539">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.revoke(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :auth_key =&gt; &quot;authkey&quot;, :write =&gt; true, :read =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="541">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="542">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="543">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="544">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;:200,&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="545">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="546">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="547">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="548">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="550">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="551">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="552">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="553">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="554">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="555">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ce76c95c8a9b679659c181df81cf82f33a6b326e">
  <div class="header">
    <h3>spec/lib/integration/state_spec.rb</h3>
    <h4><span class="yellow">84.62 %</span> covered</h4>
    <div>
      <b>52</b> relevant lines. 
      <span class="green"><b>44</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &#39;state metadata in subscribe requests&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="5">
          <span class="hits">5</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="6">
          <span class="hits">5</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="8">
          <span class="hits">5</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="15">
          <span class="hits">5</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="22">
          <span class="hits">5</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; &#39;sub-c-53c3d30a-4135-11e3-9970-02ee2ddab7fe&#39;, :publish_key =&gt; &#39;pub-c-15d6fd3c-05de-4abc-8eba-6595a441959d&#39;, :secret_key =&gt; &#39;sec-c-ZWYwMGJiZTYtMTQwMC00NDQ5LWI0NmEtMzZiM2M5NThlOTJh&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="23">
          <span class="hits">5</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytestuuid&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;sync&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;sets/gets proper data via subscribe request&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">      VCR.use_cassette(&quot;state-set-state-via-subscribe&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.subscribe(:channel =&gt; :whatever, :state =&gt; { :whatever =&gt; { :key =&gt; :value } }, :http_sync =&gt; true )</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">        enve = @pn.state(:channel =&gt; :whatever, :uuid =&gt; :rubytestuuid, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">        enve.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">        enve.first.response.should eq &quot;{\&quot;status\&quot;: 200, \&quot;message\&quot;: \&quot;OK\&quot;, \&quot;payload\&quot;: {\&quot;key\&quot;: \&quot;value\&quot;}, \&quot;service\&quot;: \&quot;Presence\&quot;}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;sets/gets proper data via client method using symbol&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">      VCR.use_cassette(&quot;state-set-state-via-client&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.set_state({ :key =&gt; :value }, :whatever)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.subscribe(:channel =&gt; :whatever, :http_sync =&gt; true )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">        enve = @pn.state(:channel =&gt; :whatever, :uuid =&gt; :rubytestuuid, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">        enve.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">        enve.first.response.should eq &quot;{\&quot;status\&quot;: 200, \&quot;message\&quot;: \&quot;OK\&quot;, \&quot;payload\&quot;: {\&quot;key\&quot;: \&quot;value\&quot;}, \&quot;service\&quot;: \&quot;Presence\&quot;}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;sets/gets proper data via client method using string&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">      VCR.use_cassette(&quot;state-set-state-via-client&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.set_state({ :key =&gt; :value }, :whatever)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.subscribe(:channel =&gt; :whatever, :http_sync =&gt; true )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">        enve = @pn.state(:channel =&gt; &#39;whatever&#39;, :uuid =&gt; :rubytestuuid, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">        enve.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">        enve.first.response.should eq &quot;{\&quot;status\&quot;: 200, \&quot;message\&quot;: \&quot;OK\&quot;, \&quot;payload\&quot;: {\&quot;key\&quot;: \&quot;value\&quot;}, \&quot;service\&quot;: \&quot;Presence\&quot;}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;async&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;sets/gets proper data via subscribe request&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">      VCR.use_cassette(&quot;state-async-set-state-via-subscribe&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.subscribe(:channel =&gt; :whatever, :state =&gt; { :whatever =&gt; { :key =&gt; :value } } ){|e|}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">        enve = @pn.state(:channel =&gt; :whatever, :uuid =&gt; :rubytestuuid, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">        enve.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">        enve.first.response.should eq &quot;{\&quot;status\&quot;: 200, \&quot;message\&quot;: \&quot;OK\&quot;, \&quot;payload\&quot;: {\&quot;key\&quot;: \&quot;value\&quot;}, \&quot;service\&quot;: \&quot;Presence\&quot;}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">    it &#39;sets/gets proper data via client&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">      VCR.use_cassette(&quot;state-async-set-state-via-subbedclient&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.subscribe(:channel =&gt; :whatever){|e|}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">        @pn.set_state({ :key =&gt; :value }, :whatever)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">        enve = @pn.state(:channel =&gt; :whatever, :uuid =&gt; :rubytestuuid, :http_sync =&gt; true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">        enve.size.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">        enve.first.response.should eq &quot;{\&quot;status\&quot;: 200, \&quot;message\&quot;: \&quot;OK\&quot;, \&quot;payload\&quot;: {\&quot;key\&quot;: \&quot;value\&quot;}, \&quot;service\&quot;: \&quot;Presence\&quot;}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f30b05ce3e8199332ef77410766408921b6a3828">
  <div class="header">
    <h3>spec/lib/integration/subscribe_dpc_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>376</b> relevant lines. 
      <span class="green"><b>376</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#subscribe&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="14">
          <span class="hits">16</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="15">
          <span class="hits">16</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="16">
          <span class="hits">16</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="17">
          <span class="hits">16</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = nil</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:disable_persistent_connection =&gt; true, :max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="29">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="33">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="57">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="88">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="121">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="152">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="156">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="187">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="202">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="218">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="234">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="248">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="250">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="251">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="264">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="279">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="281">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="282">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="285">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="295">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="296">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="301">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="315">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="316">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="317">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="319">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="320">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="331">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="332">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="343">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="344">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="345">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="346">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="347">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="348">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="350">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="351">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="364">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="369">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="381">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="386">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="402">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="407">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="408">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="417">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="419">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="421">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="426">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="430">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="434">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="439">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="441">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="442">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="443">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="444">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="446">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="452">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="454">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="457">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="458">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="460">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="461">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="462">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="463">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="470">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="471">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="472">
          <span class="hits">1</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="473">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="474">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="475">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="477">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="479">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="480">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="486">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="487">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="488">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="489">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="490">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="492">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="493">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="494">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="495">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="496">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="497">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="498">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="503">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="504">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="506">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="511">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="512">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="513">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="519">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="520">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="521">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="525">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="526">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="527">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="528">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="529">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="533">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="534">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="535">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="537">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="538">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="539">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="540">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="541">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="542">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="543">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="544">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="545">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="546">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="547">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="548">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="550">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="551">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="552">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="553">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="554">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="555">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="556">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="557">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="558">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="559">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="560">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="561">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="562">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="563">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="564">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="eeff47e94b4b628be52db1454e9b5469b237c343">
  <div class="header">
    <h3>spec/lib/integration/subscribe_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>376</b> relevant lines. 
      <span class="green"><b>376</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#subscribe&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="14">
          <span class="hits">16</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="15">
          <span class="hits">16</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="16">
          <span class="hits">16</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="17">
          <span class="hits">16</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = nil</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="29">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="33">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="57">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="88">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="121">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="152">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="156">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="187">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="202">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="218">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="234">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="248">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="250">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="251">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="264">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="279">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="281">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="282">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="285">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="295">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="296">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="301">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="310">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="315">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="316">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="317">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="319">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="320">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="329">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="331">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="332">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="336">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="343">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="344">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="345">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="346">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="347">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="348">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="350">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="351">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="361">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="364">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="369">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="381">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="384">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="386">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="402">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="407">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="408">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="417">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="419">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="421">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="426">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="430">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="434">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="439">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="441">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="442">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="443">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="444">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="446">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="452">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="454">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;][[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="457">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="458">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;text&quot;=&gt;&quot;hey&quot;}{&quot;text&quot;=&gt;&quot;hey&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="460">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="461">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="462">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="463">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="470">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="471">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="472">
          <span class="hits">1</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="473">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="474">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="475">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="477">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="479">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="480">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="486">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="487">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="488">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="489">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;13904299332319098&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="490">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="492">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="493">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="494">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="495">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="496">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="497">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="498">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="503">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="504">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="506">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="511">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="512">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="513">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="519">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="520">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="521">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="525">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="526">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="527">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="528">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="529">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="533">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="534">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="535">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="537">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="538">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="539">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="540">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="541">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="542">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="543">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="544">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="545">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="546">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="547">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;subscribe-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="548">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.subscribe(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="550">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="551">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="552">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="553">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;text&quot;:&quot;hey&quot;},{&quot;text&quot;:&quot;hey&quot;}],&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="554">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="555">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="556">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="557">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="558">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="559">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="560">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="561">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="562">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="563">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="564">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="84a279de169b27316e8d11b6b565389a75dfc2ac">
  <div class="header">
    <h3>spec/lib/integration/time_dpc_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>356</b> relevant lines. 
      <span class="green"><b>356</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#time&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:disable_persistent_connection =&gt; true, :max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="32">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="85">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="117">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="147">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="181">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="211">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="243">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="273">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="287">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="310">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="340">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="370">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="372">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="387">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="392">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="400">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="402">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="424">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="436">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="451">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="464">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="466">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="478">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="483">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="485">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="486">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="488">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="491">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="496">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="498">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="513">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="526">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="528">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="541">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="17a75dbb569f6a8de1e739c74c92f0a525170cfe">
  <div class="header">
    <h3>spec/lib/integration/time_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>356</b> relevant lines. 
      <span class="green"><b>356</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#time&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="32">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="85">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="117">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="147">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="181">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="211">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="243">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="250">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; true, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="273">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="287">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="288">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="289">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="310">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="312">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="318">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="326">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="327">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="333">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="335">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="338">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="340">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="342">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="343">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="355">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="358">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="359">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="360">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="363">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="364">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="365">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="370">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="372">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="374">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="375">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="376">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="377">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="378">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="379">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="380">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="383">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="387">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="388">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="389">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="390">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="391">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="392">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="393">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="394">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="395">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="399">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="400">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="402">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="405">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="406">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="408">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="409">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="410">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="411">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="413">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="414">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="419">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="420">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="422">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="423">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="424">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="425">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="427">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="428">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="429">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="436">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="440">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;13904301930718907&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="443">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="444">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="445">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="447">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="449">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="451">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="454">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="455">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="456">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="459">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="464">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="465">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="466">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301930718907]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="474">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="475">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="476">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="478">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="480">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="483">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="485">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="486">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="487">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="488">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="491">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="496">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="498">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="503">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="507">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="511">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; true, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="513">
          
          
          <code class="ruby">                </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="518">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="522">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;time-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.time(:ssl =&gt; false, :http_sync =&gt; false, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="526">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="528">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="529">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[13904301869920523&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="533">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="534">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="538">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="539">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="540">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="541">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4c6d8afc4aa02b78e5df216685170ff01d729ead">
  <div class="header">
    <h3>spec/lib/integration/v3_presence_dpc_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>372</b> relevant lines. 
      <span class="green"><b>372</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#presence&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:disable_persistent_connection =&gt; true, :max_retries =&gt; 0, :subscribe_key =&gt; &#39;demo-36&#39;, :publish_key =&gt; &#39;demo-36&#39;, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="32">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="56">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="87">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="120">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="151">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="186">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="216">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="217">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="218">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="234">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="249">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="250">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="251">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="264">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="280">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="281">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="282">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="285">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="295">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="301">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="315">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="316">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="318">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="319">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="331">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="332">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="335">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="343">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="345">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="346">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="347">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="349">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="350">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="364">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="374">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="377">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="378">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="379">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="383">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="388">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="389">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="393">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="394">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="395">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="399">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="405">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="406">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="408">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="409">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="410">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="411">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="414">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="419">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="420">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="427">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="440">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="443">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="444">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="445">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="449">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="454">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="459">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="474">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="475">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="480">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="487">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="498">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="503">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="511">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="513">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="522">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="529">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="533">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="534">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="538">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="539">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="540">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="541">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="542">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="543">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="544">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="545">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="546">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="547">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="548">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="550">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="551">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="552">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="553">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="554">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="555">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="556">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="557">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0c4b4d4cc312b301d800951a3313bf48a404f93c">
  <div class="header">
    <h3>spec/lib/integration/v3_presence_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>372</b> relevant lines. 
      <span class="green"><b>372</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &quot;#presence&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="6">
          <span class="hits">32</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="8">
          <span class="hits">32</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="14">
          <span class="hits">8</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="15">
          <span class="hits">8</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="16">
          <span class="hits">8</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="17">
          <span class="hits">8</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="20">
          <span class="hits">32</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="22">
          <span class="hits">24</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="23">
          <span class="hits">24</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="24">
          <span class="hits">24</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; &#39;demo-36&#39;, :publish_key =&gt; &#39;demo-36&#39;, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="28">
          <span class="hits">32</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="32">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = true }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="56">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="87">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="108">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="120">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="151">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="186">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="203">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="211">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="213">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="216">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="217">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="218">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="220">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="221">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="234">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="239">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="240">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="249">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="250">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="251">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="264">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="265">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-ssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; true, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="279">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="280">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="281">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="282">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="285">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">  context &quot;uses non-ssl&quot; do</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="295">
          <span class="hits">17</span>
          
          <code class="ruby">    before(:each) { @ssl = false }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as block&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="301">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="305">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="306">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="309">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="314">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="315">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="316">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="318">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="319">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="320">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="321">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="322">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="323">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="324">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="330">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="331">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="332">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="334">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="335">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="338">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="339">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="340">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="343">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="344">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="345">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="346">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="347">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="348">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="349">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="350">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="351">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="352">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="353">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="354">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="356">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="357">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="358">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="362">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="364">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="365">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="366">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="367">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="368">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="369">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="370">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="371">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="372">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="374">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="377">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="378">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="379">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="380">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="381">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="382">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="383">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="384">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="385">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="386">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="387">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="388">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="389">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="390">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="391">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="392">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="393">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="394">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="395">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="396">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="397">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="398">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="399">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="400">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="401">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="402">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="403">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="404">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="405">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="406">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="407">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="408">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="409">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="410">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-block-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="411">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="412">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="413">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="414">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="415">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="416">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="417">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="418">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="419">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="420">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="421">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="422">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="423">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="424">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="425">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="426">
          <span class="hits">1</span>
          
          <code class="ruby">    context &quot;passess callback as parameter&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="427">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets valid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="428">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="429">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="430">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="431">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="432">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="433">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="434">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="435">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="436">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="437">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="438">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="439">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="440">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="441">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="442">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="443">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="444">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="445">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="446">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="447">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="448">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="449">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="450">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="451">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="452">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="453">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;action&quot;=&gt;&quot;join&quot;, &quot;timestamp&quot;=&gt;1396891554, &quot;uuid&quot;=&gt;&quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;=&gt;1}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="454">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="455">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="456">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="457">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="458">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="459">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="460">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="461">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="462">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="463">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="464">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="465">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="466">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="467">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="468">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="469">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="470">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="471">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="472">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="473">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="474">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="475">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="476">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="477">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="478">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="479">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="480">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="481">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="482">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;]&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="483">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="484">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="485">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="486">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="487">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="488">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="489">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="490">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="491">
          <span class="hits">1</span>
          
          <code class="ruby">      context &quot;gets invalid json in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="492">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status 200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="493">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="494">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="495">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="496">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="497">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="498">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="499">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="500">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="501">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="502">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="503">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="504">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="505">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="506">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="507">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="508">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="509">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="510">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="511">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="512">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="513">
          <span class="hits">6</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="514">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="515">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="516">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="517">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="518">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="519">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="520">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="521">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="522">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="523">
          <span class="hits">1</span>
          
          <code class="ruby">        context &quot;gets status non-200 in response&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="524">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses sync connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="525">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="526">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="527">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="528">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; true, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="529">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="530">
          <span class="hits">1</span>
          
          <code class="ruby">                @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="531">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="532">
          <span class="hits">1</span>
          
          <code class="ruby">                @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="533">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="534">
          <span class="hits">1</span>
          
          <code class="ruby">                @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="535">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="536">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="537">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="538">
          <span class="hits">1</span>
          
          <code class="ruby">          context &quot;uses async connection&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="539">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="540">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;v3-presence-nonssl-parameter-invalid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="541">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.presence(:ssl =&gt; false, :http_sync =&gt; false, :channel =&gt; &quot;demo&quot;, :callback =&gt; @callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="542">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="543">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="544">
          <span class="hits">7</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="545">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="546">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;[[{&quot;action&quot;: &quot;join&quot;, &quot;timestamp&quot;: 1396891554, &quot;uuid&quot;: &quot;a1259d2d-7a7c-485f-8076-028a327e976d&quot;, &quot;occupancy&quot;: 1}],&quot;13968915543625014&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="547">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="548">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Invalid JSON in response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="549">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="550">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="551">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="552">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="553">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="554">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="555">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="556">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="557">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ed49d693fa488c369ed4ef97b096c7804a25f6dd">
  <div class="header">
    <h3>spec/lib/integration/where_now_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>195</b> relevant lines. 
      <span class="green"><b>195</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe &#39;#where_now&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="5">
          <span class="hits">16</span>
          
          <code class="ruby">    EM.stop if EM.reactor_running?</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="6">
          <span class="hits">16</span>
          
          <code class="ruby">    while EM.reactor_running? do end</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="7">
          <span class="hits">16</span>
          
          <code class="ruby">    sleep(0.1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="9">
          <span class="hits">16</span>
          
          <code class="ruby">    @response_output = StringIO.new</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="10">
          <span class="hits">16</span>
          
          <code class="ruby">    @message_output = StringIO.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="12">
          <span class="hits">16</span>
          
          <code class="ruby">    @callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="13">
          <span class="hits">4</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="14">
          <span class="hits">4</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="15">
          <span class="hits">4</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="16">
          <span class="hits">4</span>
          
          <code class="ruby">      @after_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="19">
          <span class="hits">16</span>
          
          <code class="ruby">    @error_callback = lambda { |envelope|</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="20">
          <span class="hits">12</span>
          
          <code class="ruby">      $logger.debug &#39;FIRING ERROR CALLBACK FROM TEST&#39;</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="21">
          <span class="hits">12</span>
          
          <code class="ruby">      @response_output.write envelope.response</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="22">
          <span class="hits">12</span>
          
          <code class="ruby">      @message_output.write envelope.msg</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="23">
          <span class="hits">12</span>
          
          <code class="ruby">      @after_error_callback = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="26">
          <span class="hits">16</span>
          
          <code class="ruby">    @pn = Pubnub.new(:max_retries =&gt; 0, :subscribe_key =&gt; :demo, :publish_key =&gt; :demo, :auth_key =&gt; :demoish_authkey, :secret_key =&gt; &#39;some_secret_key&#39;, :error_callback =&gt; @error_callback)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="27">
          <span class="hits">16</span>
          
          <code class="ruby">    @pn.uuid = &#39;rubytests&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;uses ssl&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;passes callback as block&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;gets valid json in respone&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 in response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses sync connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-block-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="40">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;payload&quot;=&gt;{&quot;channels&quot;=&gt;[]}, &quot;service&quot;=&gt;&quot;Presence&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses async connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-block-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="55">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;payload&quot;=&gt;{&quot;channels&quot;=&gt;[]}, &quot;service&quot;=&gt;&quot;Presence&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non-200 in response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses sync connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-block-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="72">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses async connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-block-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="88">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;gets invalid json in respone&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="101">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 in response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses sync connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-block-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="105">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="108">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="109">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &quot;[0,\&quot;Invalid JSON in response.\&quot;]&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses async connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="124">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="125">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="127">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &quot;[0,\&quot;Invalid JSON in response.\&quot;]&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non-200 in response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses sync connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-block-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="139">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="142">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &quot;[0,\&quot;Invalid JSON in response.\&quot;]&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses async connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-block-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="158">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &quot;[0,\&quot;Invalid JSON in response.\&quot;]&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;passes callback as parameter&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;gets valid json in respone&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 in response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses sync connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-parameter-valid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="177">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="180">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;payload&quot;=&gt;{&quot;channels&quot;=&gt;[]}, &quot;service&quot;=&gt;&quot;Presence&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses async connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-parameter-valid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="195">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="196">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;{&quot;status&quot;=&gt;200, &quot;message&quot;=&gt;&quot;OK&quot;, &quot;payload&quot;=&gt;{&quot;channels&quot;=&gt;[]}, &quot;service&quot;=&gt;&quot;Presence&quot;}&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non-200 in response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses sync connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-parameter-valid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="210">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="213">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="216">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="217">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses async connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="225">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-parameter-valid-non-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="228">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="229">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="230">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;}&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="232">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="233">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &#39;[0,&quot;Non 2xx server response.&quot;]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="238">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="239">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="241">
          <span class="hits">1</span>
          
          <code class="ruby">      context &#39;gets invalid json in respone&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status 200 in response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="243">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses sync connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="244">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-parameter-invalid-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="248">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="249">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="250">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="251">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="252">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &quot;[0,\&quot;Invalid JSON in response.\&quot;]&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="254">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses async connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="261">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="264">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="265">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="267">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="269">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &quot;[0,\&quot;Invalid JSON in response.\&quot;]&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="271">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="276">
          <span class="hits">1</span>
          
          <code class="ruby">        context &#39;gets status non-200 in response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="277">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses sync connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="278">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="279">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-parameter-invalid-non-200-sync&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="280">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="282">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="283">
          <span class="hits">2</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="284">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="285">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="286">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="287">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &quot;[0,\&quot;Invalid JSON in response.\&quot;]&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="293">
          <span class="hits">1</span>
          
          <code class="ruby">          context &#39;uses async connection&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">            it &#39;works fine&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="295">
          <span class="hits">1</span>
          
          <code class="ruby">              VCR.use_cassette(&quot;where_now-ssl-parameter-invalid-200-async&quot;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="296">
          <span class="hits">1</span>
          
          <code class="ruby">                @pn.where_now(:ssl =&gt; true, :http_sync =&gt; false, :uuid =&gt; &quot;demo_uuid&quot;, &amp;@callback)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="298">
          <span class="hits">1</span>
          
          <code class="ruby">                eventually do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="299">
          <span class="hits">3</span>
          
          <code class="ruby">                  @after_error_callback.should eq true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="300">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="301">
          <span class="hits">1</span>
          
          <code class="ruby">                  @response_output.read.should eq &#39;{&quot;status&quot;: 200, &quot;message&quot;: &quot;OK&quot;, &quot;payload&quot;: {&quot;channels&quot;: []}, &quot;service&quot;: &quot;Presence&quot;&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="302">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.seek 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">                  @message_output.read.should eq &quot;[0,\&quot;Invalid JSON in response.\&quot;]&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="304">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="307">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="308">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="38612edd0379361e1e4282d94faf8dbad5669835">
  <div class="header">
    <h3>spec/lib/retry_logic_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>25</b> relevant lines. 
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;spec_helper&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">describe Pubnub::Event do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before(:each) do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="6">
          <span class="hits">2</span>
          
          <code class="ruby">    @callback_counter       = 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    @error_callback_counter = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="9">
          <span class="hits">2</span>
          
          <code class="ruby">    @callback       = lambda do |envelope|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      @callback_counter += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="13">
          <span class="hits">2</span>
          
          <code class="ruby">    @error_callback = lambda do |envelope|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">      @error_callback_counter += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="17">
          <span class="hits">2</span>
          
          <code class="ruby">    @pubnub = Pubnub.new(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">        :subscribe_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">        :publish_key =&gt; :demo,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">        :max_retries =&gt; 5,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        :error_callback =&gt; @error_callback,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">        :auth_key =&gt; :demoish_authkey,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">        :uuid =&gt; :rubytests</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  context &#39;single event&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;when gets non200 response&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      it &#39;doesn\&#39;t retry&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">        VCR.use_cassette(&#39;single-event-non200&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">          @pubnub.publish(:channel =&gt; &quot;demo&quot;, :message =&gt; {:text =&gt; &quot;hey&quot;}, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">          eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="33">
          <span class="hits">2</span>
          
          <code class="ruby">            @callback_counter.should eq 0</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="34">
          <span class="hits">2</span>
          
          <code class="ruby">            @error_callback_counter.should eq 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    context &#39;when gets invalid JSON&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">      it &#39;do retry&#39; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">        VCR.use_cassette(&#39;single-event-invalid-json&#39;, :record =&gt; :none) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">          @pubnub.publish(:channel =&gt; &quot;demo&quot;, :message =&gt; {:text =&gt; &quot;hey&quot;}, &amp;@callback)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">          eventually do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="45">
          <span class="hits">2</span>
          
          <code class="ruby">            @callback_counter.should eq 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">            @error_callback_counter.should eq 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
